"use strict";(()=>{var a={};a.id=499,a.ids=[499],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26069:(a,b,c)=>{c.d(b,{m_:()=>e,yI:()=>d});class d extends Error{constructor(a,b,c){super(a),this.field=b,this.value=c,this.name="ValidationError"}}class e extends Error{constructor(a,b){super(`${a} with identifier '${b}' not found`),this.name="NotFoundError"}}},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{a.exports=require("path")},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46520:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>fb,patchFetch:()=>fa,routeModule:()=>e6,serverHooks:()=>e9,workAsyncStorage:()=>e7,workUnitAsyncStorage:()=>e8});var d,e,f,g,h,i,j,k={};c.r(k),c.d(k,{GET:()=>eV,POST:()=>eW});var l=c(95736),m=c(9117),n=c(4044),o=c(39326),p=c(32324),q=c(261),r=c(54290),s=c(85328),t=c(38928),u=c(46595),v=c(3421),w=c(17679),x=c(41681),y=c(63446),z=c(86439),A=c(51356),B=c(10641),C=c(59507),D=c(1003),E=c(51606),F=c(48689),G=c(85766),H=c(71559),I=c(69334),J=c(87280),K=c(71491),L=c(27628),M=c(26069);let N={cpu:{warning:70,critical:90},memory:{warning:80,critical:95},disk:{warning:85,critical:95},loadAverage:{warning:2,critical:4}},O={getLatestMetrics:K.db.select().from(L.systemMetrics).where((0,F.eq)(L.systemMetrics.nodeId,G.ll.placeholder("nodeId"))).orderBy((0,H.i)(L.systemMetrics.timestamp)).limit(1).prepare(),getMetricsByTimeRange:K.db.select().from(L.systemMetrics).where((0,F.Uo)((0,F.eq)(L.systemMetrics.nodeId,G.ll.placeholder("nodeId")),(0,F.RO)(L.systemMetrics.timestamp,G.ll.placeholder("startTime")),(0,F.wJ)(L.systemMetrics.timestamp,G.ll.placeholder("endTime")))).orderBy((0,H.i)(L.systemMetrics.timestamp)).prepare(),getHealthStats:K.db.select({avgCpu:(0,I.Zf)(L.systemMetrics.cpuUsagePercent),avgMemory:(0,I.Zf)(L.systemMetrics.memoryUsagePercent),avgDisk:(0,I.Zf)(L.systemMetrics.diskUsagePercent),maxCpu:(0,I.T9)(L.systemMetrics.cpuUsagePercent),maxMemory:(0,I.T9)(L.systemMetrics.memoryUsagePercent),maxDisk:(0,I.T9)(L.systemMetrics.diskUsagePercent),minCpu:(0,I.jk)(L.systemMetrics.cpuUsagePercent),minMemory:(0,I.jk)(L.systemMetrics.memoryUsagePercent),minDisk:(0,I.jk)(L.systemMetrics.diskUsagePercent),avgLoad1m:(0,I.Zf)(L.systemMetrics.loadAverage1m),avgLoad5m:(0,I.Zf)(L.systemMetrics.loadAverage5m),avgLoad15m:(0,I.Zf)(L.systemMetrics.loadAverage15m)}).from(L.systemMetrics).where((0,F.Uo)((0,F.eq)(L.systemMetrics.nodeId,G.ll.placeholder("nodeId")),(0,F.RO)(L.systemMetrics.timestamp,G.ll.placeholder("startTime")))).prepare()};class P{async recordSystemMetrics(a){try{this.validateMetricsData(a);let b=this.calculateOverallHealth(a),c={id:(0,J.sX)(),...a,overallHealth:b,timestamp:new Date().toISOString()},[d]=await K.db.insert(L.systemMetrics).values(c).returning();return{success:!0,data:d,affectedRows:1}}catch(a){return this.handleError("recordSystemMetrics",a)}}async getLatestSystemHealth(a="localhost"){try{let[b]=await O.getLatestMetrics.execute({nodeId:a});if(!b)return{success:!0,data:{status:"critical",cpuUsage:null,memoryUsage:null,diskUsage:null,loadAverage:null,uptime:null,internetConnected:null,claudeApiLatency:null,lastUpdated:null,alerts:[{type:"connectivity",level:"critical",message:"No system metrics available",value:0,threshold:0}]}};let c=this.generateHealthAlerts(b),d={status:b.overallHealth,cpuUsage:b.cpuUsagePercent,memoryUsage:b.memoryUsagePercent,diskUsage:b.diskUsagePercent,loadAverage:b.loadAverage1m,uptime:null,internetConnected:1===b.internetConnected,claudeApiLatency:b.claudeApiLatencyMs,lastUpdated:b.timestamp,alerts:c};return{success:!0,data:d}}catch(a){return this.handleError("getLatestSystemHealth",a)}}async getSystemMetrics(a={},b={}){try{let b=this.buildMetricsConditions(a),{limit:c=100,offset:d=0}=a,e=K.db.select().from(L.systemMetrics);b.length>0&&(e=e.where((0,F.Uo)(...b))),e=e.orderBy((0,H.i)(L.systemMetrics.timestamp));let f=K.db.select({count:(0,G.ll)`COUNT(*)`}).from(L.systemMetrics);b.length>0&&(f=f.where((0,F.Uo)(...b)));let[{count:g}]=await f,h=await e.limit(c).offset(d);return{success:!0,data:{data:h,total:g,page:Math.floor(d/c)+1,pageSize:c,hasMore:d+h.length<g}}}catch(a){return this.handleError("getSystemMetrics",a)}}async getMetricsTrends(a="localhost",b=24){try{let c=new Date,d=new Date;d.setHours(d.getHours()-b);let e=(await O.getMetricsByTimeRange.execute({nodeId:a,startTime:d.toISOString(),endTime:c.toISOString()})).map(a=>({timestamp:a.timestamp,cpuUsage:a.cpuUsagePercent,memoryUsage:a.memoryUsagePercent,diskUsage:a.diskUsagePercent,loadAverage1m:a.loadAverage1m,overallHealth:a.overallHealth}));return{success:!0,data:e}}catch(a){return this.handleError("getMetricsTrends",a)}}async getHealthStatistics(a="localhost",b=24){try{let c=new Date;c.setHours(c.getHours()-b);let[d]=await O.getHealthStats.execute({nodeId:a,startTime:c.toISOString()}),[e]=await K.db.select({healthy:(0,G.ll)`COUNT(CASE WHEN overall_health = 'healthy' THEN 1 END)`,warning:(0,G.ll)`COUNT(CASE WHEN overall_health = 'warning' THEN 1 END)`,critical:(0,G.ll)`COUNT(CASE WHEN overall_health = 'critical' THEN 1 END)`}).from(L.systemMetrics).where((0,F.Uo)((0,F.eq)(L.systemMetrics.nodeId,a),(0,F.RO)(L.systemMetrics.timestamp,c.toISOString()))),f={averages:{cpu:d.avgCpu,memory:d.avgMemory,disk:d.avgDisk,load1m:d.avgLoad1m,load5m:d.avgLoad5m,load15m:d.avgLoad15m},maximums:{cpu:d.maxCpu,memory:d.maxMemory,disk:d.maxDisk},minimums:{cpu:d.minCpu,memory:d.minMemory,disk:d.minDisk},healthDistribution:{healthy:e.healthy,warning:e.warning,critical:e.critical}};return{success:!0,data:f}}catch(a){return this.handleError("getHealthStatistics",a)}}async getSystemUptime(a="localhost"){try{let[b]=await K.db.select().from(L.systemMetrics).where((0,F.eq)(L.systemMetrics.nodeId,a)).orderBy((0,H.Y)(L.systemMetrics.timestamp)).limit(1),[c]=await K.db.select().from(L.systemMetrics).where((0,F.eq)(L.systemMetrics.nodeId,a)).orderBy((0,H.i)(L.systemMetrics.timestamp)).limit(1);if(!b||!c)return{success:!0,data:{totalUptimeHours:0,healthyUptimePercentage:0,lastRestartTime:null,continuousHealthyMinutes:0}};let d=new Date(c.timestamp).getTime()-new Date(b.timestamp).getTime(),[e]=await K.db.select({totalMetrics:(0,G.ll)`COUNT(*)`,healthyMetrics:(0,G.ll)`COUNT(CASE WHEN overall_health = 'healthy' THEN 1 END)`}).from(L.systemMetrics).where((0,F.eq)(L.systemMetrics.nodeId,a)),f=e.totalMetrics>0?e.healthyMetrics/e.totalMetrics*100:0,g=await K.db.select().from(L.systemMetrics).where((0,F.eq)(L.systemMetrics.nodeId,a)).orderBy((0,H.i)(L.systemMetrics.timestamp)).limit(1e3),h=0;for(let a of g)if("healthy"===a.overallHealth)h+=1;else break;return{success:!0,data:{totalUptimeHours:d/36e5,healthyUptimePercentage:f,lastRestartTime:b.timestamp,continuousHealthyMinutes:h}}}catch(a){return this.handleError("getSystemUptime",a)}}async cleanupOldMetrics(a=30){try{let b=new Date;b.setDate(b.getDate()-a);let c=await K.db.delete(L.systemMetrics).where((0,F.wJ)(L.systemMetrics.timestamp,b.toISOString()));return{success:!0,data:{deletedCount:c.changes},affectedRows:c.changes}}catch(a){return this.handleError("cleanupOldMetrics",a)}}calculateOverallHealth(a){let b=[];return(null!==a.cpuUsagePercent&&(a.cpuUsagePercent>=N.cpu.critical?b.push("critical"):a.cpuUsagePercent>=N.cpu.warning&&b.push("warning")),null!==a.memoryUsagePercent&&(a.memoryUsagePercent>=N.memory.critical?b.push("critical"):a.memoryUsagePercent>=N.memory.warning&&b.push("warning")),null!==a.diskUsagePercent&&(a.diskUsagePercent>=N.disk.critical?b.push("critical"):a.diskUsagePercent>=N.disk.warning&&b.push("warning")),null!==a.loadAverage1m&&void 0!==a.loadAverage1m&&(a.loadAverage1m>=N.loadAverage.critical?b.push("critical"):a.loadAverage1m>=N.loadAverage.warning&&b.push("warning")),!1===a.internetConnected&&b.push("critical"),b.includes("critical"))?"critical":b.includes("warning")?"warning":"healthy"}generateHealthAlerts(a){let b=[];return null!==a.cpuUsagePercent&&(a.cpuUsagePercent>=N.cpu.critical?b.push({type:"cpu",level:"critical",message:`CPU usage critical: ${a.cpuUsagePercent.toFixed(1)}%`,value:a.cpuUsagePercent,threshold:N.cpu.critical}):a.cpuUsagePercent>=N.cpu.warning&&b.push({type:"cpu",level:"warning",message:`CPU usage high: ${a.cpuUsagePercent.toFixed(1)}%`,value:a.cpuUsagePercent,threshold:N.cpu.warning})),null!==a.memoryUsagePercent&&(a.memoryUsagePercent>=N.memory.critical?b.push({type:"memory",level:"critical",message:`Memory usage critical: ${a.memoryUsagePercent.toFixed(1)}%`,value:a.memoryUsagePercent,threshold:N.memory.critical}):a.memoryUsagePercent>=N.memory.warning&&b.push({type:"memory",level:"warning",message:`Memory usage high: ${a.memoryUsagePercent.toFixed(1)}%`,value:a.memoryUsagePercent,threshold:N.memory.warning})),null!==a.diskUsagePercent&&(a.diskUsagePercent>=N.disk.critical?b.push({type:"disk",level:"critical",message:`Disk usage critical: ${a.diskUsagePercent.toFixed(1)}%`,value:a.diskUsagePercent,threshold:N.disk.critical}):a.diskUsagePercent>=N.disk.warning&&b.push({type:"disk",level:"warning",message:`Disk usage high: ${a.diskUsagePercent.toFixed(1)}%`,value:a.diskUsagePercent,threshold:N.disk.warning})),null!==a.loadAverage1m&&(a.loadAverage1m>=N.loadAverage.critical?b.push({type:"load",level:"critical",message:`System load critical: ${a.loadAverage1m.toFixed(2)}`,value:a.loadAverage1m,threshold:N.loadAverage.critical}):a.loadAverage1m>=N.loadAverage.warning&&b.push({type:"load",level:"warning",message:`System load high: ${a.loadAverage1m.toFixed(2)}`,value:a.loadAverage1m,threshold:N.loadAverage.warning})),!1===a.internetConnected&&b.push({type:"connectivity",level:"critical",message:"Internet connection unavailable",value:0,threshold:1}),b}buildMetricsConditions(a){let b=[];return a.nodeId&&b.push((0,F.eq)(L.systemMetrics.nodeId,a.nodeId)),a.dateFrom&&b.push((0,F.RO)(L.systemMetrics.timestamp,a.dateFrom.toISOString())),a.dateTo&&b.push((0,F.wJ)(L.systemMetrics.timestamp,a.dateTo.toISOString())),a.healthStatus&&b.push((0,F.eq)(L.systemMetrics.overallHealth,a.healthStatus)),b}validateMetricsData(a){if(null!==a.cpuUsagePercent&&void 0!==a.cpuUsagePercent&&(a.cpuUsagePercent<0||a.cpuUsagePercent>100))throw new M.yI("cpuUsagePercent must be between 0 and 100","cpuUsagePercent",a.cpuUsagePercent);if(null!==a.memoryUsagePercent&&void 0!==a.memoryUsagePercent&&(a.memoryUsagePercent<0||a.memoryUsagePercent>100))throw new M.yI("memoryUsagePercent must be between 0 and 100","memoryUsagePercent",a.memoryUsagePercent);if(null!==a.diskUsagePercent&&void 0!==a.diskUsagePercent&&(a.diskUsagePercent<0||a.diskUsagePercent>100))throw new M.yI("diskUsagePercent must be between 0 and 100","diskUsagePercent",a.diskUsagePercent);if(null!==a.loadAverage1m&&void 0!==a.loadAverage1m&&a.loadAverage1m<0)throw new M.yI("loadAverage1m cannot be negative","loadAverage1m",a.loadAverage1m);if(null!==a.claudeApiLatencyMs&&void 0!==a.claudeApiLatencyMs&&a.claudeApiLatencyMs<0)throw new M.yI("claudeApiLatencyMs cannot be negative","claudeApiLatencyMs",a.claudeApiLatencyMs);if(null!==a.diskFreeBytes&&void 0!==a.diskFreeBytes&&a.diskFreeBytes<0)throw new M.yI("diskFreeBytes cannot be negative","diskFreeBytes",a.diskFreeBytes);if(null!==a.diskTotalBytes&&void 0!==a.diskTotalBytes&&a.diskTotalBytes<=0)throw new M.yI("diskTotalBytes must be positive","diskTotalBytes",a.diskTotalBytes)}handleError(a,b){return(console.error(`MetricsService.${a} error:`,b),b instanceof M.yI||b instanceof M.m_)?{success:!1,error:b.message}:{success:!1,error:b instanceof Error?b.message:"Unknown database error"}}}let Q=new P,R=require("events"),S=require("os"),T=require("child_process");var U=c(28354);require("ws");let V=(0,U.promisify)(T.exec);class W extends R.EventEmitter{constructor(a={}){super(),this.intervalId=null,this.isRunning=!1,this.lastStats=null,this.previousCpuInfo=null,this.config={nodeId:"localhost",collectionInterval:3e4,thresholds:{cpu:{warning:70,critical:90},memory:{warning:80,critical:95},disk:{warning:85,critical:95},load:{warning:2,critical:4}},enabledMetrics:{cpu:!0,memory:!0,disk:!0,network:!0},...a},this.handleThresholdBreach=this.handleThresholdBreach.bind(this),this.handleHealthStatusChange=this.handleHealthStatusChange.bind(this)}async start(){if(this.isRunning)throw Error("System monitor is already running");this.isRunning=!0,this.emit("started",{nodeId:this.config.nodeId}),await this.collectMetrics(),this.intervalId=setInterval(async()=>{try{await this.collectMetrics()}catch(a){this.emit("error",a)}},this.config.collectionInterval),console.log(`System monitor started for node ${this.config.nodeId}, collecting every ${this.config.collectionInterval}ms`)}async stop(){this.isRunning&&(this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.emit("stopped",{nodeId:this.config.nodeId}),console.log(`System monitor stopped for node ${this.config.nodeId}`))}getConfig(){return{...this.config}}updateConfig(a){let b={...this.config};this.config={...this.config,...a},this.isRunning&&b.collectionInterval!==this.config.collectionInterval&&this.restart(),this.emit("configUpdated",{oldConfig:b,newConfig:this.config})}getLastStats(){return this.lastStats?{...this.lastStats}:null}async collectNow(){return await this.collectMetrics()}isMonitoring(){return this.isRunning}async restart(){await this.stop(),await this.start()}async collectMetrics(){let a={cpuUsage:0,memoryUsage:0,diskUsage:0,loadAverage:[0,0,0],uptime:0,diskSpace:{free:0,total:0},networkConnectivity:{internet:!1}};try{let b=[];return this.config.enabledMetrics.cpu&&b.push(this.collectCpuStats(a)),this.config.enabledMetrics.memory&&b.push(this.collectMemoryStats(a)),this.config.enabledMetrics.disk&&b.push(this.collectDiskStats(a)),this.config.enabledMetrics.network&&b.push(this.collectNetworkStats(a)),await Promise.allSettled(b),a.loadAverage=S.loadavg(),a.uptime=S.uptime(),this.lastStats=a,await this.storeMetrics(a),this.checkThresholds(a),this.broadcastStats(a),this.emit("metricsCollected",a),a}catch(a){throw this.emit("error",a),a}}async collectCpuStats(a){try{let b=S.cpus();if(this.previousCpuInfo){let c=0,d=0;for(let a=0;a<b.length;a++){let e=b[a],f=this.previousCpuInfo[a],g=Object.values(e.times).reduce((a,b)=>a+b,0),h=Object.values(f.times).reduce((a,b)=>a+b,0),i=g-h,j=e.times.idle-f.times.idle;d+=i,c+=j}let e=d>0?(d-c)/d*100:0;a.cpuUsage=Math.max(0,Math.min(100,e))}else a.cpuUsage=0;this.previousCpuInfo=b}catch(b){console.error("Error collecting CPU stats:",b),a.cpuUsage=0}}async collectMemoryStats(a){try{let b=S.totalmem(),c=S.freemem();a.memoryUsage=(b-c)/b*100}catch(b){console.error("Error collecting memory stats:",b),a.memoryUsage=0}}async collectDiskStats(a){try{let{stdout:b}=await V("df / | tail -1"),c=b.trim().split(/\s+/);if(c.length>=5){let b=1024*parseInt(c[1]),d=1024*parseInt(c[2]),e=1024*parseInt(c[3]);a.diskSpace.total=b,a.diskSpace.free=e,a.diskUsage=d/b*100}}catch(b){console.error("Error collecting disk stats:",b),a.diskUsage=0,a.diskSpace={free:0,total:0}}}async collectNetworkStats(a){try{let b=Date.now();try{await V("ping -c 1 -W 5000 8.8.8.8",{timeout:1e4}),a.networkConnectivity.internet=!0,a.networkConnectivity.latency=Date.now()-b}catch(b){a.networkConnectivity.internet=!1}}catch(b){console.error("Error collecting network stats:",b),a.networkConnectivity.internet=!1}}async storeMetrics(a){try{let b={nodeId:this.config.nodeId,cpuUsagePercent:a.cpuUsage,memoryUsagePercent:a.memoryUsage,diskUsagePercent:a.diskUsage,loadAverage1m:a.loadAverage[0],loadAverage5m:a.loadAverage[1],loadAverage15m:a.loadAverage[2],diskFreeBytes:a.diskSpace.free,diskTotalBytes:a.diskSpace.total,internetConnected:+!!a.networkConnectivity.internet,claudeApiLatencyMs:a.networkConnectivity.latency||null};await Q.recordSystemMetrics(b)}catch(a){console.error("Error storing metrics:",a),this.emit("error",a)}}checkThresholds(a){let b=[];a.cpuUsage>=this.config.thresholds.cpu.critical?b.push({metric:"cpu",level:"critical",value:a.cpuUsage,threshold:this.config.thresholds.cpu.critical}):a.cpuUsage>=this.config.thresholds.cpu.warning&&b.push({metric:"cpu",level:"warning",value:a.cpuUsage,threshold:this.config.thresholds.cpu.warning}),a.memoryUsage>=this.config.thresholds.memory.critical?b.push({metric:"memory",level:"critical",value:a.memoryUsage,threshold:this.config.thresholds.memory.critical}):a.memoryUsage>=this.config.thresholds.memory.warning&&b.push({metric:"memory",level:"warning",value:a.memoryUsage,threshold:this.config.thresholds.memory.warning}),a.diskUsage>=this.config.thresholds.disk.critical?b.push({metric:"disk",level:"critical",value:a.diskUsage,threshold:this.config.thresholds.disk.critical}):a.diskUsage>=this.config.thresholds.disk.warning&&b.push({metric:"disk",level:"warning",value:a.diskUsage,threshold:this.config.thresholds.disk.warning}),a.loadAverage[0]>=this.config.thresholds.load.critical?b.push({metric:"load",level:"critical",value:a.loadAverage[0],threshold:this.config.thresholds.load.critical}):a.loadAverage[0]>=this.config.thresholds.load.warning&&b.push({metric:"load",level:"warning",value:a.loadAverage[0],threshold:this.config.thresholds.load.warning}),b.length>0&&this.emit("thresholdBreach",b)}handleThresholdBreach(a){for(let b of a)console.warn(`Threshold breach: ${b.metric} ${b.level} - ${b.value.toFixed(2)}% (threshold: ${b.threshold}%)`)}handleHealthStatusChange(a){console.log(`System health status changed to: ${a}`)}broadcastStats(a){}calculateHealthStatus(a){return a.cpuUsage>=this.config.thresholds.cpu.critical||a.memoryUsage>=this.config.thresholds.memory.critical||a.diskUsage>=this.config.thresholds.disk.critical||a.loadAverage[0]>=this.config.thresholds.load.critical||!a.networkConnectivity.internet?"critical":a.cpuUsage>=this.config.thresholds.cpu.warning||a.memoryUsage>=this.config.thresholds.memory.warning||a.diskUsage>=this.config.thresholds.disk.warning||a.loadAverage[0]>=this.config.thresholds.load.warning?"warning":"healthy"}}let X=new W;class Y extends R.EventEmitter{constructor(a={}){super(),this.collectionHistory=new Map,this.aggregationTimers=new Map,this.isCollecting=!1,this.config={enableRealTimeCollection:!0,historicalRetentionDays:30,aggregationIntervals:{minute:!0,hour:!0,day:!0},customMetrics:{},...a},this.setupEventListeners()}async start(){if(this.isCollecting)throw Error("Metrics collection is already running");this.isCollecting=!0,X.isMonitoring()||await X.start(),this.setupAggregationTimers(),await this.initializeHistory(),this.emit("started"),console.log("Metrics collector started")}async stop(){if(this.isCollecting){for(let[a,b]of(this.isCollecting=!1,Array.from(this.aggregationTimers.entries())))clearInterval(b);this.aggregationTimers.clear(),this.emit("stopped"),console.log("Metrics collector stopped")}}async getMetricsSnapshot(){let a=X.getLastStats();if(!a)throw Error("No current system stats available");let b=await this.getHistoricalTrends(),c=await this.getAggregatedMetrics(),d=this.calculatePredictions();return{timestamp:new Date().toISOString(),current:a,trends:b,aggregated:c,predictions:d}}async getHistoricalTrends(a=["cpu","memory","disk"],b="day"){let c=[],d=this.getHoursForTimeframe(b);for(let b of a)try{let a=await this.calculateMetricTrend(b,d);c.push(a)}catch(a){console.error(`Error calculating trend for ${b}:`,a)}return c}async getAggregatedMetrics(){let[a,b,c]=await Promise.all([this.calculateAggregatedMetrics(24),this.calculateAggregatedMetrics(168),this.calculateAggregatedMetrics(720)]);return{last24Hours:a,last7Days:b,last30Days:c}}addCustomMetric(a,b){this.config.customMetrics[a]=b,this.emit("customMetricAdded",{name:a})}removeCustomMetric(a){delete this.config.customMetrics[a],this.emit("customMetricRemoved",{name:a})}async cleanupOldMetrics(){let a=await Q.cleanupOldMetrics(this.config.historicalRetentionDays);if(a.success&&a.data)return a.data;throw Error(a.error||"Failed to cleanup old metrics")}getCollectionStats(){return{isCollecting:this.isCollecting,historySize:Array.from(this.collectionHistory.values()).reduce((a,b)=>a+b.length,0),customMetricsCount:Object.keys(this.config.customMetrics).length,aggregationTimersActive:this.aggregationTimers.size,config:{...this.config}}}setupEventListeners(){X.on("metricsCollected",a=>{this.isCollecting&&this.processMetrics(a)}),X.on("thresholdBreach",a=>{this.emit("thresholdBreach",a)}),X.on("error",a=>{this.emit("error",a)})}processMetrics(a){this.updateCollectionHistory(a),this.collectCustomMetrics(),this.emit("metricsProcessed",{stats:a,timestamp:new Date().toISOString()})}updateCollectionHistory(a){Date.now(),this.addToHistory("cpu",a.cpuUsage,1e3),this.addToHistory("memory",a.memoryUsage,1e3),this.addToHistory("disk",a.diskUsage,1e3),this.addToHistory("load",a.loadAverage[0],1e3)}addToHistory(a,b,c){this.collectionHistory.has(a)||this.collectionHistory.set(a,[]);let d=this.collectionHistory.get(a);d.push(b),d.length>c&&d.splice(0,d.length-c)}async collectCustomMetrics(){for(let[a,b]of Object.entries(this.config.customMetrics))try{let c=await b();this.addToHistory(`custom_${a}`,c,1e3),this.emit("customMetricCollected",{name:a,value:c})}catch(b){console.error(`Error collecting custom metric ${a}:`,b)}}setupAggregationTimers(){if(this.config.aggregationIntervals.minute){let a=setInterval(()=>{this.performAggregation("minute")},6e4);this.aggregationTimers.set("minute",a)}if(this.config.aggregationIntervals.hour){let a=setInterval(()=>{this.performAggregation("hour")},36e5);this.aggregationTimers.set("hour",a)}if(this.config.aggregationIntervals.day){let a=setInterval(()=>{this.performAggregation("day")},864e5);this.aggregationTimers.set("day",a)}}async performAggregation(a){try{let b=await this.calculateAggregatedMetrics("minute"===a?.017:"hour"===a?1:24);this.emit("aggregationCompleted",{period:a,aggregated:b,timestamp:new Date().toISOString()}),console.log(`Completed ${a} aggregation`)}catch(b){console.error(`Error performing ${a} aggregation:`,b),this.emit("aggregationError",{period:a,error:b})}}async calculateAggregatedMetrics(a){let b=new Date,c=new Date(b.getTime()-60*a*6e4),d=await Q.getHealthStatistics("localhost",a);if(!d.success)throw Error(`Failed to get health statistics: ${d.error}`);let e=d.data;return{period:a<=1?"minute":a<=24?"hour":"day",startTime:c.toISOString(),endTime:b.toISOString(),metrics:{avgCpu:e.averages.cpu||0,maxCpu:e.maximums.cpu||0,minCpu:e.minimums.cpu||0,avgMemory:e.averages.memory||0,maxMemory:e.maximums.memory||0,minMemory:e.minimums.memory||0,avgDisk:e.averages.disk||0,maxDisk:e.maximums.disk||0,minDisk:e.minimums.disk||0,avgLoad:e.averages.load1m||0,maxLoad:e.averages.load1m||0,minLoad:e.averages.load1m||0,uptimePercentage:this.calculateUptimePercentage(e.healthDistribution),healthDistribution:e.healthDistribution,dataPoints:e.healthDistribution.healthy+e.healthDistribution.warning+e.healthDistribution.critical}}}calculateUptimePercentage(a){let b=a.healthy+a.warning+a.critical;return b>0?(a.healthy+a.warning)/b*100:0}async calculateMetricTrend(a,b){let c=await Q.getMetricsTrends("localhost",b);if(!c.success)throw Error(`Failed to get trends for ${a}: ${c.error}`);let d=c.data,e=d.map(b=>{switch(a){case"cpu":return b.cpuUsage||0;case"memory":return b.memoryUsage||0;case"disk":return b.diskUsage||0;case"load":return b.loadAverage1m||0;default:return 0}}),f=this.calculateTrendDirection(e),g=this.calculateChangePercentage(e),h=this.calculateSignificance(g,e.length);return{metric:a,timeframe:`${b}h`,trend:f,changePercentage:g,significance:h,data:d.map((a,b)=>({timestamp:a.timestamp,value:e[b]}))}}calculateTrendDirection(a){if(a.length<2)return"stable";let b=a.slice(0,Math.floor(a.length/2)),c=a.slice(Math.floor(a.length/2)),d=b.reduce((a,b)=>a+b,0)/b.length,e=c.reduce((a,b)=>a+b,0)/c.length-d;return 5>Math.abs(e)?"stable":e>0?"increasing":"decreasing"}calculateChangePercentage(a){if(a.length<2)return 0;let b=a[0],c=a[a.length-1];return 0===b?100*(c>0):(c-b)/b*100}calculateSignificance(a,b){let c=Math.abs(a);return c>25&&b>10?"high":c>10&&b>5?"medium":"low"}calculatePredictions(){let a=this.collectionHistory.get("cpu")||[],b=this.collectionHistory.get("memory")||[],c=this.collectionHistory.get("disk")||[],d=this.linearPredict(a),e=this.linearPredict(b);return{nextHour:{cpu:Math.max(0,Math.min(100,d)),memory:Math.max(0,Math.min(100,e)),disk:Math.max(0,Math.min(100,this.linearPredict(c)))},confidence:Math.min(1,Math.min(a.length,b.length,c.length)/10/10)}}linearPredict(a){if(a.length<2)return a[0]||0;let b=a.slice(-10),c=b.length,d=0,e=0,f=0,g=0;for(let a=0;a<c;a++)d+=a,e+=b[a],f+=a*b[a],g+=a*a;let h=(c*f-d*e)/(c*g-d*d),i=(e-h*d)/c;return h*c+i}getHoursForTimeframe(a){switch(a){case"hour":return 1;case"day":default:return 24;case"week":return 168;case"month":return 720}}async initializeHistory(){try{let a=await Q.getMetricsTrends("localhost",24);if(a.success&&a.data)for(let b of a.data)null!==b.cpuUsage&&this.addToHistory("cpu",b.cpuUsage,1e3),null!==b.memoryUsage&&this.addToHistory("memory",b.memoryUsage,1e3),null!==b.diskUsage&&this.addToHistory("disk",b.diskUsage,1e3),null!==b.loadAverage1m&&this.addToHistory("load",b.loadAverage1m,1e3);console.log("Metrics collection history initialized")}catch(a){console.error("Error initializing collection history:",a)}}}let Z=new Y;class $ extends R.EventEmitter{constructor(a={}){super(),this.alerts=new Map,this.rules=new Map,this.channels=new Map,this.suppressions=new Map,this.breachCounts=new Map,this.resolutionTimer=null,this.config={maxActiveAlerts:1e3,alertRetentionHours:168,defaultSuppressionMinutes:5,enableAutoResolution:!0,resolutionCheckInterval:6e4,...a},this.setupDefaultChannels(),this.setupDefaultRules(),this.config.enableAutoResolution&&this.startResolutionTimer()}async createAlert(a){let b={id:this.generateAlertId(),timestamp:new Date().toISOString(),acknowledged:!1,resolved:!1,...a};return this.isAlertSuppressed(b)?console.debug(`Alert suppressed: ${b.title}`):(this.alerts.set(b.id,b),this.cleanupOldAlerts(),this.emit("alertCreated",b),await this.sendAlert(b),console.log(`Alert created: ${b.severity.toUpperCase()} - ${b.title}`)),b}async processThresholdBreach(a,b,c,d,e="system-monitor"){let f=`threshold_${a}`,g=this.rules.get(f);if(!g||!g.enabled)return null;let h=`${f}_${a}`,i=new Date;if(this.breachCounts.has(h)){let a=this.breachCounts.get(h);i.getTime()-a.firstBreach.getTime()>60*g.evaluationWindow*1e3?this.breachCounts.set(h,{count:1,firstBreach:i}):a.count++}else this.breachCounts.set(h,{count:1,firstBreach:i});let j=this.breachCounts.get(h);return j.count>=g.consecutiveBreaches?(this.breachCounts.delete(h),this.addSuppression(f,g.suppressionDuration),await this.createAlert({type:"threshold",severity:d,title:`${g.name} Threshold Exceeded`,message:`${a} is ${b.toFixed(2)}${a.includes("percentage")?"%":""}, exceeding threshold of ${c}${a.includes("percentage")?"%":""}`,source:e,metric:a,value:b,threshold:c,metadata:{ruleId:g.id,ruleName:g.name,consecutiveBreaches:j.count,evaluationWindow:g.evaluationWindow}})):null}async acknowledgeAlert(a,b){let c=this.alerts.get(a);return!!c&&(c.acknowledged=!0,c.acknowledgedAt=new Date().toISOString(),b&&(c.metadata={...c.metadata,acknowledgedBy:b}),this.emit("alertAcknowledged",c),console.log(`Alert acknowledged: ${c.title}`),!0)}async resolveAlert(a,b){let c=this.alerts.get(a);return!!c&&(c.resolved=!0,c.resolvedAt=new Date().toISOString(),b&&(c.metadata={...c.metadata,resolvedBy:b}),this.emit("alertResolved",c),console.log(`Alert resolved: ${c.title}`),!0)}getAlerts(a){let b=Array.from(this.alerts.values());return a&&(a.severity&&(b=b.filter(b=>b.severity===a.severity)),a.type&&(b=b.filter(b=>b.type===a.type)),a.source&&(b=b.filter(b=>b.source===a.source)),void 0!==a.resolved&&(b=b.filter(b=>b.resolved===a.resolved)),void 0!==a.acknowledged&&(b=b.filter(b=>b.acknowledged===a.acknowledged))),b.sort((a,b)=>new Date(b.timestamp).getTime()-new Date(a.timestamp).getTime()),a?.limit&&(b=b.slice(0,a.limit)),b}getAlertStats(){let a=Array.from(this.alerts.values()),b=new Date(new Date().getTime()-864e5),c=a.filter(a=>new Date(a.timestamp)>b).length,d=a.filter(a=>a.resolved),e=d.reduce((a,b)=>b.resolvedAt?a+(new Date(b.resolvedAt).getTime()-new Date(b.timestamp).getTime()):a,0),f=d.length>0?e/d.length/6e4:0,g={},h={};for(let b of a)g[b.type]=(g[b.type]||0)+1,h[b.severity]=(h[b.severity]||0)+1;return{totalAlerts:a.length,activeAlerts:a.filter(a=>!a.resolved).length,resolvedAlerts:d.length,acknowledgedAlerts:a.filter(a=>a.acknowledged).length,alertsByType:g,alertsBySeverity:h,alertsLast24Hours:c,averageResolutionTime:f}}addRule(a){let b={id:this.generateRuleId(a.name),...a};return this.rules.set(b.id,b),this.emit("ruleAdded",b),console.log(`Alert rule added: ${b.name}`),b}removeRule(a){let b=this.rules.get(a);return!!b&&(this.rules.delete(a),this.emit("ruleRemoved",b),console.log(`Alert rule removed: ${b.name}`),!0)}getRules(){return Array.from(this.rules.values())}addChannel(a){this.channels.set(a.id,a),this.emit("channelAdded",a),console.log(`Alert channel added: ${a.name}`)}removeChannel(a){let b=this.channels.get(a);return!!b&&(this.channels.delete(a),this.emit("channelRemoved",b),console.log(`Alert channel removed: ${b.name}`),!0)}getChannels(){return Array.from(this.channels.values())}async shutdown(){for(let a of(this.resolutionTimer&&(clearInterval(this.resolutionTimer),this.resolutionTimer=null),this.getAlerts({resolved:!1})))await this.resolveAlert(a.id,"system-shutdown");this.emit("shutdown"),console.log("Alert manager shutdown")}setupDefaultChannels(){this.addChannel({id:"websocket",type:"websocket",name:"WebSocket Broadcast",enabled:!0,config:{},handler:async a=>{}}),this.addChannel({id:"console",type:"console",name:"Console Log",enabled:!0,config:{},handler:async a=>{let b=new Date(a.timestamp).toLocaleString(),c="critical"===a.severity?"\uD83D\uDEA8":"error"===a.severity?"❌":"warning"===a.severity?"⚠️":"ℹ️";console.log(`${c} [${b}] ${a.severity.toUpperCase()} - ${a.title}: ${a.message}`)}})}setupDefaultRules(){this.addRule({name:"CPU High Usage Warning",description:"CPU usage exceeds warning threshold",enabled:!0,metric:"cpu",condition:"greater_than",threshold:70,severity:"warning",suppressionDuration:5,evaluationWindow:5,consecutiveBreaches:2}),this.addRule({name:"CPU Critical Usage",description:"CPU usage exceeds critical threshold",enabled:!0,metric:"cpu",condition:"greater_than",threshold:90,severity:"critical",suppressionDuration:2,evaluationWindow:3,consecutiveBreaches:1}),this.addRule({name:"Memory High Usage Warning",description:"Memory usage exceeds warning threshold",enabled:!0,metric:"memory",condition:"greater_than",threshold:80,severity:"warning",suppressionDuration:5,evaluationWindow:5,consecutiveBreaches:2}),this.addRule({name:"Memory Critical Usage",description:"Memory usage exceeds critical threshold",enabled:!0,metric:"memory",condition:"greater_than",threshold:95,severity:"critical",suppressionDuration:2,evaluationWindow:3,consecutiveBreaches:1}),this.addRule({name:"Disk High Usage Warning",description:"Disk usage exceeds warning threshold",enabled:!0,metric:"disk",condition:"greater_than",threshold:85,severity:"warning",suppressionDuration:10,evaluationWindow:10,consecutiveBreaches:3}),this.addRule({name:"Disk Critical Usage",description:"Disk usage exceeds critical threshold",enabled:!0,metric:"disk",condition:"greater_than",threshold:95,severity:"critical",suppressionDuration:5,evaluationWindow:5,consecutiveBreaches:2}),this.addRule({name:"High System Load",description:"System load average exceeds threshold",enabled:!0,metric:"load",condition:"greater_than",threshold:2,severity:"warning",suppressionDuration:5,evaluationWindow:5,consecutiveBreaches:3})}async sendAlert(a){let b=Array.from(this.channels.values()).filter(a=>a.enabled).map(async b=>{try{b.handler&&await b.handler(a)}catch(a){console.error(`Error sending alert through channel ${b.name}:`,a)}});await Promise.allSettled(b)}isAlertSuppressed(a){if("threshold"!==a.type||!a.metadata?.ruleId)return!1;let b=`${a.metadata.ruleId}_${a.metric}`,c=this.suppressions.get(b);return!!(c&&c.until>new Date)||(c&&this.suppressions.delete(b),!1)}addSuppression(a,b){let c=new Date(Date.now()+60*b*1e3);this.suppressions.set(`${a}`,{until:c,alertRuleId:a})}cleanupOldAlerts(){let a=new Date(new Date().getTime()-60*this.config.alertRetentionHours*6e4),b=0;for(let[c,d]of Array.from(this.alerts.entries()))new Date(d.timestamp)<a&&d.resolved&&(this.alerts.delete(c),b++);let c=Array.from(this.alerts.values()).filter(a=>!a.resolved);if(c.length>this.config.maxActiveAlerts)for(let a of c.sort((a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime()).slice(0,c.length-this.config.maxActiveAlerts))this.alerts.delete(a.id),b++;b>0&&console.log(`Cleaned up ${b} old alerts`)}startResolutionTimer(){this.resolutionTimer=setInterval(()=>{this.checkAutoResolution()},this.config.resolutionCheckInterval)}checkAutoResolution(){let a=new Date;for(let[b,c]of Array.from(this.suppressions.entries()))c.until<=a&&this.suppressions.delete(b)}generateAlertId(){return`alert_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateRuleId(a){return`rule_${a.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}`}}let _=new $,aa=require("node-cron");var ab=c(33873);let ac=require("url"),ad=require("readline");var ae=c(29021);let af=require("fs/promises");var ag=Object.create,ah=Object.getPrototypeOf,ai=Object.defineProperty,aj=Object.getOwnPropertyNames,ak=Object.prototype.hasOwnProperty,al=(a,b)=>()=>(b||a((b={exports:{}}).exports,b),b.exports),am=al((a,b)=>{!function(c,d){"object"==typeof a&&void 0!==b?d(a):"function"==typeof define&&define.amd?define(["exports"],d):d(c.URI=c.URI||{})}(a,function(a){function b(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];if(!(b.length>1))return b[0];b[0]=b[0].slice(0,-1);for(var d=b.length-1,e=1;e<d;++e)b[e]=b[e].slice(1,-1);return b[d]=b[d].slice(1),b.join("")}function c(a){return"(?:"+a+")"}function d(a){return void 0===a?"undefined":null===a?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}function e(a){return a.toUpperCase()}function f(a){var d="[A-Za-z]",e="[0-9]",f=b(e,"[A-Fa-f]"),g=c(c("%[EFef]"+f+"%"+f+f+"%"+f+f)+"|"+c("%[89A-Fa-f]"+f+"%"+f+f)+"|"+c("%"+f+f)),h="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",i=b("[\\:\\/\\?\\#\\[\\]\\@]",h),j=a?"[\\uE000-\\uF8FF]":"[]",k=b(d,e,"[\\-\\.\\_\\~]",a?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),l=c(d+b(d,e,"[\\+\\-\\.]")+"*"),m=c(c(g+"|"+b(k,h,"[\\:]"))+"*"),n=(c(c("25[0-5]")+"|"+c("2[0-4]"+e)+"|"+c("1"+e+e)+"|"+c("[1-9]"+e)+"|"+e),c(c("25[0-5]")+"|"+c("2[0-4]"+e)+"|"+c("1"+e+e)+"|"+c("0?[1-9]"+e)+"|0?0?"+e)),o=c(n+"\\."+n+"\\."+n+"\\."+n),p=c(f+"{1,4}"),q=c(c(p+"\\:"+p)+"|"+o),r=c(c(p+"\\:")+"{6}"+q),s=c("\\:\\:"+c(p+"\\:")+"{5}"+q),t=c(c(p)+"?\\:\\:"+c(p+"\\:")+"{4}"+q),u=c(c(c(p+"\\:")+"{0,1}"+p)+"?\\:\\:"+c(p+"\\:")+"{3}"+q),v=c(c(c(p+"\\:")+"{0,2}"+p)+"?\\:\\:"+c(p+"\\:")+"{2}"+q),w=c(c(c(p+"\\:")+"{0,3}"+p)+"?\\:\\:"+p+"\\:"+q),x=c(c(c(p+"\\:")+"{0,4}"+p)+"?\\:\\:"+q),y=c(c(c(p+"\\:")+"{0,5}"+p)+"?\\:\\:"+p),z=c(c(c(p+"\\:")+"{0,6}"+p)+"?\\:\\:"),A=c([r,s,t,u,v,w,x,y,z].join("|")),B=c(c(k+"|"+g)+"+"),C=(c(A+"\\%25"+B),c(A+c("\\%25|\\%(?!"+f+"{2})")+B)),D=c("[vV]"+f+"+\\."+b(k,h,"[\\:]")+"+"),E=c("\\["+c(C+"|"+A+"|"+D)+"\\]"),F=c(c(g+"|"+b(k,h))+"*"),G=c(E+"|"+o+"(?!"+F+")|"+F),H=c(e+"*"),I=c(c(m+"@")+"?"+G+c("\\:"+H)+"?"),J=c(g+"|"+b(k,h,"[\\:\\@]")),K=c(J+"*"),L=c(J+"+"),M=c(c(g+"|"+b(k,h,"[\\@]"))+"+"),N=c(c("\\/"+K)+"*"),O=c("\\/"+c(L+N)+"?"),P=c(M+N),Q=c(L+N),R="(?!"+J+")",S=(c(N+"|"+O+"|"+P+"|"+Q+"|"+R),c(c(J+"|"+b("[\\/\\?]",j))+"*")),T=c(c(J+"|[\\/\\?]")+"*"),U=c(c("\\/\\/"+I+N)+"|"+O+"|"+Q+"|"+R),V=c(l+"\\:"+U+c("\\?"+S)+"?"+c("\\#"+T)+"?"),W=c(c("\\/\\/"+I+N)+"|"+O+"|"+P+"|"+R),X=c(W+c("\\?"+S)+"?"+c("\\#"+T)+"?");return c(V+"|"+X),c(l+"\\:"+U+c("\\?"+S)+"?"),c(c("\\/\\/("+c("("+m+")@")+"?("+G+")"+c("\\:("+H+")")+"?)")+"?("+N+"|"+O+"|"+Q+"|"+R+")"),c("\\?("+S+")"),c("\\#("+T+")"),c(c("\\/\\/("+c("("+m+")@")+"?("+G+")"+c("\\:("+H+")")+"?)")+"?("+N+"|"+O+"|"+P+"|"+R+")"),c("\\?("+S+")"),c("\\#("+T+")"),c(c("\\/\\/("+c("("+m+")@")+"?("+G+")"+c("\\:("+H+")")+"?)")+"?("+N+"|"+O+"|"+Q+"|"+R+")"),c("\\?("+S+")"),c("\\#("+T+")"),c("("+m+")@"),c("\\:("+H+")"),{NOT_SCHEME:RegExp(b("[^]",d,e,"[\\+\\-\\.]"),"g"),NOT_USERINFO:RegExp(b("[^\\%\\:]",k,h),"g"),NOT_HOST:RegExp(b("[^\\%\\[\\]\\:]",k,h),"g"),NOT_PATH:RegExp(b("[^\\%\\/\\:\\@]",k,h),"g"),NOT_PATH_NOSCHEME:RegExp(b("[^\\%\\/\\@]",k,h),"g"),NOT_QUERY:RegExp(b("[^\\%]",k,h,"[\\:\\@\\/\\?]",j),"g"),NOT_FRAGMENT:RegExp(b("[^\\%]",k,h,"[\\:\\@\\/\\?]"),"g"),ESCAPE:RegExp(b("[^]",k,h),"g"),UNRESERVED:RegExp(k,"g"),OTHER_CHARS:RegExp(b("[^\\%]",k,i),"g"),PCT_ENCODED:RegExp(g,"g"),IPV4ADDRESS:RegExp("^("+o+")$"),IPV6ADDRESS:RegExp("^\\[?("+A+")"+c(c("\\%25|\\%(?!"+f+"{2})")+"("+B+")")+"?\\]?$")}}var g=f(!1),h=f(!0),i=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return function(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}(a,b);throw TypeError("Invalid attempt to destructure non-iterable instance")},j=/^xn--/,k=/[^\0-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},n=Math.floor,o=String.fromCharCode;function p(a){throw RangeError(m[a])}function q(a,b){var c=a.split("@"),d="";return c.length>1&&(d=c[0]+"@",a=c[1]),d+(function(a,b){for(var c=[],d=a.length;d--;)c[d]=b(a[d]);return c})((a=a.replace(l,".")).split("."),b).join(".")}var r=function(a,b){return a+22+75*(a<26)-((0!=b)<<5)},s=function(a,b,c){var d=0;for(a=c?n(a/700):a>>1,a+=n(a/b);a>455;d+=36)a=n(a/35);return n(d+36*a/(a+38))},t=function(a){var b=[],c=a.length,d=0,e=128,f=72,g=a.lastIndexOf("-");g<0&&(g=0);for(var h=0;h<g;++h)a.charCodeAt(h)>=128&&p("not-basic"),b.push(a.charCodeAt(h));for(var i=g>0?g+1:0;i<c;){for(var j=d,k=1,l=36;;l+=36){i>=c&&p("invalid-input");var m,o=(m=a.charCodeAt(i++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:36;(o>=36||o>n((0x7fffffff-d)/k))&&p("overflow"),d+=o*k;var q=l<=f?1:l>=f+26?26:l-f;if(o<q)break;var r=36-q;k>n(0x7fffffff/r)&&p("overflow"),k*=r}var t=b.length+1;f=s(d-j,t,0==j),n(d/t)>0x7fffffff-e&&p("overflow"),e+=n(d/t),d%=t,b.splice(d++,0,e)}return String.fromCodePoint.apply(String,b)},u=function(a){var b=[],c=(a=function(a){for(var b=[],c=0,d=a.length;c<d;){var e=a.charCodeAt(c++);if(e>=55296&&e<=56319&&c<d){var f=a.charCodeAt(c++);(64512&f)==56320?b.push(((1023&e)<<10)+(1023&f)+65536):(b.push(e),c--)}else b.push(e)}return b}(a)).length,d=128,e=0,f=72,g=!0,h=!1,i=void 0;try{for(var j,k=a[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value;l<128&&b.push(o(l))}}catch(a){h=!0,i=a}finally{try{!g&&k.return&&k.return()}finally{if(h)throw i}}var m=b.length,q=m;for(m&&b.push("-");q<c;){var t=0x7fffffff,u=!0,v=!1,w=void 0;try{for(var x,y=a[Symbol.iterator]();!(u=(x=y.next()).done);u=!0){var z=x.value;z>=d&&z<t&&(t=z)}}catch(a){v=!0,w=a}finally{try{!u&&y.return&&y.return()}finally{if(v)throw w}}var A=q+1;t-d>n((0x7fffffff-e)/A)&&p("overflow"),e+=(t-d)*A,d=t;var B=!0,C=!1,D=void 0;try{for(var E,F=a[Symbol.iterator]();!(B=(E=F.next()).done);B=!0){var G=E.value;if(G<d&&++e>0x7fffffff&&p("overflow"),G==d){for(var H=e,I=36;;I+=36){var J=I<=f?1:I>=f+26?26:I-f;if(H<J)break;var K=H-J,L=36-J;b.push(o(r(J+K%L,0))),H=n(K/L)}b.push(o(r(H,0))),f=s(e,A,q==m),e=0,++q}}}catch(a){C=!0,D=a}finally{try{!B&&F.return&&F.return()}finally{if(C)throw D}}++e,++d}return b.join("")},v=function(a){return q(a,function(a){return k.test(a)?"xn--"+u(a):a})},w=function(a){return q(a,function(a){return j.test(a)?t(a.slice(4).toLowerCase()):a})},x={};function y(a){var b=a.charCodeAt(0);return b<16?"%0"+b.toString(16).toUpperCase():b<128?"%"+b.toString(16).toUpperCase():b<2048?"%"+(b>>6|192).toString(16).toUpperCase()+"%"+(63&b|128).toString(16).toUpperCase():"%"+(b>>12|224).toString(16).toUpperCase()+"%"+(b>>6&63|128).toString(16).toUpperCase()+"%"+(63&b|128).toString(16).toUpperCase()}function z(a){for(var b="",c=0,d=a.length;c<d;){var e=parseInt(a.substr(c+1,2),16);e<128?(b+=String.fromCharCode(e),c+=3):e>=194&&e<224?(d-c>=6?b+=String.fromCharCode((31&e)<<6|63&parseInt(a.substr(c+4,2),16)):b+=a.substr(c,6),c+=6):e>=224?(d-c>=9?b+=String.fromCharCode((15&e)<<12|(63&parseInt(a.substr(c+4,2),16))<<6|63&parseInt(a.substr(c+7,2),16)):b+=a.substr(c,9),c+=9):(b+=a.substr(c,3),c+=3)}return b}function A(a,b){function c(a){var c=z(a);return c.match(b.UNRESERVED)?c:a}return a.scheme&&(a.scheme=String(a.scheme).replace(b.PCT_ENCODED,c).toLowerCase().replace(b.NOT_SCHEME,"")),void 0!==a.userinfo&&(a.userinfo=String(a.userinfo).replace(b.PCT_ENCODED,c).replace(b.NOT_USERINFO,y).replace(b.PCT_ENCODED,e)),void 0!==a.host&&(a.host=String(a.host).replace(b.PCT_ENCODED,c).toLowerCase().replace(b.NOT_HOST,y).replace(b.PCT_ENCODED,e)),void 0!==a.path&&(a.path=String(a.path).replace(b.PCT_ENCODED,c).replace(a.scheme?b.NOT_PATH:b.NOT_PATH_NOSCHEME,y).replace(b.PCT_ENCODED,e)),void 0!==a.query&&(a.query=String(a.query).replace(b.PCT_ENCODED,c).replace(b.NOT_QUERY,y).replace(b.PCT_ENCODED,e)),void 0!==a.fragment&&(a.fragment=String(a.fragment).replace(b.PCT_ENCODED,c).replace(b.NOT_FRAGMENT,y).replace(b.PCT_ENCODED,e)),a}function B(a){return a.replace(/^0*(.*)/,"$1")||"0"}function C(a,b){var c=i(a.match(b.IPV4ADDRESS)||[],2)[1];return c?c.split(".").map(B).join("."):a}function D(a,b){var c=i(a.match(b.IPV6ADDRESS)||[],3),d=c[1],e=c[2];if(!d)return a;for(var f=i(d.toLowerCase().split("::").reverse(),2),g=f[0],h=f[1],j=h?h.split(":").map(B):[],k=g.split(":").map(B),l=b.IPV4ADDRESS.test(k[k.length-1]),m=l?7:8,n=k.length-m,o=Array(m),p=0;p<m;++p)o[p]=j[p]||k[n+p]||"";l&&(o[m-1]=C(o[m-1],b));var q=o.reduce(function(a,b,c){if(!b||"0"===b){var d=a[a.length-1];d&&d.index+d.length===c?d.length++:a.push({index:c,length:1})}return a},[]).sort(function(a,b){return b.length-a.length})[0],r=void 0;if(q&&q.length>1){var s=o.slice(0,q.index),t=o.slice(q.index+q.length);r=s.join(":")+"::"+t.join(":")}else r=o.join(":");return e&&(r+="%"+e),r}var E=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,F=void 0==="".match(/(){0}/)[1];function G(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c={},d=!1!==b.iri?h:g;"suffix"===b.reference&&(a=(b.scheme?b.scheme+":":"")+"//"+a);var e=a.match(E);if(e){F?(c.scheme=e[1],c.userinfo=e[3],c.host=e[4],c.port=parseInt(e[5],10),c.path=e[6]||"",c.query=e[7],c.fragment=e[8],isNaN(c.port)&&(c.port=e[5])):(c.scheme=e[1]||void 0,c.userinfo=-1!==a.indexOf("@")?e[3]:void 0,c.host=-1!==a.indexOf("//")?e[4]:void 0,c.port=parseInt(e[5],10),c.path=e[6]||"",c.query=-1!==a.indexOf("?")?e[7]:void 0,c.fragment=-1!==a.indexOf("#")?e[8]:void 0,isNaN(c.port)&&(c.port=a.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?e[4]:void 0)),c.host&&(c.host=D(C(c.host,d),d)),void 0!==c.scheme||void 0!==c.userinfo||void 0!==c.host||void 0!==c.port||c.path||void 0!==c.query?void 0===c.scheme?c.reference="relative":void 0===c.fragment?c.reference="absolute":c.reference="uri":c.reference="same-document",b.reference&&"suffix"!==b.reference&&b.reference!==c.reference&&(c.error=c.error||"URI is not a "+b.reference+" reference.");var f=x[(b.scheme||c.scheme||"").toLowerCase()];if(b.unicodeSupport||f&&f.unicodeSupport)A(c,d);else{if(c.host&&(b.domainHost||f&&f.domainHost))try{c.host=v(c.host.replace(d.PCT_ENCODED,z).toLowerCase())}catch(a){c.error=c.error||"Host's domain name can not be converted to ASCII via punycode: "+a}A(c,g)}f&&f.parse&&f.parse(c,b)}else c.error=c.error||"URI can not be parsed.";return c}var H=/^\.\.?\//,I=/^\/\.(\/|$)/,J=/^\/\.\.(\/|$)/,K=/^\/?(?:.|\n)*?(?=\/|$)/;function L(a){for(var b=[];a.length;)if(a.match(H))a=a.replace(H,"");else if(a.match(I))a=a.replace(I,"/");else if(a.match(J))a=a.replace(J,"/"),b.pop();else if("."===a||".."===a)a="";else{var c=a.match(K);if(c){var d=c[0];a=a.slice(d.length),b.push(d)}else throw Error("Unexpected dot segment condition")}return b.join("")}function M(a){var b,c,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=d.iri?h:g,f=[],i=x[(d.scheme||a.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(a,d),a.host){if(e.IPV6ADDRESS.test(a.host));else if(d.domainHost||i&&i.domainHost)try{a.host=d.iri?w(a.host):v(a.host.replace(e.PCT_ENCODED,z).toLowerCase())}catch(b){a.error=a.error||"Host's domain name can not be converted to "+(d.iri?"Unicode":"ASCII")+" via punycode: "+b}}A(a,e),"suffix"!==d.reference&&a.scheme&&(f.push(a.scheme),f.push(":"));var j=(b=!1!==d.iri?h:g,c=[],void 0!==a.userinfo&&(c.push(a.userinfo),c.push("@")),void 0!==a.host&&c.push(D(C(String(a.host),b),b).replace(b.IPV6ADDRESS,function(a,b,c){return"["+b+(c?"%25"+c:"")+"]"})),("number"==typeof a.port||"string"==typeof a.port)&&(c.push(":"),c.push(String(a.port))),c.length?c.join(""):void 0);if(void 0!==j&&("suffix"!==d.reference&&f.push("//"),f.push(j),a.path&&"/"!==a.path.charAt(0)&&f.push("/")),void 0!==a.path){var k=a.path;d.absolutePath||i&&i.absolutePath||(k=L(k)),void 0===j&&(k=k.replace(/^\/\//,"/%2F")),f.push(k)}return void 0!==a.query&&(f.push("?"),f.push(a.query)),void 0!==a.fragment&&(f.push("#"),f.push(a.fragment)),f.join("")}function N(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=arguments[3],e={};return d||(a=G(M(a,c),c),b=G(M(b,c),c)),!(c=c||{}).tolerant&&b.scheme?(e.scheme=b.scheme,e.userinfo=b.userinfo,e.host=b.host,e.port=b.port,e.path=L(b.path||""),e.query=b.query):(void 0!==b.userinfo||void 0!==b.host||void 0!==b.port?(e.userinfo=b.userinfo,e.host=b.host,e.port=b.port,e.path=L(b.path||""),e.query=b.query):(b.path?("/"===b.path.charAt(0)?e.path=L(b.path):(void 0===a.userinfo&&void 0===a.host&&void 0===a.port||a.path?a.path?e.path=a.path.slice(0,a.path.lastIndexOf("/")+1)+b.path:e.path=b.path:e.path="/"+b.path,e.path=L(e.path)),e.query=b.query):(e.path=a.path,void 0!==b.query?e.query=b.query:e.query=a.query),e.userinfo=a.userinfo,e.host=a.host,e.port=a.port),e.scheme=a.scheme),e.fragment=b.fragment,e}function O(a,b){return a&&a.toString().replace(b&&b.iri?h.PCT_ENCODED:g.PCT_ENCODED,z)}var P={scheme:"http",domainHost:!0,parse:function(a,b){return a.host||(a.error=a.error||"HTTP URIs must have a host."),a},serialize:function(a,b){var c="https"===String(a.scheme).toLowerCase();return(a.port===(c?443:80)||""===a.port)&&(a.port=void 0),a.path||(a.path="/"),a}},Q={scheme:"https",domainHost:P.domainHost,parse:P.parse,serialize:P.serialize};function R(a){return"boolean"==typeof a.secure?a.secure:"wss"===String(a.scheme).toLowerCase()}var S={scheme:"ws",domainHost:!0,parse:function(a,b){return a.secure=R(a),a.resourceName=(a.path||"/")+(a.query?"?"+a.query:""),a.path=void 0,a.query=void 0,a},serialize:function(a,b){if((a.port===(R(a)?443:80)||""===a.port)&&(a.port=void 0),"boolean"==typeof a.secure&&(a.scheme=a.secure?"wss":"ws",a.secure=void 0),a.resourceName){var c=i(a.resourceName.split("?"),2),d=c[0],e=c[1];a.path=d&&"/"!==d?d:void 0,a.query=e,a.resourceName=void 0}return a.fragment=void 0,a}},T={scheme:"wss",domainHost:S.domainHost,parse:S.parse,serialize:S.serialize},U={},V="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",W="[0-9A-Fa-f]",X=c(c("%[EFef]"+W+"%"+W+W+"%"+W+W)+"|"+c("%[89A-Fa-f]"+W+"%"+W+W)+"|"+c("%"+W+W)),Y=b("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),Z=RegExp(V,"g"),$=RegExp(X,"g"),_=RegExp(b("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Y),"g"),aa=RegExp(b("[^]",V,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g");function ab(a){var b=z(a);return b.match(Z)?b:a}var ac={scheme:"mailto",parse:function(a,b){var c=a.to=a.path?a.path.split(","):[];if(a.path=void 0,a.query){for(var d=!1,e={},f=a.query.split("&"),g=0,h=f.length;g<h;++g){var i=f[g].split("=");switch(i[0]){case"to":for(var j=i[1].split(","),k=0,l=j.length;k<l;++k)c.push(j[k]);break;case"subject":a.subject=O(i[1],b);break;case"body":a.body=O(i[1],b);break;default:d=!0,e[O(i[0],b)]=O(i[1],b)}}d&&(a.headers=e)}a.query=void 0;for(var m=0,n=c.length;m<n;++m){var o=c[m].split("@");if(o[0]=O(o[0]),b.unicodeSupport)o[1]=O(o[1],b).toLowerCase();else try{o[1]=v(O(o[1],b).toLowerCase())}catch(b){a.error=a.error||"Email address's domain name can not be converted to ASCII via punycode: "+b}c[m]=o.join("@")}return a},serialize:function(a,b){var c,d=null!=(c=a.to)?c instanceof Array?c:"number"!=typeof c.length||c.split||c.setInterval||c.call?[c]:Array.prototype.slice.call(c):[];if(d){for(var f=0,g=d.length;f<g;++f){var h=String(d[f]),i=h.lastIndexOf("@"),j=h.slice(0,i).replace($,ab).replace($,e).replace(_,y),k=h.slice(i+1);try{k=b.iri?w(k):v(O(k,b).toLowerCase())}catch(c){a.error=a.error||"Email address's domain name can not be converted to "+(b.iri?"Unicode":"ASCII")+" via punycode: "+c}d[f]=j+"@"+k}a.path=d.join(",")}var l=a.headers=a.headers||{};a.subject&&(l.subject=a.subject),a.body&&(l.body=a.body);var m=[];for(var n in l)l[n]!==U[n]&&m.push(n.replace($,ab).replace($,e).replace(aa,y)+"="+l[n].replace($,ab).replace($,e).replace(aa,y));return m.length&&(a.query=m.join("&")),a}},ad=/^([^\:]+)\:(.*)/,ae={scheme:"urn",parse:function(a,b){var c=a.path&&a.path.match(ad),d=a;if(c){var e=b.scheme||d.scheme||"urn",f=c[1].toLowerCase(),g=c[2],h=x[e+":"+(b.nid||f)];d.nid=f,d.nss=g,d.path=void 0,h&&(d=h.parse(d,b))}else d.error=d.error||"URN can not be parsed.";return d},serialize:function(a,b){var c=b.scheme||a.scheme||"urn",d=a.nid,e=x[c+":"+(b.nid||d)];e&&(a=e.serialize(a,b));var f=a,g=a.nss;return f.path=(d||b.nid)+":"+g,f}},af=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ag={scheme:"urn:uuid",parse:function(a,b){return a.uuid=a.nss,a.nss=void 0,b.tolerant||a.uuid&&a.uuid.match(af)||(a.error=a.error||"UUID is not valid."),a},serialize:function(a,b){return a.nss=(a.uuid||"").toLowerCase(),a}};x[P.scheme]=P,x[Q.scheme]=Q,x[S.scheme]=S,x[T.scheme]=T,x[ac.scheme]=ac,x[ae.scheme]=ae,x[ag.scheme]=ag,a.SCHEMES=x,a.pctEncChar=y,a.pctDecChars=z,a.parse=G,a.removeDotSegments=L,a.serialize=M,a.resolveComponents=N,a.resolve=function(a,b,c){var d=function(a,b){if(b)for(var c in b)a[c]=b[c];return a}({scheme:"null"},c);return M(N(G(a,d),G(b,d),d,!0),d)},a.normalize=function(a,b){return"string"==typeof a?a=M(G(a,b),b):"object"===d(a)&&(a=G(M(a,b),b)),a},a.equal=function(a,b,c){return"string"==typeof a?a=M(G(a,c),c):"object"===d(a)&&(a=M(a,c)),"string"==typeof b?b=M(G(b,c),c):"object"===d(b)&&(b=M(b,c)),a===b},a.escapeComponent=function(a,b){return a&&a.toString().replace(b&&b.iri?h.ESCAPE:g.ESCAPE,y)},a.unescapeComponent=O,Object.defineProperty(a,"__esModule",{value:!0})})}),an=al((a,b)=>{b.exports=function a(b,c){if(b===c)return!0;if(b&&c&&"object"==typeof b&&"object"==typeof c){if(b.constructor!==c.constructor)return!1;if(Array.isArray(b)){if((d=b.length)!=c.length)return!1;for(e=d;0!=e--;)if(!a(b[e],c[e]))return!1;return!0}if(b.constructor===RegExp)return b.source===c.source&&b.flags===c.flags;if(b.valueOf!==Object.prototype.valueOf)return b.valueOf()===c.valueOf();if(b.toString!==Object.prototype.toString)return b.toString()===c.toString();if((d=(f=Object.keys(b)).length)!==Object.keys(c).length)return!1;for(e=d;0!=e--;)if(!Object.prototype.hasOwnProperty.call(c,f[e]))return!1;for(e=d;0!=e--;){var d,e,f,g=f[e];if(!a(b[g],c[g]))return!1}return!0}return b!=b&&c!=c}}),ao=al((a,b)=>{b.exports=function(a){for(var b,c=0,d=a.length,e=0;e<d;)c++,(b=a.charCodeAt(e++))>=55296&&b<=56319&&e<d&&(64512&(b=a.charCodeAt(e)))==56320&&e++;return c}}),ap=al((a,b)=>{function c(a,b,c,d){var e=d?" !== ":" === ",f=d?" || ":" && ",g=d?"!":"",h=d?"":"!";switch(a){case"null":return b+e+"null";case"array":return g+"Array.isArray("+b+")";case"object":return"("+g+b+f+"typeof "+b+e+'"object"'+f+h+"Array.isArray("+b+"))";case"integer":return"(typeof "+b+e+'"number"'+f+h+"("+b+" % 1)"+f+b+e+b+(c?f+g+"isFinite("+b+")":"")+")";case"number":return"(typeof "+b+e+'"'+a+'"'+(c?f+g+"isFinite("+b+")":"")+")";default:return"typeof "+b+e+'"'+a+'"'}}b.exports={copy:function(a,b){for(var c in b=b||{},a)b[c]=a[c];return b},checkDataType:c,checkDataTypes:function(a,b,d){if(1===a.length)return c(a[0],b,d,!0);var f="",g=e(a);for(var h in g.array&&g.object&&(f=(g.null?"(":"(!"+b+" || ")+("typeof "+b)+' !== "object")',delete g.null,delete g.array,delete g.object),g.number&&delete g.integer,g)f+=(f?" && ":"")+c(h,b,d,!0);return f},coerceToTypes:function(a,b){if(Array.isArray(b)){for(var c=[],e=0;e<b.length;e++){var f=b[e];d[f]?c[c.length]=f:"array"===a&&"array"===f&&(c[c.length]=f)}if(c.length)return c}else if(d[b])return[b];else if("array"===a&&"array"===b)return["array"]},toHash:e,getProperty:h,escapeQuotes:i,equal:an(),ucs2length:ao(),varOccurences:function(a,b){b+="[^0-9]";var c=a.match(RegExp(b,"g"));return c?c.length:0},varReplace:function(a,b,c){return b+="([^0-9])",c=c.replace(/\$/g,"$$$$"),a.replace(RegExp(b,"g"),c+"$1")},schemaHasRules:function(a,b){if("boolean"==typeof a)return!a;for(var c in a)if(b[c])return!0},schemaHasRulesExcept:function(a,b,c){if("boolean"==typeof a)return!a&&"not"!=c;for(var d in a)if(d!=c&&b[d])return!0},schemaUnknownRules:function(a,b){if("boolean"!=typeof a){for(var c in a)if(!b[c])return c}},toQuotedString:j,getPathExpr:function(a,b,c,d){return m(a,c?"'/' + "+b+(d?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):d?"'[' + "+b+" + ']'":"'[\\'' + "+b+" + '\\']'")},getPath:function(a,b,c){return m(a,c?j("/"+n(b)):j(h(b)))},getData:function(a,b,c){if(""===a)return"rootData";if("/"==a[0]){if(!k.test(a))throw Error("Invalid JSON-pointer: "+a);e=a,f="rootData"}else{if(!(g=a.match(l)))throw Error("Invalid JSON-pointer: "+a);if(d=+g[1],"#"==(e=g[2])){if(d>=b)throw Error("Cannot access property/index "+d+" levels up, current level is "+b);return c[b-d]}if(d>b)throw Error("Cannot access data "+d+" levels up, current level is "+b);if(f="data"+(b-d||""),!e)return f}for(var d,e,f,g,i=f,j=e.split("/"),m=0;m<j.length;m++){var n=j[m];n&&(f+=h(o(n)),i+=" && "+f)}return i},unescapeFragment:function(a){return o(decodeURIComponent(a))},unescapeJsonPointer:o,escapeFragment:function(a){return encodeURIComponent(n(a))},escapeJsonPointer:n};var d=e(["string","number","integer","boolean","null"]);function e(a){for(var b={},c=0;c<a.length;c++)b[a[c]]=!0;return b}var f=/^[a-z$_][a-z$_0-9]*$/i,g=/'|\\/g;function h(a){return"number"==typeof a?"["+a+"]":f.test(a)?"."+a:"['"+i(a)+"']"}function i(a){return a.replace(g,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function j(a){return"'"+i(a)+"'"}var k=/^\/(?:[^~]|~0|~1)*$/,l=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function m(a,b){return'""'==a?b:(a+" + "+b).replace(/([^\\])' \+ '/g,"$1")}function n(a){return a.replace(/~/g,"~0").replace(/\//g,"~1")}function o(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}}),aq=al((a,b)=>{var c=ap();b.exports=function(a){c.copy(a,this)}}),ar=al((a,b)=>{var c=b.exports=function(a,b,d){"function"==typeof b&&(d=b,b={});var e="function"==typeof(d=b.cb||d)?d:d.pre||function(){};!function a(b,d,e,f,g,h,i,j,k,l){if(f&&"object"==typeof f&&!Array.isArray(f)){for(var m in d(f,g,h,i,j,k,l),f){var n=f[m];if(Array.isArray(n)){if(m in c.arrayKeywords)for(var o=0;o<n.length;o++)a(b,d,e,n[o],g+"/"+m+"/"+o,h,g,m,f,o)}else if(m in c.propsKeywords){if(n&&"object"==typeof n)for(var p in n)a(b,d,e,n[p],g+"/"+m+"/"+p.replace(/~/g,"~0").replace(/\//g,"~1"),h,g,m,f,p)}else(m in c.keywords||b.allKeys&&!(m in c.skipKeywords))&&a(b,d,e,n,g+"/"+m,h,g,m,f)}e(f,g,h,i,j,k,l)}}(b,e,d.post||function(){},a,"",a)};c.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},c.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},c.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},c.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}}),as=al((a,b)=>{var c=am(),d=an(),e=ap(),f=aq(),g=ar();function h(a,b,c){var d,e,g,j=this._refs[c];if("string"==typeof j)if(!this._refs[j])return h.call(this,a,b,j);else j=this._refs[j];if((j=j||this._schemas[c])instanceof f)return n(j.schema,this._opts.inlineRefs)?j.schema:j.validate||this._compile(j);var k=i.call(this,b,c);return k&&(d=k.schema,b=k.root,g=k.baseId),d instanceof f?e=d.validate||a.call(this,d.schema,b,void 0,g):void 0!==d&&(e=n(d,this._opts.inlineRefs)?d:a.call(this,d,b,void 0,g)),e}function i(a,b){var d=c.parse(b),e=p(d),g=o(this._getId(a.schema));if(0===Object.keys(a.schema).length||e!==g){var h=r(e),i=this._refs[h];if("string"==typeof i)return j.call(this,a,i,d);if(i instanceof f)i.validate||this._compile(i),a=i;else{if(!((i=this._schemas[h])instanceof f))return;if(i.validate||this._compile(i),h==r(b))return{schema:i,root:a,baseId:g};a=i}if(!a.schema)return;g=o(this._getId(a.schema))}return l.call(this,d,g,a.schema,a)}function j(a,b,c){var d=i.call(this,a,b);if(d){var e=d.schema,f=d.baseId;a=d.root;var g=this._getId(e);return g&&(f=s(f,g)),l.call(this,c,f,e,a)}}b.exports=h,h.normalizeId=r,h.fullPath=o,h.url=s,h.ids=function(a){var b=r(this._getId(a)),f={"":b},h={"":o(b,!1)},i={},j=this;return g(a,{allKeys:!0},function(a,b,g,k,l,m,n){if(""!==b){var o=j._getId(a),p=f[k],q=h[k]+"/"+l;if(void 0!==n&&(q+="/"+("number"==typeof n?n:e.escapeFragment(n))),"string"==typeof o){o=p=r(p?c.resolve(p,o):o);var s=j._refs[o];if("string"==typeof s&&(s=j._refs[s]),s&&s.schema){if(!d(a,s.schema))throw Error('id "'+o+'" resolves to more than one schema')}else if(o!=r(q))if("#"==o[0]){if(i[o]&&!d(a,i[o]))throw Error('id "'+o+'" resolves to more than one schema');i[o]=a}else j._refs[o]=q}f[b]=p,h[b]=q}}),i},h.inlineRef=n,h.schema=i;var k=e.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function l(a,b,c,d){if(a.fragment=a.fragment||"","/"==a.fragment.slice(0,1)){for(var f=a.fragment.split("/"),g=1;g<f.length;g++){var h=f[g];if(h){if(void 0===(c=c[h=e.unescapeFragment(h)]))break;if(!k[h]&&((j=this._getId(c))&&(b=s(b,j)),c.$ref)){var j,l=s(b,c.$ref),m=i.call(this,d,l);m&&(c=m.schema,d=m.root,b=m.baseId)}}}if(void 0!==c&&c!==d.schema)return{schema:c,root:d,baseId:b}}}var m=e.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function n(a,b){return!1!==b&&(void 0===b||!0===b?function a(b){var c;if(Array.isArray(b)){for(var d=0;d<b.length;d++)if("object"==typeof(c=b[d])&&!a(c))return!1}else for(var e in b)if("$ref"==e||"object"==typeof(c=b[e])&&!a(c))return!1;return!0}(a):b?function a(b){var c,d=0;if(Array.isArray(b)){for(var e=0;e<b.length;e++)if("object"==typeof(c=b[e])&&(d+=a(c)),d==1/0)return 1/0}else for(var f in b){if("$ref"==f)return 1/0;if(m[f])d++;else if("object"==typeof(c=b[f])&&(d+=a(c)+1),d==1/0)return 1/0}return d}(a)<=b:void 0)}function o(a,b){return!1!==b&&(a=r(a)),p(c.parse(a))}function p(a){return c.serialize(a).split("#")[0]+"#"}var q=/#\/?$/;function r(a){return a?a.replace(q,""):""}function s(a,b){return b=r(b),c.resolve(a,b)}}),at=al((a,b)=>{var c=as();function d(a,b,e){this.message=e||d.message(a,b),this.missingRef=c.url(a,b),this.missingSchema=c.normalizeId(c.fullPath(this.missingRef))}function e(a){return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}b.exports={Validation:e(function(a){this.message="validation failed",this.errors=a,this.ajv=this.validation=!0}),MissingRef:e(d)},d.message=function(a,b){return"can't resolve reference "+b+" from id "+a}}),au=al((a,b)=>{b.exports=function(a,b){b||(b={}),"function"==typeof b&&(b={cmp:b});var c,d="boolean"==typeof b.cycles&&b.cycles,e=b.cmp&&(c=b.cmp,function(a){return function(b,d){return c({key:b,value:a[b]},{key:d,value:a[d]})}}),f=[];return function a(b){if(b&&b.toJSON&&"function"==typeof b.toJSON&&(b=b.toJSON()),void 0!==b){if("number"==typeof b)return isFinite(b)?""+b:"null";if("object"!=typeof b)return JSON.stringify(b);if(Array.isArray(b)){for(c=0,g="[";c<b.length;c++)c&&(g+=","),g+=a(b[c])||"null";return g+"]"}if(null===b)return"null";if(-1!==f.indexOf(b)){if(d)return JSON.stringify("__cycle__");throw TypeError("Converting circular structure to JSON")}var c,g,h=f.push(b)-1,i=Object.keys(b).sort(e&&e(b));for(c=0,g="";c<i.length;c++){var j=i[c],k=a(b[j]);k&&(g&&(g+=","),g+=JSON.stringify(j)+":"+k)}return f.splice(h,1),"{"+g+"}"}}(a)}}),av=al((a,b)=>{b.exports=function(a,b,c){var d="",e=!0===a.schema.$async,f=a.util.schemaHasRulesExcept(a.schema,a.RULES.all,"$ref"),g=a.self._getId(a.schema);if(a.opts.strictKeywords){var h=a.util.schemaUnknownRules(a.schema,a.RULES.keywords);if(h){var i="unknown keyword: "+h;if("log"===a.opts.strictKeywords)a.logger.warn(i);else throw Error(i)}}if(a.isTop&&(d+=" var validate = ",e&&(a.async=!0,d+="async "),d+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",g&&(a.opts.sourceCode||a.opts.processCode)&&(d+=" /*# sourceURL="+g+" */ ")),"boolean"==typeof a.schema||!(f||a.schema.$ref)){var j,b="false schema",k=a.level,l=a.dataLevel,m=a.schema[b],n=a.schemaPath+a.util.getProperty(b),o=a.errSchemaPath+"/"+b,p=!a.opts.allErrors,q="data"+(l||""),r="valid"+k;if(!1===a.schema){a.isTop?p=!0:d+=" var "+r+" = false; ";var s=s||[];s.push(d),d="",!1!==a.createErrors?(d+=" { keyword: '"+(j||"false schema")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(o)+" , params: {} ",!1!==a.opts.messages&&(d+=" , message: 'boolean schema is false' "),a.opts.verbose&&(d+=" , schema: false , parentSchema: validate.schema"+a.schemaPath+" , data: "+q+" "),d+=" } "):d+=" {} ";var t=d;d=s.pop(),!a.compositeRule&&p?a.async?d+=" throw new ValidationError(["+t+"]); ":d+=" validate.errors = ["+t+"]; return false; ":d+=" var err = "+t+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else a.isTop?e?d+=" return data; ":d+=" validate.errors = null; return true; ":d+=" var "+r+" = true; ";return a.isTop&&(d+=" }; return validate; "),d}if(a.isTop){var u=a.isTop,k=a.level=0,l=a.dataLevel=0,q="data";if(a.rootId=a.resolve.fullPath(a.self._getId(a.root.schema)),a.baseId=a.baseId||a.rootId,delete a.isTop,a.dataPathArr=[""],void 0!==a.schema.default&&a.opts.useDefaults&&a.opts.strictDefaults){var v="default is ignored in the schema root";if("log"===a.opts.strictDefaults)a.logger.warn(v);else throw Error(v)}d+=" var vErrors = null; ",d+=" var errors = 0;     ",d+=" if (rootData === undefined) rootData = data; "}else{var{level:k,dataLevel:l}=a,q="data"+(l||"");if(g&&(a.baseId=a.resolve.url(a.baseId,g)),e&&!a.async)throw Error("async schema in sync schema");d+=" var errs_"+k+" = errors;"}var r="valid"+k,p=!a.opts.allErrors,w="",x="",y=a.schema.type,z=Array.isArray(y);if(y&&a.opts.nullable&&!0===a.schema.nullable&&(z?-1==y.indexOf("null")&&(y=y.concat("null")):"null"!=y&&(y=[y,"null"],z=!0)),z&&1==y.length&&(y=y[0],z=!1),a.schema.$ref&&f)if("fail"==a.opts.extendRefs)throw Error('$ref: validation keywords used in schema at path "'+a.errSchemaPath+'" (see option extendRefs)');else!0!==a.opts.extendRefs&&(f=!1,a.logger.warn('$ref: keywords ignored in schema at path "'+a.errSchemaPath+'"'));if(a.schema.$comment&&a.opts.$comment&&(d+=" "+a.RULES.all.$comment.code(a,"$comment")),y){if(a.opts.coerceTypes)var A=a.util.coerceToTypes(a.opts.coerceTypes,y);var B=a.RULES.types[y];if(A||z||!0===B||B&&!_(B)){var n=a.schemaPath+".type",o=a.errSchemaPath+"/type",n=a.schemaPath+".type",o=a.errSchemaPath+"/type",C=z?"checkDataTypes":"checkDataType";if(d+=" if ("+a.util[C](y,q,a.opts.strictNumbers,!0)+") { ",A){var D="dataType"+k,E="coerced"+k;d+=" var "+D+" = typeof "+q+"; var "+E+" = undefined; ","array"==a.opts.coerceTypes&&(d+=" if ("+D+" == 'object' && Array.isArray("+q+") && "+q+".length == 1) { "+q+" = "+q+"[0]; "+D+" = typeof "+q+"; if ("+a.util.checkDataType(a.schema.type,q,a.opts.strictNumbers)+") "+E+" = "+q+"; } "),d+=" if ("+E+" !== undefined) ; ";var F=A;if(F)for(var j,G,H=-1,I=F.length-1;H<I;)"string"==(G=F[H+=1])?d+=" else if ("+D+" == 'number' || "+D+" == 'boolean') "+E+" = '' + "+q+"; else if ("+q+" === null) "+E+" = ''; ":"number"==G||"integer"==G?(d+=" else if ("+D+" == 'boolean' || "+q+" === null || ("+D+" == 'string' && "+q+" && "+q+" == +"+q+" ","integer"==G&&(d+=" && !("+q+" % 1)"),d+=")) "+E+" = +"+q+"; "):"boolean"==G?d+=" else if ("+q+" === 'false' || "+q+" === 0 || "+q+" === null) "+E+" = false; else if ("+q+" === 'true' || "+q+" === 1) "+E+" = true; ":"null"==G?d+=" else if ("+q+" === '' || "+q+" === 0 || "+q+" === false) "+E+" = null; ":"array"==a.opts.coerceTypes&&"array"==G&&(d+=" else if ("+D+" == 'string' || "+D+" == 'number' || "+D+" == 'boolean' || "+q+" == null) "+E+" = ["+q+"]; ");d+=" else {   ";var s=s||[];s.push(d),d="",!1!==a.createErrors?(d+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(o)+" , params: { type: '",z?d+=""+y.join(","):d+=""+y,d+="' } ",!1!==a.opts.messages&&(d+=" , message: 'should be ",z?d+=""+y.join(","):d+=""+y,d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+q+" "),d+=" } "):d+=" {} ";var t=d;d=s.pop(),!a.compositeRule&&p?a.async?d+=" throw new ValidationError(["+t+"]); ":d+=" validate.errors = ["+t+"]; return false; ":d+=" var err = "+t+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } if ("+E+" !== undefined) {  ";var J=l?"data"+(l-1||""):"parentData",K=l?a.dataPathArr[l]:"parentDataProperty";d+=" "+q+" = "+E+"; ",l||(d+="if ("+J+" !== undefined)"),d+=" "+J+"["+K+"] = "+E+"; } "}else{var s=s||[];s.push(d),d="",!1!==a.createErrors?(d+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(o)+" , params: { type: '",z?d+=""+y.join(","):d+=""+y,d+="' } ",!1!==a.opts.messages&&(d+=" , message: 'should be ",z?d+=""+y.join(","):d+=""+y,d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+q+" "),d+=" } "):d+=" {} ";var t=d;d=s.pop(),!a.compositeRule&&p?a.async?d+=" throw new ValidationError(["+t+"]); ":d+=" validate.errors = ["+t+"]; return false; ":d+=" var err = "+t+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}d+=" } "}}if(a.schema.$ref&&!f)d+=" "+a.RULES.all.$ref.code(a,"$ref")+" ",p&&(d+=" } if (errors === ",u?d+="0":d+="errs_"+k,d+=") { ",x+="}");else{var L=a.RULES;if(L){for(var B,M=-1,N=L.length-1;M<N;)if(_(B=L[M+=1])){if(B.type&&(d+=" if ("+a.util.checkDataType(B.type,q,a.opts.strictNumbers)+") { "),a.opts.useDefaults){if("object"==B.type&&a.schema.properties){var m=a.schema.properties,O=Object.keys(m);if(O)for(var P,Q=-1,R=O.length-1;Q<R;){var S=m[P=O[Q+=1]];if(void 0!==S.default){var T=q+a.util.getProperty(P);if(a.compositeRule){if(a.opts.strictDefaults){var v="default is ignored for: "+T;if("log"===a.opts.strictDefaults)a.logger.warn(v);else throw Error(v)}}else d+=" if ("+T+" === undefined ","empty"==a.opts.useDefaults&&(d+=" || "+T+" === null || "+T+" === '' "),d+=" ) "+T+" = ","shared"==a.opts.useDefaults?d+=" "+a.useDefault(S.default)+" ":d+=" "+JSON.stringify(S.default)+" ",d+="; "}}}else if("array"==B.type&&Array.isArray(a.schema.items)){var U=a.schema.items;if(U){for(var S,H=-1,V=U.length-1;H<V;)if(void 0!==(S=U[H+=1]).default){var T=q+"["+H+"]";if(a.compositeRule){if(a.opts.strictDefaults){var v="default is ignored for: "+T;if("log"===a.opts.strictDefaults)a.logger.warn(v);else throw Error(v)}}else d+=" if ("+T+" === undefined ","empty"==a.opts.useDefaults&&(d+=" || "+T+" === null || "+T+" === '' "),d+=" ) "+T+" = ","shared"==a.opts.useDefaults?d+=" "+a.useDefault(S.default)+" ":d+=" "+JSON.stringify(S.default)+" ",d+="; "}}}}var W=B.rules;if(W){for(var X,Y=-1,Z=W.length-1;Y<Z;)if(aa(X=W[Y+=1])){var $=X.code(a,X.keyword,B.type);$&&(d+=" "+$+" ",p&&(w+="}"))}}if(p&&(d+=" "+w+" ",w=""),B.type&&(d+=" } ",y&&y===B.type&&!A)){d+=" else { ";var n=a.schemaPath+".type",o=a.errSchemaPath+"/type",s=s||[];s.push(d),d="",!1!==a.createErrors?(d+=" { keyword: '"+(j||"type")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(o)+" , params: { type: '",z?d+=""+y.join(","):d+=""+y,d+="' } ",!1!==a.opts.messages&&(d+=" , message: 'should be ",z?d+=""+y.join(","):d+=""+y,d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+n+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+q+" "),d+=" } "):d+=" {} ";var t=d;d=s.pop(),!a.compositeRule&&p?a.async?d+=" throw new ValidationError(["+t+"]); ":d+=" validate.errors = ["+t+"]; return false; ":d+=" var err = "+t+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } "}p&&(d+=" if (errors === ",u?d+="0":d+="errs_"+k,d+=") { ",x+="}")}}}function _(a){for(var b=a.rules,c=0;c<b.length;c++)if(aa(b[c]))return!0}function aa(b){return void 0!==a.schema[b.keyword]||b.implements&&function(b){for(var c=b.implements,d=0;d<c.length;d++)if(void 0!==a.schema[c[d]])return!0}(b)}return p&&(d+=" "+x+" "),u?(e?(d+=" if (errors === 0) return data;           ",d+=" else throw new ValidationError(vErrors); "):(d+=" validate.errors = vErrors; ",d+=" return errors === 0;       "),d+=" }; return validate;"):d+=" var "+r+" = errors === errs_"+k+";",d}}),aw=al((a,b)=>{var c=as(),d=ap(),e=at(),f=au(),g=av(),h=d.ucs2length,i=an(),j=e.Validation;function k(a,b,c){var d=m.call(this,a,b,c);return d>=0?{index:d,compiling:!0}:(d=this._compilations.length,this._compilations[d]={schema:a,root:b,baseId:c},{index:d,compiling:!1})}function l(a,b,c){var d=m.call(this,a,b,c);d>=0&&this._compilations.splice(d,1)}function m(a,b,c){for(var d=0;d<this._compilations.length;d++){var e=this._compilations[d];if(e.schema==a&&e.root==b&&e.baseId==c)return d}return -1}function n(a,b){return"var pattern"+a+" = new RegExp("+d.toQuotedString(b[a])+");"}function o(a){return"var default"+a+" = defaults["+a+"];"}function p(a,b){return void 0===b[a]?"":"var refVal"+a+" = refVal["+a+"];"}function q(a){return"var customRule"+a+" = customRules["+a+"];"}function r(a,b){if(!a.length)return"";for(var c="",d=0;d<a.length;d++)c+=b(d,a);return c}b.exports=function a(b,m,s,t){var u=this,v=this._opts,w=[void 0],x={},y=[],z={},A=[],B={},C=[];m=m||{schema:b,refVal:w,refs:x};var D=k.call(this,b,m,t),E=this._compilations[D.index];if(D.compiling)return E.callValidate=J;var F=this._formats,G=this.RULES;try{var H=K(b,m,s,t);E.validate=H;var I=E.callValidate;return I&&(I.schema=H.schema,I.errors=null,I.refs=H.refs,I.refVal=H.refVal,I.root=H.root,I.$async=H.$async,v.sourceCode&&(I.source=H.source)),H}finally{l.call(this,b,m,t)}function J(){var a=E.validate,b=a.apply(this,arguments);return J.errors=a.errors,b}function K(b,f,k,l){var s,t=!f||f&&f.schema==b;if(f.schema!=m.schema)return a.call(u,b,f,k,l);var z=!0===b.$async,B=g({isTop:!0,schema:b,isRoot:t,baseId:l,root:f,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:e.MissingRef,RULES:G,validate:g,util:d,resolve:c,resolveRef:L,usePattern:O,useDefault:P,useCustomRule:Q,opts:v,formats:F,logger:u.logger,self:u});B=r(w,p)+r(y,n)+r(A,o)+r(C,q)+B,v.processCode&&(B=v.processCode(B,b));try{s=Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",B)(u,G,F,m,w,A,C,i,h,j),w[0]=s}catch(a){throw u.logger.error("Error compiling schema, function code:",B),a}return s.schema=b,s.errors=null,s.refs=x,s.refVal=w,s.root=t?s:f,z&&(s.$async=!0),!0===v.sourceCode&&(s.source={code:B,patterns:y,defaults:A}),s}function L(b,d,e){var f,g,h,i,j,k=x[d=c.url(b,d)];if(void 0!==k)return N(i=w[k],j="refVal["+k+"]");if(!e&&m.refs){var l=m.refs[d];if(void 0!==l)return j=M(d,i=m.refVal[l]),N(i,j)}j=M(d);var n=c.call(u,K,m,d);if(void 0===n){var o=s&&s[d];o&&(n=c.inlineRef(o,v.inlineRefs)?o:a.call(u,o,m,s,b))}if(void 0!==n){return f=d,g=n,w[x[f]]=g,N(n,j)}h=d,delete x[h]}function M(a,b){var c=w.length;return w[c]=b,x[a]=c,"refVal"+c}function N(a,b){return"object"==typeof a||"boolean"==typeof a?{code:b,schema:a,inline:!0}:{code:b,$async:a&&!!a.$async}}function O(a){var b=z[a];return void 0===b&&(b=z[a]=y.length,y[b]=a),"pattern"+b}function P(a){switch(typeof a){case"boolean":case"number":return""+a;case"string":return d.toQuotedString(a);case"object":if(null===a)return"null";var b=f(a),c=B[b];return void 0===c&&(c=B[b]=A.length,A[c]=a),"default"+c}}function Q(a,b,c,d){if(!1!==u._opts.validateSchema){var e,f=a.definition.dependencies;if(f&&!f.every(function(a){return Object.prototype.hasOwnProperty.call(c,a)}))throw Error("parent schema must have all required keywords: "+f.join(","));var g=a.definition.validateSchema;if(g&&!g(b)){var h="keyword schema is invalid: "+u.errorsText(g.errors);if("log"==u._opts.validateSchema)u.logger.error(h);else throw Error(h)}}var i=a.definition.compile,j=a.definition.inline,k=a.definition.macro;if(i)e=i.call(u,b,c,d);else if(k)e=k.call(u,b,c,d),!1!==v.validateSchema&&u.validateSchema(e,!0);else if(j)e=j.call(u,d,a.keyword,b,c);else if(!(e=a.definition.validate))return;if(void 0===e)throw Error('custom keyword "'+a.keyword+'"failed to compile');var l=C.length;return C[l]=e,{code:"customRule"+l,validate:e}}}}),ax=al((a,b)=>{var c=b.exports=function(){this._cache={}};c.prototype.put=function(a,b){this._cache[a]=b},c.prototype.get=function(a){return this._cache[a]},c.prototype.del=function(a){delete this._cache[a]},c.prototype.clear=function(){this._cache={}}}),ay=al((a,b)=>{var c=ap(),d=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,e=[0,31,28,31,30,31,30,31,31,30,31,30,31],f=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,g=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,h=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,i=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,j=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,k=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,l=/^(?:\/(?:[^~/]|~0|~1)*)*$/,m=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,n=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function o(a){return a="full"==a?"full":"fast",c.copy(o[a])}function p(a){var b,c=a.match(d);if(!c)return!1;var f=+c[1],g=+c[2],h=+c[3];return g>=1&&g<=12&&h>=1&&h<=(2==g&&(b=f)%4==0&&(b%100!=0||b%400==0)?29:e[g])}function q(a,b){var c=a.match(f);if(!c)return!1;var d=c[1],e=c[2],g=c[3],h=c[5];return(d<=23&&e<=59&&g<=59||23==d&&59==e&&60==g)&&(!b||h)}b.exports=o,o.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":i,url:j,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:g,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:k,"json-pointer":l,"json-pointer-uri-fragment":m,"relative-json-pointer":n},o.full={date:p,time:q,"date-time":function(a){var b=a.split(r);return 2==b.length&&p(b[0])&&q(b[1],!0)},uri:function(a){return s.test(a)&&h.test(a)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":i,url:j,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:g,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:u,uuid:k,"json-pointer":l,"json-pointer-uri-fragment":m,"relative-json-pointer":n};var r=/t|\s/i,s=/\/|:/,t=/[^\\]\\Z/;function u(a){if(t.test(a))return!1;try{return new RegExp(a),!0}catch(a){return!1}}}),az=al((a,b)=>{b.exports=function(a,b,c){var d,e,f=" ",g=a.level,h=a.dataLevel,i=a.schema[b],j=a.errSchemaPath+"/"+b,k=!a.opts.allErrors,l="data"+(h||""),m="valid"+g;if("#"==i||"#/"==i)a.isRoot?(d=a.async,e="validate"):(d=!0===a.root.schema.$async,e="root.refVal[0]");else{var n=a.resolveRef(a.baseId,i,a.isRoot);if(void 0===n){var o=a.MissingRefError.message(a.baseId,i);if("fail"==a.opts.missingRefs){a.logger.error(o);var p=p||[];p.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(j)+" , params: { ref: '"+a.util.escapeQuotes(i)+"' } ",!1!==a.opts.messages&&(f+=" , message: 'can\\'t resolve reference "+a.util.escapeQuotes(i)+"' "),a.opts.verbose&&(f+=" , schema: "+a.util.toQuotedString(i)+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+l+" "),f+=" } "):f+=" {} ";var q=f;f=p.pop(),!a.compositeRule&&k?a.async?f+=" throw new ValidationError(["+q+"]); ":f+=" validate.errors = ["+q+"]; return false; ":f+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",k&&(f+=" if (false) { ")}else if("ignore"==a.opts.missingRefs)a.logger.warn(o),k&&(f+=" if (true) { ");else throw new a.MissingRefError(a.baseId,i,o)}else if(n.inline){var r=a.util.copy(a);r.level++;var s="valid"+r.level;r.schema=n.schema,r.schemaPath="",r.errSchemaPath=i,f+=" "+a.validate(r).replace(/validate\.schema/g,n.code)+" ",k&&(f+=" if ("+s+") { ")}else d=!0===n.$async||a.async&&!1!==n.$async,e=n.code}if(e){var p=p||[];p.push(f),f="",a.opts.passContext?f+=" "+e+".call(this, ":f+=" "+e+"( ",f+=" "+l+", (dataPath || '')",'""'!=a.errorPath&&(f+=" + "+a.errorPath);var t=h?a.dataPathArr[h]:"parentDataProperty",u=f+=" , "+(h?"data"+(h-1||""):"parentData")+" , "+t+", rootData)  ";if(f=p.pop(),d){if(!a.async)throw Error("async schema referenced by sync schema");k&&(f+=" var "+m+"; "),f+=" try { await "+u+"; ",k&&(f+=" "+m+" = true; "),f+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",k&&(f+=" "+m+" = false; "),f+=" } ",k&&(f+=" if ("+m+") { ")}else f+=" if (!"+u+") { if (vErrors === null) vErrors = "+e+".errors; else vErrors = vErrors.concat("+e+".errors); errors = vErrors.length; } ",k&&(f+=" else { ")}return f}}),aA=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.schema[b],f=a.schemaPath+a.util.getProperty(b),g=a.errSchemaPath+"/"+b,h=!a.opts.allErrors,i=a.util.copy(a),j="";i.level++;var k="valid"+i.level,l=i.baseId,m=!0;if(e)for(var n,o=-1,p=e.length-1;o<p;)n=e[o+=1],(a.opts.strictKeywords?"object"==typeof n&&Object.keys(n).length>0||!1===n:a.util.schemaHasRules(n,a.RULES.all))&&(m=!1,i.schema=n,i.schemaPath=f+"["+o+"]",i.errSchemaPath=g+"/"+o,d+="  "+a.validate(i)+" ",i.baseId=l,h&&(d+=" if ("+k+") { ",j+="}"));return h&&(m?d+=" if (true) { ":d+=" "+j.slice(0,-1)+" "),d}}),aB=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="valid"+e,l="errs__"+e,m=a.util.copy(a),n="";m.level++;var o="valid"+m.level;if(g.every(function(b){return a.opts.strictKeywords?"object"==typeof b&&Object.keys(b).length>0||!1===b:a.util.schemaHasRules(b,a.RULES.all)})){var p=m.baseId;d+=" var "+l+" = errors; var "+k+" = false;  ";var q=a.compositeRule;if(a.compositeRule=m.compositeRule=!0,g)for(var r=-1,s=g.length-1;r<s;)m.schema=g[r+=1],m.schemaPath=h+"["+r+"]",m.errSchemaPath=i+"/"+r,d+="  "+a.validate(m)+" ",m.baseId=p,d+=" "+k+" = "+k+" || "+o+"; if (!"+k+") { ",n+="}";a.compositeRule=m.compositeRule=q,d+=" "+n+" if (!"+k+") {   var err =   ",!1!==a.createErrors?(d+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: {} ",!1!==a.opts.messages&&(d+=" , message: 'should match some schema in anyOf' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: data"+(f||"")+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!a.compositeRule&&j&&(a.async?d+=" throw new ValidationError(vErrors); ":d+=" validate.errors = vErrors; return false; "),d+=" } else {  errors = "+l+"; if (vErrors !== null) { if ("+l+") vErrors.length = "+l+"; else vErrors = null; } ",a.opts.allErrors&&(d+=" } ")}else j&&(d+=" if (true) { ");return d}}),aC=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.schema[b],f=a.errSchemaPath+"/"+b;a.opts.allErrors;var g=a.util.toQuotedString(e);return!0===a.opts.$comment?d+=" console.log("+g+");":"function"==typeof a.opts.$comment&&(d+=" self._opts.$comment("+g+", "+a.util.toQuotedString(f)+", validate.root.schema);"),d}}),aD=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="valid"+e,m=a.opts.$data&&g&&g.$data;m&&(d+=" var schema"+e+" = "+a.util.getData(g.$data,f,a.dataPathArr)+"; "),m||(d+=" var schema"+e+" = validate.schema"+h+";"),d+="var "+l+" = equal("+k+", schema"+e+"); if (!"+l+") {   ";var n=n||[];n.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'const' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { allowedValue: schema"+e+" } ",!1!==a.opts.messages&&(d+=" , message: 'should be equal to constant' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var o=d;return d=n.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+o+"]); ":d+=" validate.errors = ["+o+"]; return false; ":d+=" var err = "+o+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" }",j&&(d+=" else { "),d}}),aE=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="errs__"+e,m=a.util.copy(a);m.level++;var n="valid"+m.level,o="i"+e,p=m.dataLevel=a.dataLevel+1,q="data"+p,r=a.baseId,s=a.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:a.util.schemaHasRules(g,a.RULES.all);if(d+="var "+l+" = errors;var valid"+e+";",s){var t=a.compositeRule;a.compositeRule=m.compositeRule=!0,m.schema=g,m.schemaPath=h,m.errSchemaPath=i,d+=" var "+n+" = false; for (var "+o+" = 0; "+o+" < "+k+".length; "+o+"++) { ",m.errorPath=a.util.getPathExpr(a.errorPath,o,a.opts.jsonPointers,!0);var u=k+"["+o+"]";m.dataPathArr[p]=o;var v=a.validate(m);m.baseId=r,2>a.util.varOccurences(v,q)?d+=" "+a.util.varReplace(v,q,u)+" ":d+=" var "+q+" = "+u+"; "+v+" ",d+=" if ("+n+") break; }  ",a.compositeRule=m.compositeRule=t,d+="  if (!"+n+") {"}else d+=" if ("+k+".length == 0) {";var w=w||[];w.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: {} ",!1!==a.opts.messages&&(d+=" , message: 'should contain a valid item' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var x=d;return d=w.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+x+"]); ":d+=" validate.errors = ["+x+"]; return false; ":d+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } else { ",s&&(d+="  errors = "+l+"; if (vErrors !== null) { if ("+l+") vErrors.length = "+l+"; else vErrors = null; } "),a.opts.allErrors&&(d+=" } "),d}}),aF=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="errs__"+e,m=a.util.copy(a),n="";m.level++;var o="valid"+m.level,p={},q={},r=a.opts.ownProperties;for(v in g)if("__proto__"!=v){var s=g[v],t=Array.isArray(s)?q:p;t[v]=s}d+="var "+l+" = errors;";var u=a.errorPath;for(var v in d+="var missing"+e+";",q)if((t=q[v]).length){if(d+=" if ( "+k+a.util.getProperty(v)+" !== undefined ",r&&(d+=" && Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(v)+"') "),j){d+=" && ( ";var w=t;if(w)for(var x,y=-1,z=w.length-1;y<z;){x=w[y+=1],y&&(d+=" || ");var A=a.util.getProperty(x),B=k+A;d+=" ( ( "+B+" === undefined ",r&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(x)+"') "),d+=") && (missing"+e+" = "+a.util.toQuotedString(a.opts.jsonPointers?x:A)+") ) "}d+=")) {  ";var C="missing"+e,D="' + "+C+" + '";a.opts._errorDataPathProperty&&(a.errorPath=a.opts.jsonPointers?a.util.getPathExpr(u,C,!0):u+" + "+C);var E=E||[];E.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { property: '"+a.util.escapeQuotes(v)+"', missingProperty: '"+D+"', depsCount: "+t.length+", deps: '"+a.util.escapeQuotes(1==t.length?t[0]:t.join(", "))+"' } ",!1!==a.opts.messages&&(d+=" , message: 'should have ",1==t.length?d+="property "+a.util.escapeQuotes(t[0]):d+="properties "+a.util.escapeQuotes(t.join(", ")),d+=" when property "+a.util.escapeQuotes(v)+" is present' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var F=d;d=E.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+F+"]); ":d+=" validate.errors = ["+F+"]; return false; ":d+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{d+=" ) { ";var G=t;if(G)for(var x,H=-1,I=G.length-1;H<I;){x=G[H+=1];var A=a.util.getProperty(x),D=a.util.escapeQuotes(x),B=k+A;a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPath(u,x,a.opts.jsonPointers)),d+=" if ( "+B+" === undefined ",r&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(x)+"') "),d+=") {  var err =   ",!1!==a.createErrors?(d+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { property: '"+a.util.escapeQuotes(v)+"', missingProperty: '"+D+"', depsCount: "+t.length+", deps: '"+a.util.escapeQuotes(1==t.length?t[0]:t.join(", "))+"' } ",!1!==a.opts.messages&&(d+=" , message: 'should have ",1==t.length?d+="property "+a.util.escapeQuotes(t[0]):d+="properties "+a.util.escapeQuotes(t.join(", ")),d+=" when property "+a.util.escapeQuotes(v)+" is present' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}d+=" }   ",j&&(n+="}",d+=" else { ")}a.errorPath=u;var J=m.baseId;for(var v in p){var s=p[v];(a.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0||!1===s:a.util.schemaHasRules(s,a.RULES.all))&&(d+=" "+o+" = true; if ( "+k+a.util.getProperty(v)+" !== undefined ",r&&(d+=" && Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(v)+"') "),d+=") { ",m.schema=s,m.schemaPath=h+a.util.getProperty(v),m.errSchemaPath=i+"/"+a.util.escapeFragment(v),d+="  "+a.validate(m)+" ",m.baseId=J,d+=" }  ",j&&(d+=" if ("+o+") { ",n+="}"))}return j&&(d+="   "+n+" if ("+l+" == errors) {"),d}}),aG=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="valid"+e,m=a.opts.$data&&g&&g.$data;m&&(d+=" var schema"+e+" = "+a.util.getData(g.$data,f,a.dataPathArr)+"; ");var n="i"+e,o="schema"+e;m||(d+=" var "+o+" = validate.schema"+h+";"),d+="var "+l+";",m&&(d+=" if (schema"+e+" === undefined) "+l+" = true; else if (!Array.isArray(schema"+e+")) "+l+" = false; else {"),d+=""+l+" = false;for (var "+n+"=0; "+n+"<"+o+".length; "+n+"++) if (equal("+k+", "+o+"["+n+"])) { "+l+" = true; break; }",m&&(d+="  }  "),d+=" if (!"+l+") {   ";var p=p||[];p.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { allowedValues: schema"+e+" } ",!1!==a.opts.messages&&(d+=" , message: 'should be equal to one of the allowed values' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var q=d;return d=p.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+q+"]); ":d+=" validate.errors = ["+q+"]; return false; ":d+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" }",j&&(d+=" else { "),d}}),aH=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||"");if(!1===a.opts.format)return j&&(d+=" if (true) { "),d;var l,m=a.opts.$data&&g&&g.$data;m?(d+=" var schema"+e+" = "+a.util.getData(g.$data,f,a.dataPathArr)+"; ",l="schema"+e):l=g;var n=a.opts.unknownFormats,o=Array.isArray(n);if(m){var p="format"+e,q="isObject"+e,r="formatType"+e;d+=" var "+p+" = formats["+l+"]; var "+q+" = typeof "+p+" == 'object' && !("+p+" instanceof RegExp) && "+p+".validate; var "+r+" = "+q+" && "+p+".type || 'string'; if ("+q+") { ",a.async&&(d+=" var async"+e+" = "+p+".async; "),d+=" "+p+" = "+p+".validate; } if (  ",m&&(d+=" ("+l+" !== undefined && typeof "+l+" != 'string') || "),d+=" (","ignore"!=n&&(d+=" ("+l+" && !"+p+" ",o&&(d+=" && self._opts.unknownFormats.indexOf("+l+") == -1 "),d+=") || "),d+=" ("+p+" && "+r+" == '"+c+"' && !(typeof "+p+" == 'function' ? ",a.async?d+=" (async"+e+" ? await "+p+"("+k+") : "+p+"("+k+")) ":d+=" "+p+"("+k+") ",d+=" : "+p+".test("+k+"))))) {"}else{var p=a.formats[g];if(!p)if("ignore"==n)return a.logger.warn('unknown format "'+g+'" ignored in schema at path "'+a.errSchemaPath+'"'),j&&(d+=" if (true) { "),d;else if(o&&n.indexOf(g)>=0)return j&&(d+=" if (true) { "),d;else throw Error('unknown format "'+g+'" is used in schema at path "'+a.errSchemaPath+'"');var q="object"==typeof p&&!(p instanceof RegExp)&&p.validate,r=q&&p.type||"string";if(q){var s=!0===p.async;p=p.validate}if(r!=c)return j&&(d+=" if (true) { "),d;if(s){if(!a.async)throw Error("async format in sync schema");var t="formats"+a.util.getProperty(g)+".validate";d+=" if (!(await "+t+"("+k+"))) { "}else{d+=" if (! ";var t="formats"+a.util.getProperty(g);q&&(t+=".validate"),"function"==typeof p?d+=" "+t+"("+k+") ":d+=" "+t+".test("+k+") ",d+=") { "}}var u=u||[];u.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'format' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { format:  ",m?d+=""+l:d+=""+a.util.toQuotedString(g),d+="  } ",!1!==a.opts.messages&&(d+=" , message: 'should match format \"",m?d+="' + "+l+" + '":d+=""+a.util.escapeQuotes(g),d+="\"' "),a.opts.verbose&&(d+=" , schema:  ",m?d+="validate.schema"+h:d+=""+a.util.toQuotedString(g),d+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var v=d;return d=u.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+v+"]); ":d+=" validate.errors = ["+v+"]; return false; ":d+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } ",j&&(d+=" else { "),d}}),aI=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="valid"+e,l="errs__"+e,m=a.util.copy(a);m.level++;var n="valid"+m.level,o=a.schema.then,p=a.schema.else,q=void 0!==o&&(a.opts.strictKeywords?"object"==typeof o&&Object.keys(o).length>0||!1===o:a.util.schemaHasRules(o,a.RULES.all)),r=void 0!==p&&(a.opts.strictKeywords?"object"==typeof p&&Object.keys(p).length>0||!1===p:a.util.schemaHasRules(p,a.RULES.all)),s=m.baseId;if(q||r){m.createErrors=!1,m.schema=g,m.schemaPath=h,m.errSchemaPath=i,d+=" var "+l+" = errors; var "+k+" = true;  ";var t,u=a.compositeRule;a.compositeRule=m.compositeRule=!0,d+="  "+a.validate(m)+" ",m.baseId=s,m.createErrors=!0,d+="  errors = "+l+"; if (vErrors !== null) { if ("+l+") vErrors.length = "+l+"; else vErrors = null; }  ",a.compositeRule=m.compositeRule=u,q?(d+=" if ("+n+") {  ",m.schema=a.schema.then,m.schemaPath=a.schemaPath+".then",m.errSchemaPath=a.errSchemaPath+"/then",d+="  "+a.validate(m)+" ",m.baseId=s,d+=" "+k+" = "+n+"; ",q&&r?d+=" var "+(t="ifClause"+e)+" = 'then'; ":t="'then'",d+=" } ",r&&(d+=" else { ")):d+=" if (!"+n+") { ",r&&(m.schema=a.schema.else,m.schemaPath=a.schemaPath+".else",m.errSchemaPath=a.errSchemaPath+"/else",d+="  "+a.validate(m)+" ",m.baseId=s,d+=" "+k+" = "+n+"; ",q&&r?d+=" var "+(t="ifClause"+e)+" = 'else'; ":t="'else'",d+=" } "),d+=" if (!"+k+") {   var err =   ",!1!==a.createErrors?(d+=" { keyword: 'if' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { failingKeyword: "+t+" } ",!1!==a.opts.messages&&(d+=" , message: 'should match \"' + "+t+" + '\" schema' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: data"+(f||"")+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!a.compositeRule&&j&&(a.async?d+=" throw new ValidationError(vErrors); ":d+=" validate.errors = vErrors; return false; "),d+=" }   ",j&&(d+=" else { ")}else j&&(d+=" if (true) { ");return d}}),aJ=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="valid"+e,m="errs__"+e,n=a.util.copy(a),o="";n.level++;var p="valid"+n.level,q="i"+e,r=n.dataLevel=a.dataLevel+1,s="data"+r,t=a.baseId;if(d+="var "+m+" = errors;var "+l+";",Array.isArray(g)){var u=a.schema.additionalItems;if(!1===u){d+=" "+l+" = "+k+".length <= "+g.length+"; ";var v=i;i=a.errSchemaPath+"/additionalItems",d+="  if (!"+l+") {   ";var w=w||[];w.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { limit: "+g.length+" } ",!1!==a.opts.messages&&(d+=" , message: 'should NOT have more than "+g.length+" items' "),a.opts.verbose&&(d+=" , schema: false , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var x=d;d=w.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+x+"]); ":d+=" validate.errors = ["+x+"]; return false; ":d+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } ",i=v,j&&(o+="}",d+=" else { ")}if(g){for(var y,z=-1,A=g.length-1;z<A;)if(y=g[z+=1],a.opts.strictKeywords?"object"==typeof y&&Object.keys(y).length>0||!1===y:a.util.schemaHasRules(y,a.RULES.all)){d+=" "+p+" = true; if ("+k+".length > "+z+") { ";var B=k+"["+z+"]";n.schema=y,n.schemaPath=h+"["+z+"]",n.errSchemaPath=i+"/"+z,n.errorPath=a.util.getPathExpr(a.errorPath,z,a.opts.jsonPointers,!0),n.dataPathArr[r]=z;var C=a.validate(n);n.baseId=t,2>a.util.varOccurences(C,s)?d+=" "+a.util.varReplace(C,s,B)+" ":d+=" var "+s+" = "+B+"; "+C+" ",d+=" }  ",j&&(d+=" if ("+p+") { ",o+="}")}}if("object"==typeof u&&(a.opts.strictKeywords?"object"==typeof u&&Object.keys(u).length>0||!1===u:a.util.schemaHasRules(u,a.RULES.all))){n.schema=u,n.schemaPath=a.schemaPath+".additionalItems",n.errSchemaPath=a.errSchemaPath+"/additionalItems",d+=" "+p+" = true; if ("+k+".length > "+g.length+") {  for (var "+q+" = "+g.length+"; "+q+" < "+k+".length; "+q+"++) { ",n.errorPath=a.util.getPathExpr(a.errorPath,q,a.opts.jsonPointers,!0);var B=k+"["+q+"]";n.dataPathArr[r]=q;var C=a.validate(n);n.baseId=t,2>a.util.varOccurences(C,s)?d+=" "+a.util.varReplace(C,s,B)+" ":d+=" var "+s+" = "+B+"; "+C+" ",j&&(d+=" if (!"+p+") break; "),d+=" } }  ",j&&(d+=" if ("+p+") { ",o+="}")}}else if(a.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:a.util.schemaHasRules(g,a.RULES.all)){n.schema=g,n.schemaPath=h,n.errSchemaPath=i,d+="  for (var "+q+" = 0; "+q+" < "+k+".length; "+q+"++) { ",n.errorPath=a.util.getPathExpr(a.errorPath,q,a.opts.jsonPointers,!0);var B=k+"["+q+"]";n.dataPathArr[r]=q;var C=a.validate(n);n.baseId=t,2>a.util.varOccurences(C,s)?d+=" "+a.util.varReplace(C,s,B)+" ":d+=" var "+s+" = "+B+"; "+C+" ",j&&(d+=" if (!"+p+") break; "),d+=" }"}return j&&(d+=" "+o+" if ("+m+" == errors) {"),d}}),aK=al((a,b)=>{b.exports=function(a,b,c){var d,e,f=" ",g=a.level,h=a.dataLevel,i=a.schema[b],j=a.schemaPath+a.util.getProperty(b),k=a.errSchemaPath+"/"+b,l=!a.opts.allErrors,m="data"+(h||""),n=a.opts.$data&&i&&i.$data;n?(f+=" var schema"+g+" = "+a.util.getData(i.$data,h,a.dataPathArr)+"; ",e="schema"+g):e=i;var o="maximum"==b,p=o?"exclusiveMaximum":"exclusiveMinimum",q=a.schema[p],r=a.opts.$data&&q&&q.$data,s=o?"<":">",t=o?">":"<",d=void 0;if(!(n||"number"==typeof i||void 0===i))throw Error(b+" must be number");if(!(r||void 0===q||"number"==typeof q||"boolean"==typeof q))throw Error(p+" must be number or boolean");if(r){var u=a.util.getData(q.$data,h,a.dataPathArr),v="exclusive"+g,w="exclType"+g,x="exclIsNumber"+g,y="op"+g,z="' + "+y+" + '";f+=" var schemaExcl"+g+" = "+u+"; ",f+=" var "+v+"; var "+w+" = typeof "+(u="schemaExcl"+g)+"; if ("+w+" != 'boolean' && "+w+" != 'undefined' && "+w+" != 'number') { ";var d=p,A=A||[];A.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '"+(d||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(k)+" , params: {} ",!1!==a.opts.messages&&(f+=" , message: '"+p+" should be boolean' "),a.opts.verbose&&(f+=" , schema: validate.schema"+j+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";var B=f;f=A.pop(),!a.compositeRule&&l?a.async?f+=" throw new ValidationError(["+B+"]); ":f+=" validate.errors = ["+B+"]; return false; ":f+=" var err = "+B+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" } else if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),f+=" "+w+" == 'number' ? ( ("+v+" = "+e+" === undefined || "+u+" "+s+"= "+e+") ? "+m+" "+t+"= "+u+" : "+m+" "+t+" "+e+" ) : ( ("+v+" = "+u+" === true) ? "+m+" "+t+"= "+e+" : "+m+" "+t+" "+e+" ) || "+m+" !== "+m+") { var op"+g+" = "+v+" ? '"+s+"' : '"+s+"='; ",void 0===i&&(d=p,k=a.errSchemaPath+"/"+p,e=u,n=r)}else{var x="number"==typeof q,z=s;if(x&&n){var y="'"+z+"'";f+=" if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),f+=" ( "+e+" === undefined || "+q+" "+s+"= "+e+" ? "+m+" "+t+"= "+q+" : "+m+" "+t+" "+e+" ) || "+m+" !== "+m+") { "}else{x&&void 0===i?(v=!0,d=p,k=a.errSchemaPath+"/"+p,e=q,t+="="):(x&&(e=Math[o?"min":"max"](q,i)),q===(!x||e)?(v=!0,d=p,k=a.errSchemaPath+"/"+p,t+="="):(v=!1,z+="="));var y="'"+z+"'";f+=" if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),f+=" "+m+" "+t+" "+e+" || "+m+" !== "+m+") { "}}d=d||b;var A=A||[];A.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '"+(d||"_limit")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(k)+" , params: { comparison: "+y+", limit: "+e+", exclusive: "+v+" } ",!1!==a.opts.messages&&(f+=" , message: 'should be "+z+" ",n?f+="' + "+e:f+=""+e+"'"),a.opts.verbose&&(f+=" , schema:  ",n?f+="validate.schema"+j:f+=""+i,f+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";var B=f;return f=A.pop(),!a.compositeRule&&l?a.async?f+=" throw new ValidationError(["+B+"]); ":f+=" validate.errors = ["+B+"]; return false; ":f+=" var err = "+B+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+=" } ",l&&(f+=" else { "),f}}),aL=al((a,b)=>{b.exports=function(a,b,c){var d,e,f=" ",g=a.level,h=a.dataLevel,i=a.schema[b],j=a.schemaPath+a.util.getProperty(b),k=a.errSchemaPath+"/"+b,l=!a.opts.allErrors,m="data"+(h||""),n=a.opts.$data&&i&&i.$data;if(n?(f+=" var schema"+g+" = "+a.util.getData(i.$data,h,a.dataPathArr)+"; ",e="schema"+g):e=i,!(n||"number"==typeof i))throw Error(b+" must be number");var o="maxItems"==b?">":"<";f+="if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),f+=" "+m+".length "+o+" "+e+") { ";var d=b,p=p||[];p.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '"+(d||"_limitItems")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(k)+" , params: { limit: "+e+" } ",!1!==a.opts.messages&&(f+=" , message: 'should NOT have ","maxItems"==b?f+="more":f+="fewer",f+=" than ",n?f+="' + "+e+" + '":f+=""+i,f+=" items' "),a.opts.verbose&&(f+=" , schema:  ",n?f+="validate.schema"+j:f+=""+i,f+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";var q=f;return f=p.pop(),!a.compositeRule&&l?a.async?f+=" throw new ValidationError(["+q+"]); ":f+=" validate.errors = ["+q+"]; return false; ":f+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",l&&(f+=" else { "),f}}),aM=al((a,b)=>{b.exports=function(a,b,c){var d,e,f=" ",g=a.level,h=a.dataLevel,i=a.schema[b],j=a.schemaPath+a.util.getProperty(b),k=a.errSchemaPath+"/"+b,l=!a.opts.allErrors,m="data"+(h||""),n=a.opts.$data&&i&&i.$data;if(n?(f+=" var schema"+g+" = "+a.util.getData(i.$data,h,a.dataPathArr)+"; ",e="schema"+g):e=i,!(n||"number"==typeof i))throw Error(b+" must be number");var o="maxLength"==b?">":"<";f+="if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),!1===a.opts.unicode?f+=" "+m+".length ":f+=" ucs2length("+m+") ",f+=" "+o+" "+e+") { ";var d=b,p=p||[];p.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '"+(d||"_limitLength")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(k)+" , params: { limit: "+e+" } ",!1!==a.opts.messages&&(f+=" , message: 'should NOT be ","maxLength"==b?f+="longer":f+="shorter",f+=" than ",n?f+="' + "+e+" + '":f+=""+i,f+=" characters' "),a.opts.verbose&&(f+=" , schema:  ",n?f+="validate.schema"+j:f+=""+i,f+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";var q=f;return f=p.pop(),!a.compositeRule&&l?a.async?f+=" throw new ValidationError(["+q+"]); ":f+=" validate.errors = ["+q+"]; return false; ":f+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",l&&(f+=" else { "),f}}),aN=al((a,b)=>{b.exports=function(a,b,c){var d,e,f=" ",g=a.level,h=a.dataLevel,i=a.schema[b],j=a.schemaPath+a.util.getProperty(b),k=a.errSchemaPath+"/"+b,l=!a.opts.allErrors,m="data"+(h||""),n=a.opts.$data&&i&&i.$data;if(n?(f+=" var schema"+g+" = "+a.util.getData(i.$data,h,a.dataPathArr)+"; ",e="schema"+g):e=i,!(n||"number"==typeof i))throw Error(b+" must be number");var o="maxProperties"==b?">":"<";f+="if ( ",n&&(f+=" ("+e+" !== undefined && typeof "+e+" != 'number') || "),f+=" Object.keys("+m+").length "+o+" "+e+") { ";var d=b,p=p||[];p.push(f),f="",!1!==a.createErrors?(f+=" { keyword: '"+(d||"_limitProperties")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(k)+" , params: { limit: "+e+" } ",!1!==a.opts.messages&&(f+=" , message: 'should NOT have ","maxProperties"==b?f+="more":f+="fewer",f+=" than ",n?f+="' + "+e+" + '":f+=""+i,f+=" properties' "),a.opts.verbose&&(f+=" , schema:  ",n?f+="validate.schema"+j:f+=""+i,f+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+m+" "),f+=" } "):f+=" {} ";var q=f;return f=p.pop(),!a.compositeRule&&l?a.async?f+=" throw new ValidationError(["+q+"]); ":f+=" validate.errors = ["+q+"]; return false; ":f+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",f+="} ",l&&(f+=" else { "),f}}),aO=al((a,b)=>{b.exports=function(a,b,c){var d,e=" ",f=a.level,g=a.dataLevel,h=a.schema[b],i=a.schemaPath+a.util.getProperty(b),j=a.errSchemaPath+"/"+b,k=!a.opts.allErrors,l="data"+(g||""),m=a.opts.$data&&h&&h.$data;if(m?(e+=" var schema"+f+" = "+a.util.getData(h.$data,g,a.dataPathArr)+"; ",d="schema"+f):d=h,!(m||"number"==typeof h))throw Error(b+" must be number");e+="var division"+f+";if (",m&&(e+=" "+d+" !== undefined && ( typeof "+d+" != 'number' || "),e+=" (division"+f+" = "+l+" / "+d+", ",a.opts.multipleOfPrecision?e+=" Math.abs(Math.round(division"+f+") - division"+f+") > 1e-"+a.opts.multipleOfPrecision+" ":e+=" division"+f+" !== parseInt(division"+f+") ",e+=" ) ",m&&(e+="  )  "),e+=" ) {   ";var n=n||[];n.push(e),e="",!1!==a.createErrors?(e+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(j)+" , params: { multipleOf: "+d+" } ",!1!==a.opts.messages&&(e+=" , message: 'should be multiple of ",m?e+="' + "+d:e+=""+d+"'"),a.opts.verbose&&(e+=" , schema:  ",m?e+="validate.schema"+i:e+=""+h,e+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+l+" "),e+=" } "):e+=" {} ";var o=e;return e=n.pop(),!a.compositeRule&&k?a.async?e+=" throw new ValidationError(["+o+"]); ":e+=" validate.errors = ["+o+"]; return false; ":e+=" var err = "+o+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",e+="} ",k&&(e+=" else { "),e}}),aP=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="errs__"+e,m=a.util.copy(a);m.level++;var n="valid"+m.level;if(a.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:a.util.schemaHasRules(g,a.RULES.all)){m.schema=g,m.schemaPath=h,m.errSchemaPath=i,d+=" var "+l+" = errors;  ";var o,p=a.compositeRule;a.compositeRule=m.compositeRule=!0,m.createErrors=!1,m.opts.allErrors&&(o=m.opts.allErrors,m.opts.allErrors=!1),d+=" "+a.validate(m)+" ",m.createErrors=!0,o&&(m.opts.allErrors=o),a.compositeRule=m.compositeRule=p,d+=" if ("+n+") {   ";var q=q||[];q.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'not' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: {} ",!1!==a.opts.messages&&(d+=" , message: 'should NOT be valid' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var r=d;d=q.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+r+"]); ":d+=" validate.errors = ["+r+"]; return false; ":d+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } else {  errors = "+l+"; if (vErrors !== null) { if ("+l+") vErrors.length = "+l+"; else vErrors = null; } ",a.opts.allErrors&&(d+=" } ")}else d+="  var err =   ",!1!==a.createErrors?(d+=" { keyword: 'not' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: {} ",!1!==a.opts.messages&&(d+=" , message: 'should NOT be valid' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",j&&(d+=" if (false) { ");return d}}),aQ=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="valid"+e,l="errs__"+e,m=a.util.copy(a),n="";m.level++;var o="valid"+m.level,p=m.baseId,q="prevValid"+e,r="passingSchemas"+e;d+="var "+l+" = errors , "+q+" = false , "+k+" = false , "+r+" = null; ";var s=a.compositeRule;if(a.compositeRule=m.compositeRule=!0,g)for(var t,u=-1,v=g.length-1;u<v;)t=g[u+=1],(a.opts.strictKeywords?"object"==typeof t&&Object.keys(t).length>0||!1===t:a.util.schemaHasRules(t,a.RULES.all))?(m.schema=t,m.schemaPath=h+"["+u+"]",m.errSchemaPath=i+"/"+u,d+="  "+a.validate(m)+" ",m.baseId=p):d+=" var "+o+" = true; ",u&&(d+=" if ("+o+" && "+q+") { "+k+" = false; "+r+" = ["+r+", "+u+"]; } else { ",n+="}"),d+=" if ("+o+") { "+k+" = "+q+" = true; "+r+" = "+u+"; }";return a.compositeRule=m.compositeRule=s,d+=""+n+"if (!"+k+") {   var err =   ",!1!==a.createErrors?(d+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { passingSchemas: "+r+" } ",!1!==a.opts.messages&&(d+=" , message: 'should match exactly one schema in oneOf' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: data"+(f||"")+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!a.compositeRule&&j&&(a.async?d+=" throw new ValidationError(vErrors); ":d+=" validate.errors = vErrors; return false; "),d+="} else {  errors = "+l+"; if (vErrors !== null) { if ("+l+") vErrors.length = "+l+"; else vErrors = null; }",a.opts.allErrors&&(d+=" } "),d}}),aR=al((a,b)=>{b.exports=function(a,b,c){var d,e=" ",f=a.level,g=a.dataLevel,h=a.schema[b],i=a.schemaPath+a.util.getProperty(b),j=a.errSchemaPath+"/"+b,k=!a.opts.allErrors,l="data"+(g||""),m=a.opts.$data&&h&&h.$data;m?(e+=" var schema"+f+" = "+a.util.getData(h.$data,g,a.dataPathArr)+"; ",d="schema"+f):d=h;var n=m?"(new RegExp("+d+"))":a.usePattern(h);e+="if ( ",m&&(e+=" ("+d+" !== undefined && typeof "+d+" != 'string') || "),e+=" !"+n+".test("+l+") ) {   ";var o=o||[];o.push(e),e="",!1!==a.createErrors?(e+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(j)+" , params: { pattern:  ",m?e+=""+d:e+=""+a.util.toQuotedString(h),e+="  } ",!1!==a.opts.messages&&(e+=" , message: 'should match pattern \"",m?e+="' + "+d+" + '":e+=""+a.util.escapeQuotes(h),e+="\"' "),a.opts.verbose&&(e+=" , schema:  ",m?e+="validate.schema"+i:e+=""+a.util.toQuotedString(h),e+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+l+" "),e+=" } "):e+=" {} ";var p=e;return e=o.pop(),!a.compositeRule&&k?a.async?e+=" throw new ValidationError(["+p+"]); ":e+=" validate.errors = ["+p+"]; return false; ":e+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",e+="} ",k&&(e+=" else { "),e}}),aS=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="errs__"+e,m=a.util.copy(a),n="";m.level++;var o="valid"+m.level,p="key"+e,q="idx"+e,r=m.dataLevel=a.dataLevel+1,s="data"+r,t="dataProperties"+e,u=Object.keys(g||{}).filter(G),v=a.schema.patternProperties||{},w=Object.keys(v).filter(G),x=a.schema.additionalProperties,y=u.length||w.length,z=!1===x,A="object"==typeof x&&Object.keys(x).length,B=a.opts.removeAdditional,C=a.opts.ownProperties,D=a.baseId,E=a.schema.required;if(E&&!(a.opts.$data&&E.$data)&&E.length<a.opts.loopRequired)var F=a.util.toHash(E);function G(a){return"__proto__"!==a}if(d+="var "+l+" = errors;var "+o+" = true;",C&&(d+=" var "+t+" = undefined;"),z||A||B){if(C?d+=" "+t+" = "+t+" || Object.keys("+k+"); for (var "+q+"=0; "+q+"<"+t+".length; "+q+"++) { var "+p+" = "+t+"["+q+"]; ":d+=" for (var "+p+" in "+k+") { ",y){if(d+=" var isAdditional"+e+" = !(false ",u.length){if(u.length>8)d+=" || validate.schema"+h+".hasOwnProperty("+p+") ";else if(u)for(var H,I=-1,J=u.length-1;I<J;)H=u[I+=1],d+=" || "+p+" == "+a.util.toQuotedString(H)+" "}if(w.length&&w)for(var K,L=-1,M=w.length-1;L<M;)K=w[L+=1],d+=" || "+a.usePattern(K)+".test("+p+") ";d+=" ); if (isAdditional"+e+") { "}if("all"==B)d+=" delete "+k+"["+p+"]; ";else{var N=a.errorPath,O="' + "+p+" + '";if(a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPathExpr(a.errorPath,p,a.opts.jsonPointers)),z)if(B)d+=" delete "+k+"["+p+"]; ";else{d+=" "+o+" = false; ";var P=i;i=a.errSchemaPath+"/additionalProperties";var Q=Q||[];Q.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { additionalProperty: '"+O+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is an invalid additional property":d+="should NOT have additional properties",d+="' "),a.opts.verbose&&(d+=" , schema: false , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var R=d;d=Q.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+R+"]); ":d+=" validate.errors = ["+R+"]; return false; ":d+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i=P,j&&(d+=" break; ")}else if(A)if("failing"==B){d+=" var "+l+" = errors;  ";var S=a.compositeRule;a.compositeRule=m.compositeRule=!0,m.schema=x,m.schemaPath=a.schemaPath+".additionalProperties",m.errSchemaPath=a.errSchemaPath+"/additionalProperties",m.errorPath=a.opts._errorDataPathProperty?a.errorPath:a.util.getPathExpr(a.errorPath,p,a.opts.jsonPointers);var T=k+"["+p+"]";m.dataPathArr[r]=p;var U=a.validate(m);m.baseId=D,2>a.util.varOccurences(U,s)?d+=" "+a.util.varReplace(U,s,T)+" ":d+=" var "+s+" = "+T+"; "+U+" ",d+=" if (!"+o+") { errors = "+l+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+k+"["+p+"]; }  ",a.compositeRule=m.compositeRule=S}else{m.schema=x,m.schemaPath=a.schemaPath+".additionalProperties",m.errSchemaPath=a.errSchemaPath+"/additionalProperties",m.errorPath=a.opts._errorDataPathProperty?a.errorPath:a.util.getPathExpr(a.errorPath,p,a.opts.jsonPointers);var T=k+"["+p+"]";m.dataPathArr[r]=p;var U=a.validate(m);m.baseId=D,2>a.util.varOccurences(U,s)?d+=" "+a.util.varReplace(U,s,T)+" ":d+=" var "+s+" = "+T+"; "+U+" ",j&&(d+=" if (!"+o+") break; ")}a.errorPath=N}y&&(d+=" } "),d+=" }  ",j&&(d+=" if ("+o+") { ",n+="}")}var V=a.opts.useDefaults&&!a.compositeRule;if(u.length&&u)for(var H,W=-1,X=u.length-1;W<X;){var Y=g[H=u[W+=1]];if(a.opts.strictKeywords?"object"==typeof Y&&Object.keys(Y).length>0||!1===Y:a.util.schemaHasRules(Y,a.RULES.all)){var Z=a.util.getProperty(H),T=k+Z,$=V&&void 0!==Y.default;m.schema=Y,m.schemaPath=h+Z,m.errSchemaPath=i+"/"+a.util.escapeFragment(H),m.errorPath=a.util.getPath(a.errorPath,H,a.opts.jsonPointers),m.dataPathArr[r]=a.util.toQuotedString(H);var U=a.validate(m);if(m.baseId=D,2>a.util.varOccurences(U,s)){U=a.util.varReplace(U,s,T);var _=T}else{var _=s;d+=" var "+s+" = "+T+"; "}if($)d+=" "+U+" ";else{if(F&&F[H]){d+=" if ( "+_+" === undefined ",C&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(H)+"') "),d+=") { "+o+" = false; ";var N=a.errorPath,P=i,aa=a.util.escapeQuotes(H);a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPath(N,H,a.opts.jsonPointers)),i=a.errSchemaPath+"/required";var Q=Q||[];Q.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+aa+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+aa+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var R=d;d=Q.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+R+"]); ":d+=" validate.errors = ["+R+"]; return false; ":d+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i=P,a.errorPath=N,d+=" } else { "}else j?(d+=" if ( "+_+" === undefined ",C&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(H)+"') "),d+=") { "+o+" = true; } else { "):(d+=" if ("+_+" !== undefined ",C&&(d+=" &&   Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(H)+"') "),d+=" ) { ");d+=" "+U+" } "}}j&&(d+=" if ("+o+") { ",n+="}")}if(w.length&&w)for(var K,ab=-1,ac=w.length-1;ab<ac;){var Y=v[K=w[ab+=1]];if(a.opts.strictKeywords?"object"==typeof Y&&Object.keys(Y).length>0||!1===Y:a.util.schemaHasRules(Y,a.RULES.all)){m.schema=Y,m.schemaPath=a.schemaPath+".patternProperties"+a.util.getProperty(K),m.errSchemaPath=a.errSchemaPath+"/patternProperties/"+a.util.escapeFragment(K),C?d+=" "+t+" = "+t+" || Object.keys("+k+"); for (var "+q+"=0; "+q+"<"+t+".length; "+q+"++) { var "+p+" = "+t+"["+q+"]; ":d+=" for (var "+p+" in "+k+") { ",d+=" if ("+a.usePattern(K)+".test("+p+")) { ",m.errorPath=a.util.getPathExpr(a.errorPath,p,a.opts.jsonPointers);var T=k+"["+p+"]";m.dataPathArr[r]=p;var U=a.validate(m);m.baseId=D,2>a.util.varOccurences(U,s)?d+=" "+a.util.varReplace(U,s,T)+" ":d+=" var "+s+" = "+T+"; "+U+" ",j&&(d+=" if (!"+o+") break; "),d+=" } ",j&&(d+=" else "+o+" = true; "),d+=" }  ",j&&(d+=" if ("+o+") { ",n+="}")}}return j&&(d+=" "+n+" if ("+l+" == errors) {"),d}}),aT=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="errs__"+e,m=a.util.copy(a);m.level++;var n="valid"+m.level;if(d+="var "+l+" = errors;",a.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0||!1===g:a.util.schemaHasRules(g,a.RULES.all)){m.schema=g,m.schemaPath=h,m.errSchemaPath=i;var o="key"+e,p="idx"+e,q="i"+e,r="' + "+o+" + '",s="data"+(m.dataLevel=a.dataLevel+1),t="dataProperties"+e,u=a.opts.ownProperties,v=a.baseId;u&&(d+=" var "+t+" = undefined; "),u?d+=" "+t+" = "+t+" || Object.keys("+k+"); for (var "+p+"=0; "+p+"<"+t+".length; "+p+"++) { var "+o+" = "+t+"["+p+"]; ":d+=" for (var "+o+" in "+k+") { ",d+=" var startErrs"+e+" = errors; ";var w=a.compositeRule;a.compositeRule=m.compositeRule=!0;var x=a.validate(m);m.baseId=v,2>a.util.varOccurences(x,s)?d+=" "+a.util.varReplace(x,s,o)+" ":d+=" var "+s+" = "+o+"; "+x+" ",a.compositeRule=m.compositeRule=w,d+=" if (!"+n+") { for (var "+q+"=startErrs"+e+"; "+q+"<errors; "+q+"++) { vErrors["+q+"].propertyName = "+o+"; }   var err =   ",!1!==a.createErrors?(d+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { propertyName: '"+r+"' } ",!1!==a.opts.messages&&(d+=" , message: 'property name \\'"+r+"\\' is invalid' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!a.compositeRule&&j&&(a.async?d+=" throw new ValidationError(vErrors); ":d+=" validate.errors = vErrors; return false; "),j&&(d+=" break; "),d+=" } }"}return j&&(d+="  if ("+l+" == errors) {"),d}}),aU=al((a,b)=>{b.exports=function(a,b,c){var d=" ",e=a.level,f=a.dataLevel,g=a.schema[b],h=a.schemaPath+a.util.getProperty(b),i=a.errSchemaPath+"/"+b,j=!a.opts.allErrors,k="data"+(f||""),l="valid"+e,m=a.opts.$data&&g&&g.$data;m&&(d+=" var schema"+e+" = "+a.util.getData(g.$data,f,a.dataPathArr)+"; ");var n="schema"+e;if(!m)if(g.length<a.opts.loopRequired&&a.schema.properties&&Object.keys(a.schema.properties).length){var o=[];if(g)for(var p,q=-1,r=g.length-1;q<r;){p=g[q+=1];var s=a.schema.properties[p];s&&(a.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0||!1===s:a.util.schemaHasRules(s,a.RULES.all))||(o[o.length]=p)}}else var o=g;if(m||o.length){var t=a.errorPath,u=m||o.length>=a.opts.loopRequired,v=a.opts.ownProperties;if(j)if(d+=" var missing"+e+"; ",u){m||(d+=" var "+n+" = validate.schema"+h+"; ");var w="i"+e,x="schema"+e+"["+w+"]",y="' + "+x+" + '";a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPathExpr(t,x,a.opts.jsonPointers)),d+=" var "+l+" = true; ",m&&(d+=" if (schema"+e+" === undefined) "+l+" = true; else if (!Array.isArray(schema"+e+")) "+l+" = false; else {"),d+=" for (var "+w+" = 0; "+w+" < "+n+".length; "+w+"++) { "+l+" = "+k+"["+n+"["+w+"]] !== undefined ",v&&(d+=" &&   Object.prototype.hasOwnProperty.call("+k+", "+n+"["+w+"]) "),d+="; if (!"+l+") break; } ",m&&(d+="  }  "),d+="  if (!"+l+") {   ";var z=z||[];z.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+y+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+y+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var A=d;d=z.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+A+"]); ":d+=" validate.errors = ["+A+"]; return false; ":d+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } else { "}else{d+=" if ( ";var B=o;if(B)for(var C,w=-1,D=B.length-1;w<D;){C=B[w+=1],w&&(d+=" || ");var E=a.util.getProperty(C),F=k+E;d+=" ( ( "+F+" === undefined ",v&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(C)+"') "),d+=") && (missing"+e+" = "+a.util.toQuotedString(a.opts.jsonPointers?C:E)+") ) "}d+=") {  ";var x="missing"+e,y="' + "+x+" + '";a.opts._errorDataPathProperty&&(a.errorPath=a.opts.jsonPointers?a.util.getPathExpr(t,x,!0):t+" + "+x);var z=z||[];z.push(d),d="",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+y+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+y+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ";var A=d;d=z.pop(),!a.compositeRule&&j?a.async?d+=" throw new ValidationError(["+A+"]); ":d+=" validate.errors = ["+A+"]; return false; ":d+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d+=" } else { "}else if(u){m||(d+=" var "+n+" = validate.schema"+h+"; ");var w="i"+e,x="schema"+e+"["+w+"]",y="' + "+x+" + '";a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPathExpr(t,x,a.opts.jsonPointers)),m&&(d+=" if ("+n+" && !Array.isArray("+n+")) {  var err =   ",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+y+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+y+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+n+" !== undefined) { "),d+=" for (var "+w+" = 0; "+w+" < "+n+".length; "+w+"++) { if ("+k+"["+n+"["+w+"]] === undefined ",v&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", "+n+"["+w+"]) "),d+=") {  var err =   ",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+y+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+y+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",m&&(d+="  }  ")}else{var G=o;if(G)for(var C,H=-1,I=G.length-1;H<I;){C=G[H+=1];var E=a.util.getProperty(C),y=a.util.escapeQuotes(C),F=k+E;a.opts._errorDataPathProperty&&(a.errorPath=a.util.getPath(t,C,a.opts.jsonPointers)),d+=" if ( "+F+" === undefined ",v&&(d+=" || ! Object.prototype.hasOwnProperty.call("+k+", '"+a.util.escapeQuotes(C)+"') "),d+=") {  var err =   ",!1!==a.createErrors?(d+=" { keyword: 'required' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(i)+" , params: { missingProperty: '"+y+"' } ",!1!==a.opts.messages&&(d+=" , message: '",a.opts._errorDataPathProperty?d+="is a required property":d+="should have required property \\'"+y+"\\'",d+="' "),a.opts.verbose&&(d+=" , schema: validate.schema"+h+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+k+" "),d+=" } "):d+=" {} ",d+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}a.errorPath=t}else j&&(d+=" if (true) {");return d}}),aV=al((a,b)=>{b.exports=function(a,b,c){var d,e=" ",f=a.level,g=a.dataLevel,h=a.schema[b],i=a.schemaPath+a.util.getProperty(b),j=a.errSchemaPath+"/"+b,k=!a.opts.allErrors,l="data"+(g||""),m="valid"+f,n=a.opts.$data&&h&&h.$data;if(n?(e+=" var schema"+f+" = "+a.util.getData(h.$data,g,a.dataPathArr)+"; ",d="schema"+f):d=h,(h||n)&&!1!==a.opts.uniqueItems){n&&(e+=" var "+m+"; if ("+d+" === false || "+d+" === undefined) "+m+" = true; else if (typeof "+d+" != 'boolean') "+m+" = false; else { "),e+=" var i = "+l+".length , "+m+" = true , j; if (i > 1) { ";var o=a.schema.items&&a.schema.items.type,p=Array.isArray(o);!o||"object"==o||"array"==o||p&&(o.indexOf("object")>=0||o.indexOf("array")>=0)?e+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+l+"[i], "+l+"[j])) { "+m+" = false; break outer; } } } ":(e+=" var itemIndices = {}, item; for (;i--;) { var item = "+l+"[i]; ",e+=" if ("+a.util["checkDataType"+(p?"s":"")](o,"item",a.opts.strictNumbers,!0)+") continue; ",p&&(e+=" if (typeof item == 'string') item = '\"' + item; "),e+=" if (typeof itemIndices[item] == 'number') { "+m+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "),e+=" } ",n&&(e+="  }  "),e+=" if (!"+m+") {   ";var q=q||[];q.push(e),e="",!1!==a.createErrors?(e+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(j)+" , params: { i: i, j: j } ",!1!==a.opts.messages&&(e+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),a.opts.verbose&&(e+=" , schema:  ",n?e+="validate.schema"+i:e+=""+h,e+="         , parentSchema: validate.schema"+a.schemaPath+" , data: "+l+" "),e+=" } "):e+=" {} ";var r=e;e=q.pop(),!a.compositeRule&&k?a.async?e+=" throw new ValidationError(["+r+"]); ":e+=" validate.errors = ["+r+"]; return false; ":e+=" var err = "+r+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",e+=" } ",k&&(e+=" else { ")}else k&&(e+=" if (true) { ");return e}}),aW=al((a,b)=>{b.exports={$ref:az(),allOf:aA(),anyOf:aB(),$comment:aC(),const:aD(),contains:aE(),dependencies:aF(),enum:aG(),format:aH(),if:aI(),items:aJ(),maximum:aK(),minimum:aK(),maxItems:aL(),minItems:aL(),maxLength:aM(),minLength:aM(),maxProperties:aN(),minProperties:aN(),multipleOf:aO(),not:aP(),oneOf:aQ(),pattern:aR(),properties:aS(),propertyNames:aT(),required:aU(),uniqueItems:aV(),validate:av()}}),aX=al((a,b)=>{var c=aW(),d=ap().toHash;b.exports=function(){var a=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],b=["type","$comment"];return a.all=d(b),a.types=d(["number","integer","string","array","object","boolean","null"]),a.forEach(function(d){d.rules=d.rules.map(function(d){if("object"==typeof d){var e,f=Object.keys(d)[0];e=d[f],d=f,e.forEach(function(c){b.push(c),a.all[c]=!0})}return b.push(d),a.all[d]={keyword:d,code:c[d],implements:e}}),a.all.$comment={keyword:"$comment",code:c.$comment},d.type&&(a.types[d.type]=d)}),a.keywords=d(b.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),a.custom={},a}}),aY=al((a,b)=>{var c=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];b.exports=function(a,b){for(var d=0;d<b.length;d++){a=JSON.parse(JSON.stringify(a));var e,f=b[d].split("/"),g=a;for(e=1;e<f.length;e++)g=g[f[e]];for(e=0;e<c.length;e++){var h=c[e],i=g[h];i&&(g[h]={anyOf:[i,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return a}}),aZ=al((a,b)=>{var c=at().MissingRef;b.exports=function a(b,d,e){var f=this;if("function"!=typeof this._opts.loadSchema)throw Error("options.loadSchema should be a function");"function"==typeof d&&(e=d,d=void 0);var g=h(b).then(function(){var a=f._addSchema(b,void 0,d);return a.validate||function a(b){try{return f._compile(b)}catch(l){if(l instanceof c){var e=l,g=e.missingSchema;if(k(g))throw Error("Schema "+g+" is loaded but "+e.missingRef+" cannot be resolved");var i=f._loadingSchemas[g];return i||(i=f._loadingSchemas[g]=f._opts.loadSchema(g)).then(j,j),i.then(function(a){if(!k(g))return h(a).then(function(){k(g)||f.addSchema(a,g,void 0,d)})}).then(function(){return a(b)});function j(){delete f._loadingSchemas[g]}function k(a){return f._refs[a]||f._schemas[a]}}throw l}}(a)});return e&&g.then(function(a){e(null,a)},e),g;function h(b){var c=b.$schema;return c&&!f.getSchema(c)?a.call(f,{$ref:c},!0):Promise.resolve()}}}),a$=al((a,b)=>{b.exports=function(a,b,c){var d,e,f,g,h,i,j,k=" ",l=a.level,m=a.dataLevel,n=a.schema[b],o=a.schemaPath+a.util.getProperty(b),p=a.errSchemaPath+"/"+b,q=!a.opts.allErrors,r="data"+(m||""),s="valid"+l,t="errs__"+l,u=a.opts.$data&&n&&n.$data;u?(k+=" var schema"+l+" = "+a.util.getData(n.$data,m,a.dataPathArr)+"; ",j="schema"+l):j=n;var v="definition"+l,w=this.definition,x="";if(u&&w.$data){h="keywordValidate"+l;var y=w.validateSchema;k+=" var "+v+" = RULES.custom['"+b+"'].definition; var "+h+" = "+v+".validate;"}else{if(!(g=a.useCustomRule(this,n,a.schema,a)))return;j="validate.schema"+o,h=g.code,d=w.compile,e=w.inline,f=w.macro}var z=h+".errors",A="i"+l,B="ruleErr"+l,C=w.async;if(C&&!a.async)throw Error("async keyword in sync schema");if(e||f||(k+=""+z+" = null;"),k+="var "+t+" = errors;var "+s+";",u&&w.$data&&(x+="}",k+=" if ("+j+" === undefined) { "+s+" = true; } else { ",y&&(x+="}",k+=" "+s+" = "+v+".validateSchema("+j+"); if ("+s+") { ")),e)w.statements?k+=" "+g.validate+" ":k+=" "+s+" = "+g.validate+"; ";else if(f){var D=a.util.copy(a),x="";D.level++;var E="valid"+D.level;D.schema=g.validate,D.schemaPath="";var F=a.compositeRule;a.compositeRule=D.compositeRule=!0;var G=a.validate(D).replace(/validate\.schema/g,h);a.compositeRule=D.compositeRule=F,k+=" "+G}else{var H=H||[];H.push(k),k="  "+h+".call( ",a.opts.passContext?k+="this":k+="self",d||!1===w.schema?k+=" , "+r+" ":k+=" , "+j+" , "+r+" , validate.schema"+a.schemaPath+" ",k+=" , (dataPath || '')",'""'!=a.errorPath&&(k+=" + "+a.errorPath);var I=m?"data"+(m-1||""):"parentData",J=m?a.dataPathArr[m]:"parentDataProperty",K=k+=" , "+I+" , "+J+" , rootData )  ";k=H.pop(),!1===w.errors?(k+=" "+s+" = ",C&&(k+="await "),k+=""+K+"; "):C?k+=" var "+(z="customErrors"+l)+" = null; try { "+s+" = await "+K+"; } catch (e) { "+s+" = false; if (e instanceof ValidationError) "+z+" = e.errors; else throw e; } ":k+=" "+z+" = null; "+s+" = "+K+"; "}if(w.modifying&&(k+=" if ("+I+") "+r+" = "+I+"["+J+"];"),k+=""+x,w.valid)q&&(k+=" if (true) { ");else{k+=" if ( ",void 0===w.valid?(k+=" !",f?k+=""+E:k+=""+s):k+=" "+!w.valid+" ",k+=") { ",i=this.keyword;var H=H||[];H.push(k),k="";var H=H||[];H.push(k),k="",!1!==a.createErrors?(k+=" { keyword: '"+(i||"custom")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(p)+" , params: { keyword: '"+this.keyword+"' } ",!1!==a.opts.messages&&(k+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),a.opts.verbose&&(k+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+r+" "),k+=" } "):k+=" {} ";var L=k;k=H.pop(),!a.compositeRule&&q?a.async?k+=" throw new ValidationError(["+L+"]); ":k+=" validate.errors = ["+L+"]; return false; ":k+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var M=k;k=H.pop(),e?w.errors?"full"!=w.errors&&(k+="  for (var "+A+"="+t+"; "+A+"<errors; "+A+"++) { var "+B+" = vErrors["+A+"]; if ("+B+".dataPath === undefined) "+B+".dataPath = (dataPath || '') + "+a.errorPath+"; if ("+B+".schemaPath === undefined) { "+B+'.schemaPath = "'+p+'"; } ',a.opts.verbose&&(k+=" "+B+".schema = "+j+"; "+B+".data = "+r+"; "),k+=" } "):!1===w.errors?k+=" "+M+" ":(k+=" if ("+t+" == errors) { "+M+" } else {  for (var "+A+"="+t+"; "+A+"<errors; "+A+"++) { var "+B+" = vErrors["+A+"]; if ("+B+".dataPath === undefined) "+B+".dataPath = (dataPath || '') + "+a.errorPath+"; if ("+B+".schemaPath === undefined) { "+B+'.schemaPath = "'+p+'"; } ',a.opts.verbose&&(k+=" "+B+".schema = "+j+"; "+B+".data = "+r+"; "),k+=" } } "):f?(k+="   var err =   ",!1!==a.createErrors?(k+=" { keyword: '"+(i||"custom")+"' , dataPath: (dataPath || '') + "+a.errorPath+" , schemaPath: "+a.util.toQuotedString(p)+" , params: { keyword: '"+this.keyword+"' } ",!1!==a.opts.messages&&(k+=" , message: 'should pass \""+this.keyword+"\" keyword validation' "),a.opts.verbose&&(k+=" , schema: validate.schema"+o+" , parentSchema: validate.schema"+a.schemaPath+" , data: "+r+" "),k+=" } "):k+=" {} ",k+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!a.compositeRule&&q&&(a.async?k+=" throw new ValidationError(vErrors); ":k+=" validate.errors = vErrors; return false; ")):!1===w.errors?k+=" "+M+" ":(k+=" if (Array.isArray("+z+")) { if (vErrors === null) vErrors = "+z+"; else vErrors = vErrors.concat("+z+"); errors = vErrors.length;  for (var "+A+"="+t+"; "+A+"<errors; "+A+"++) { var "+B+" = vErrors["+A+"]; if ("+B+".dataPath === undefined) "+B+".dataPath = (dataPath || '') + "+a.errorPath+";  "+B+'.schemaPath = "'+p+'";  ',a.opts.verbose&&(k+=" "+B+".schema = "+j+"; "+B+".data = "+r+"; "),k+=" } } else { "+M+" } "),k+=" } ",q&&(k+=" else { ")}return k}}),a_=al((a,b)=>{b.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"http://json-schema.org/draft-07/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:!0}}),a0=al((a,b)=>{var c=a_();b.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:c.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:c.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}}),a1=al((a,b)=>{var c=/^[a-z_$][a-z0-9_$-]*$/i,d=a$(),e=a0();function f(a,b){f.errors=null;var c=this._validateKeyword=this._validateKeyword||this.compile(e,!0);if(c(a))return!0;if(f.errors=c.errors,!b)return!1;throw Error("custom keyword definition is invalid: "+this.errorsText(c.errors))}b.exports={add:function(a,b){var e=this.RULES;if(e.keywords[a])throw Error("Keyword "+a+" is already defined");if(!c.test(a))throw Error("Keyword "+a+" is not a valid identifier");if(b){this.validateKeyword(b,!0);var f=b.type;if(Array.isArray(f))for(var g=0;g<f.length;g++)i(a,f[g],b);else i(a,f,b);var h=b.metaSchema;h&&(b.$data&&this._opts.$data&&(h={anyOf:[h,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),b.validateSchema=this.compile(h,!0))}function i(a,b,c){for(var f,g=0;g<e.length;g++){var h=e[g];if(h.type==b){f=h;break}}f||(f={type:b,rules:[]},e.push(f));var i={keyword:a,definition:c,custom:!0,code:d,implements:c.implements};f.rules.push(i),e.custom[a]=i}return e.keywords[a]=e.all[a]=!0,this},get:function(a){var b=this.RULES.custom[a];return b?b.definition:this.RULES.keywords[a]||!1},remove:function(a){var b=this.RULES;delete b.keywords[a],delete b.all[a],delete b.custom[a];for(var c=0;c<b.length;c++)for(var d=b[c].rules,e=0;e<d.length;e++)if(d[e].keyword==a){d.splice(e,1);break}return this},validate:f}}),a2=al((a,b)=>{b.exports={$schema:"http://json-schema.org/draft-07/schema#",$id:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description:"Meta-schema for $data reference (JSON Schema extension proposal)",type:"object",required:["$data"],properties:{$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties:!1}}),a3=al((a,b)=>{var c=aw(),d=as(),e=ax(),f=aq(),g=au(),h=ay(),i=aX(),j=aY(),k=ap();b.exports=q,q.prototype.validate=function(a,b){if("string"==typeof a){if(!(c=this.getSchema(a)))throw Error('no schema with key or ref "'+a+'"')}else{var c,d=this._addSchema(a);c=d.validate||this._compile(d)}var e=c(b);return!0!==c.$async&&(this.errors=c.errors),e},q.prototype.compile=function(a,b){var c=this._addSchema(a,void 0,b);return c.validate||this._compile(c)},q.prototype.addSchema=function(a,b,c,e){if(Array.isArray(a)){for(var f=0;f<a.length;f++)this.addSchema(a[f],void 0,c,e);return this}var g=this._getId(a);if(void 0!==g&&"string"!=typeof g)throw Error("schema id must be string");return w(this,b=d.normalizeId(b||g)),this._schemas[b]=this._addSchema(a,c,e,!0),this},q.prototype.addMetaSchema=function(a,b,c){return this.addSchema(a,b,c,!0),this},q.prototype.validateSchema=function(a,b){var c,d,e=a.$schema;if(void 0!==e&&"string"!=typeof e)throw Error("$schema must be a string");if(!(e=e||this._opts.defaultMeta||(c=this,d=c._opts.meta,c._opts.defaultMeta="object"==typeof d?c._getId(d)||d:c.getSchema(n)?n:void 0,c._opts.defaultMeta)))return this.logger.warn("meta-schema not available"),this.errors=null,!0;var f=this.validate(e,a);if(!f&&b){var g="schema is invalid: "+this.errorsText();if("log"==this._opts.validateSchema)this.logger.error(g);else throw Error(g)}return f},q.prototype.getSchema=function(a){var b=r(this,a);switch(typeof b){case"object":return b.validate||this._compile(b);case"string":return this.getSchema(b);case"undefined":return function(a,b){var e=d.schema.call(a,{schema:{}},b);if(e){var{schema:g,root:h,baseId:i}=e,j=c.call(a,g,h,void 0,i);return a._fragments[b]=new f({ref:b,fragment:!0,schema:g,root:h,baseId:i,validate:j}),j}}(this,a)}},q.prototype.removeSchema=function(a){if(a instanceof RegExp)return s(this,this._schemas,a),s(this,this._refs,a),this;switch(typeof a){case"undefined":s(this,this._schemas),s(this,this._refs),this._cache.clear();break;case"string":var b=r(this,a);b&&this._cache.del(b.cacheKey),delete this._schemas[a],delete this._refs[a];break;case"object":var c=this._opts.serialize,e=c?c(a):a;this._cache.del(e);var f=this._getId(a);f&&(f=d.normalizeId(f),delete this._schemas[f],delete this._refs[f])}return this},q.prototype.addFormat=function(a,b){return"string"==typeof b&&(b=new RegExp(b)),this._formats[a]=b,this},q.prototype.errorsText=function(a,b){if(!(a=a||this.errors))return"No errors";for(var c=void 0===(b=b||{}).separator?", ":b.separator,d=void 0===b.dataVar?"data":b.dataVar,e="",f=0;f<a.length;f++){var g=a[f];g&&(e+=d+g.dataPath+" "+g.message+c)}return e.slice(0,-c.length)},q.prototype._addSchema=function(a,b,c,e){if("object"!=typeof a&&"boolean"!=typeof a)throw Error("schema should be object or boolean");var g,h=this._opts.serialize,i=h?h(a):a,j=this._cache.get(i);if(j)return j;e=e||!1!==this._opts.addUsedSchema;var k=d.normalizeId(this._getId(a));k&&e&&w(this,k);var l=!1!==this._opts.validateSchema&&!b;!l||(g=k&&k==d.normalizeId(a.$schema))||this.validateSchema(a,!0);var m=d.ids.call(this,a),n=new f({id:k,schema:a,localRefs:m,cacheKey:i,meta:c});return"#"!=k[0]&&e&&(this._refs[k]=n),this._cache.put(i,n),l&&g&&this.validateSchema(a,!0),n},q.prototype._compile=function(a,b){var d,e;if(a.compiling)return a.validate=f,f.schema=a.schema,f.errors=null,f.root=b||f,!0===a.schema.$async&&(f.$async=!0),f;a.compiling=!0,a.meta&&(d=this._opts,this._opts=this._metaOpts);try{e=c.call(this,a.schema,b,a.localRefs)}catch(b){throw delete a.validate,b}finally{a.compiling=!1,a.meta&&(this._opts=d)}return a.validate=e,a.refs=e.refs,a.refVal=e.refVal,a.root=e.root,e;function f(){var b=a.validate,c=b.apply(this,arguments);return f.errors=b.errors,c}},q.prototype.compileAsync=aZ();var l=a1();q.prototype.addKeyword=l.add,q.prototype.getKeyword=l.get,q.prototype.removeKeyword=l.remove,q.prototype.validateKeyword=l.validate;var m=at();q.ValidationError=m.Validation,q.MissingRefError=m.MissingRef,q.$dataMetaSchema=j;var n="http://json-schema.org/draft-07/schema",o=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],p=["/properties"];function q(a){if(!(this instanceof q))return new q(a);a=this._opts=k.copy(a)||{},function(a){var b=a._opts.logger;if(!1===b)a.logger={log:x,warn:x,error:x};else{if(void 0===b&&(b=console),!("object"==typeof b&&b.log&&b.warn&&b.error))throw Error("logger must implement log, warn and error methods");a.logger=b}}(this),this._schemas={},this._refs={},this._fragments={},this._formats=h(a.format),this._cache=a.cache||new e,this._loadingSchemas={},this._compilations=[],this.RULES=i(),this._getId=function(a){switch(a.schemaId){case"auto":return v;case"id":return t;default:return u}}(a),a.loopRequired=a.loopRequired||1/0,"property"==a.errorDataPath&&(a._errorDataPathProperty=!0),void 0===a.serialize&&(a.serialize=g),this._metaOpts=function(a){for(var b=k.copy(a._opts),c=0;c<o.length;c++)delete b[o[c]];return b}(this),a.formats&&function(a){for(var b in a._opts.formats){var c=a._opts.formats[b];a.addFormat(b,c)}}(this),a.keywords&&function(a){for(var b in a._opts.keywords){var c=a._opts.keywords[b];a.addKeyword(b,c)}}(this),function(a){if(a._opts.$data&&(b=a2(),a.addMetaSchema(b,b.$id,!0)),!1!==a._opts.meta){var b,c=a_();a._opts.$data&&(c=j(c,p)),a.addMetaSchema(c,n,!0),a._refs["http://json-schema.org/schema"]=n}}(this),"object"==typeof a.meta&&this.addMetaSchema(a.meta),a.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),function(a){var b=a._opts.schemas;if(b)if(Array.isArray(b))a.addSchema(b);else for(var c in b)a.addSchema(b[c],c)}(this)}function r(a,b){return b=d.normalizeId(b),a._schemas[b]||a._refs[b]||a._fragments[b]}function s(a,b,c){for(var d in b){var e=b[d];!e.meta&&(!c||c.test(d))&&(a._cache.del(e.cacheKey),delete b[d])}}function t(a){return a.$id&&this.logger.warn("schema $id ignored",a.$id),a.id}function u(a){return a.id&&this.logger.warn("schema id ignored",a.id),a.$id}function v(a){if(a.$id&&a.id&&a.$id!=a.id)throw Error("schema $id is different from id");return a.$id||a.id}function w(a,b){if(a._schemas[b]||a._refs[b])throw Error('schema with key or id "'+b+'" already exists')}function x(){}});function a4(a=50){let b=new AbortController;return(0,R.setMaxListeners)(a,b.signal),b}var a5={accessSync(a,b){ae.accessSync(a,b)},cwd:()=>process.cwd(),chmodSync(a,b){ae.chmodSync(a,b)},existsSync:a=>ae.existsSync(a),stat:async a=>(0,af.stat)(a),statSync:a=>ae.statSync(a),readFileSync:(a,b)=>ae.readFileSync(a,{encoding:b.encoding}),readFileBytesSync:a=>ae.readFileSync(a),readSync(a,b){let c;try{c=ae.openSync(a,"r");let d=Buffer.alloc(b.length),e=ae.readSync(c,d,0,b.length,0);return{buffer:d,bytesRead:e}}finally{c&&ae.closeSync(c)}},writeFileSync(a,b,c){let d;if(!c.flush)return void ae.writeFileSync(a,b,{encoding:c.encoding});try{d=ae.openSync(a,"w"),ae.writeFileSync(d,b,{encoding:c.encoding}),ae.fsyncSync(d)}finally{d&&ae.closeSync(d)}},appendFileSync(a,b){ae.appendFileSync(a,b)},copyFileSync(a,b){ae.copyFileSync(a,b)},unlinkSync(a){ae.unlinkSync(a)},renameSync(a,b){ae.renameSync(a,b)},symlinkSync(a,b){ae.symlinkSync(a,b)},readlinkSync:a=>ae.readlinkSync(a),realpathSync:a=>ae.realpathSync(a),mkdirSync(a){ae.existsSync(a)||ae.mkdirSync(a,{recursive:!0})},readdirSync:a=>ae.readdirSync(a,{withFileTypes:!0}),readdirStringSync:a=>ae.readdirSync(a),isDirEmptySync(a){return 0===this.readdirSync(a).length},rmdirSync(a){ae.rmdirSync(a)},rmSync(a,b){ae.rmSync(a,b)},createWriteStream:a=>ae.createWriteStream(a)};class a6 extends Error{}function a7(){return void 0!==process.versions.bun}class a8{options;child;childStdin;childStdout;ready=!1;abortController;exitError;exitListeners=[];processExitHandler;abortHandler;constructor(a){this.options=a,this.abortController=a.abortController||a4(),this.initialize()}initialize(){try{let{prompt:a,additionalDirectories:b=[],cwd:c,executable:d=a7()?"bun":"node",executableArgs:e=[],extraArgs:f={},pathToClaudeCodeExecutable:g,env:h={...process.env},stderr:i,customSystemPrompt:j,appendSystemPrompt:k,maxTurns:l,model:m,fallbackModel:n,permissionMode:o,permissionPromptToolName:p,continueConversation:q,resume:r,allowedTools:s=[],disallowedTools:t=[],mcpServers:u,strictMcpConfig:v,canUseTool:w,includePartialMessages:x}=this.options,y=["--output-format","stream-json","--verbose"];if(j&&y.push("--system-prompt",j),k&&y.push("--append-system-prompt",k),l&&y.push("--max-turns",l.toString()),m&&y.push("--model",m),h.DEBUG&&y.push("--debug-to-stderr"),w){if("string"==typeof a)throw Error("canUseTool callback requires --input-format stream-json. Please set prompt as an AsyncIterable.");if(p)throw Error("canUseTool callback cannot be used with permissionPromptToolName. Please use one or the other.");y.push("--permission-prompt-tool","stdio")}else p&&y.push("--permission-prompt-tool",p);if(q&&y.push("--continue"),r&&y.push("--resume",r),s.length>0&&y.push("--allowedTools",s.join(",")),t.length>0&&y.push("--disallowedTools",t.join(",")),u&&Object.keys(u).length>0&&y.push("--mcp-config",JSON.stringify({mcpServers:u})),v&&y.push("--strict-mcp-config"),o&&"default"!==o&&y.push("--permission-mode",o),n){if(m&&n===m)throw Error("Fallback model cannot be the same as the main model. Please specify a different model for fallbackModel option.");y.push("--fallback-model",n)}for(let c of(x&&y.push("--include-partial-messages"),"string"==typeof a?(y.push("--print"),y.push("--",a.trim())):y.push("--input-format","stream-json"),b))y.push("--add-dir",c);for(let[a,b]of Object.entries(f))null===b?y.push(`--${a}`):y.push(`--${a}`,b);if(h.CLAUDE_CODE_ENTRYPOINT||(h.CLAUDE_CODE_ENTRYPOINT="sdk-ts"),!a5.existsSync(g)){let a=a9(g)?`Claude Code native binary not found at ${g}. Please ensure Claude Code is installed via native installer or specify a valid path with options.pathToClaudeCodeExecutable.`:`Claude Code executable not found at ${g}. Is options.pathToClaudeCodeExecutable set?`;throw ReferenceError(a)}let z=a9(g),A=z?g:d,B=z?y:[...e,g,...y];this.logDebug(z?`Spawning Claude Code native binary: ${g} ${y.join(" ")}`:`Spawning Claude Code process: ${d} ${[...e,g,...y].join(" ")}`);let C=h.DEBUG||i?"pipe":"ignore";this.child=(0,T.spawn)(A,B,{cwd:c,stdio:["pipe","pipe",C],signal:this.abortController.signal,env:h}),this.childStdin=this.child.stdin,this.childStdout=this.child.stdout,"string"==typeof a&&(this.childStdin.end(),this.childStdin=void 0),(h.DEBUG||i)&&this.child.stderr.on("data",a=>{this.logDebug(`Claude Code stderr: ${a.toString()}`),i&&i(a.toString())});let D=()=>{this.child&&!this.child.killed&&this.child.kill("SIGTERM")};this.processExitHandler=D,this.abortHandler=D,process.on("exit",this.processExitHandler),this.abortController.signal.addEventListener("abort",this.abortHandler),this.child.on("error",a=>{this.ready=!1,this.abortController.signal.aborted?this.exitError=new a6("Claude Code process aborted by user"):(this.exitError=Error(`Failed to spawn Claude Code process: ${a.message}`),this.logDebug(this.exitError.message))}),this.child.on("close",(a,b)=>{if(this.ready=!1,this.abortController.signal.aborted)this.exitError=new a6("Claude Code process aborted by user");else{let c=this.getProcessExitError(a,b);c&&(this.exitError=c,this.logDebug(c.message))}}),this.ready=!0}catch(a){throw this.ready=!1,a}}getProcessExitError(a,b){return 0!==a&&null!==a?Error(`Claude Code process exited with code ${a}`):b?Error(`Claude Code process terminated by signal ${b}`):void 0}logDebug(a){process.env.DEBUG&&process.stderr.write(`${a}
`),this.options.stderr&&this.options.stderr(a)}write(a){if(this.abortController.signal.aborted)throw new a6("Operation aborted");if(!this.ready||!this.childStdin)throw Error("ProcessTransport is not ready for writing");if(this.child?.killed||this.child?.exitCode!==null)throw Error("Cannot write to terminated process");if(this.exitError)throw Error(`Cannot write to process that exited with error: ${this.exitError.message}`);process.env.DEBUG_SDK&&process.stderr.write(`[ProcessTransport] Writing to stdin: ${a.substring(0,100)}
`);try{!this.childStdin.write(a)&&process.env.DEBUG_SDK&&console.warn("[ProcessTransport] Write buffer full, data queued")}catch(a){throw this.ready=!1,Error(`Failed to write to process stdin: ${a.message}`)}}close(){for(let{handler:a}of(this.childStdin&&(this.childStdin.end(),this.childStdin=void 0),this.processExitHandler&&(process.off("exit",this.processExitHandler),this.processExitHandler=void 0),this.abortHandler&&(this.abortController.signal.removeEventListener("abort",this.abortHandler),this.abortHandler=void 0),this.exitListeners))this.child?.off("exit",a);this.exitListeners=[],this.child&&!this.child.killed&&(this.child.kill("SIGTERM"),setTimeout(()=>{this.child&&!this.child.killed&&this.child.kill("SIGKILL")},5e3)),this.ready=!1}isReady(){return this.ready}async *readMessages(){if(!this.childStdout)throw Error("ProcessTransport output stream not available");let a=(0,ad.createInterface)({input:this.childStdout});try{for await(let b of a)if(b.trim()){let a=JSON.parse(b);yield a}await this.waitForExit()}catch(a){throw a}finally{a.close()}}endInput(){this.childStdin&&this.childStdin.end()}getInputStream(){return this.childStdin}onExit(a){if(!this.child)return()=>{};let b=(b,c)=>{a(this.getProcessExitError(b,c))};return this.child.on("exit",b),this.exitListeners.push({callback:a,handler:b}),()=>{this.child&&this.child.off("exit",b);let a=this.exitListeners.findIndex(a=>a.handler===b);-1!==a&&this.exitListeners.splice(a,1)}}async waitForExit(){if(!this.child||null!==this.child.exitCode||this.child.killed){if(this.exitError)throw this.exitError;return}return new Promise((a,b)=>{let c=(c,d)=>{if(this.abortController.signal.aborted)return void b(new a6("Operation aborted"));let e=this.getProcessExitError(c,d);e?b(e):a()};this.child.once("exit",c);let d=a=>{this.child.off("exit",c),b(a)};this.child.once("error",d),this.child.once("exit",()=>{this.child.off("error",d)})})}}function a9(a){return![".js",".mjs",".tsx",".ts",".jsx"].some(b=>a.endsWith(b))}class ba{returned;queue=[];readResolve;readReject;isDone=!1;hasError;started=!1;constructor(a){this.returned=a}[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((a,b)=>{this.readResolve=a,this.readReject=b})}enqueue(a){if(this.readResolve){let b=this.readResolve;this.readResolve=void 0,this.readReject=void 0,b({done:!1,value:a})}else this.queue.push(a)}done(){if(this.isDone=!0,this.readResolve){let a=this.readResolve;this.readResolve=void 0,this.readReject=void 0,a({done:!0,value:void 0})}}error(a){if(this.hasError=a,this.readReject){let b=this.readReject;this.readResolve=void 0,this.readReject=void 0,b(a)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}}class bb{sendMcpMessage;isClosed=!1;constructor(a){this.sendMcpMessage=a}onclose;onerror;onmessage;async start(){}async send(a){if(this.isClosed)throw Error("Transport is closed");this.sendMcpMessage(a)}async close(){this.isClosed||(this.isClosed=!0,this.onclose?.())}}class bc{transport;isStreamingMode;canUseTool;hooks;abortController;pendingControlResponses=new Map;cleanupPerformed=!1;sdkMessages;inputStream=new ba;initialization;cancelControllers=new Map;hookCallbacks=new Map;nextCallbackId=0;sdkMcpTransports=new Map;pendingMcpResponses=new Map;constructor(a,b,c,d,e,f=new Map){for(let[g,h]of(this.transport=a,this.isStreamingMode=b,this.canUseTool=c,this.hooks=d,this.abortController=e,f)){let a=new bb(a=>this.sendMcpServerMessageToCli(g,a));this.sdkMcpTransports.set(g,a),h.connect(a)}this.sdkMessages=this.readSdkMessages(),this.readMessages(),this.isStreamingMode&&(this.initialization=this.initialize())}setError(a){this.inputStream.error(a)}cleanup(a){if(!this.cleanupPerformed){this.cleanupPerformed=!0;try{this.transport.close(),this.pendingControlResponses.clear(),this.pendingMcpResponses.clear(),a?this.inputStream.error(a):this.inputStream.done()}catch(a){}}}next(...[a]){return this.sdkMessages.next(a)}return(a){return this.sdkMessages.return(a)}throw(a){return this.sdkMessages.throw(a)}[Symbol.asyncIterator](){return this.sdkMessages}[Symbol.asyncDispose](){return this.sdkMessages[Symbol.asyncDispose]()}async readMessages(){try{for await(let a of this.transport.readMessages()){if("control_response"===a.type){let b=this.pendingControlResponses.get(a.response.request_id);b&&b(a.response);continue}if("control_request"===a.type){this.handleControlRequest(a);continue}if("control_cancel_request"===a.type){this.handleControlCancelRequest(a);continue}this.inputStream.enqueue(a)}this.inputStream.done(),this.cleanup()}catch(a){this.inputStream.error(a),this.cleanup(a)}}async handleControlRequest(a){let b=new AbortController;this.cancelControllers.set(a.request_id,b);try{let c=await this.processControlRequest(a,b.signal),d={type:"control_response",response:{subtype:"success",request_id:a.request_id,response:c}};await Promise.resolve(this.transport.write(JSON.stringify(d)+`
`))}catch(c){let b={type:"control_response",response:{subtype:"error",request_id:a.request_id,error:c.message||String(c)}};await Promise.resolve(this.transport.write(JSON.stringify(b)+`
`))}finally{this.cancelControllers.delete(a.request_id)}}handleControlCancelRequest(a){let b=this.cancelControllers.get(a.request_id);b&&(b.abort(),this.cancelControllers.delete(a.request_id))}async processControlRequest(a,b){if("can_use_tool"===a.request.subtype){if(!this.canUseTool)throw Error("canUseTool callback is not provided.");return this.canUseTool(a.request.tool_name,a.request.input,{signal:b,suggestions:a.request.permission_suggestions})}if("hook_callback"===a.request.subtype)return await this.handleHookCallbacks(a.request.callback_id,a.request.input,a.request.tool_use_id,b);if("mcp_message"===a.request.subtype){let b=a.request,c=this.sdkMcpTransports.get(b.server_name);if(!c)throw Error(`SDK MCP server not found: ${b.server_name}`);return"method"in b.message&&"id"in b.message&&null!==b.message.id?{mcp_response:await this.handleMcpControlRequest(b.server_name,b,c)}:(c.onmessage&&c.onmessage(b.message),{mcp_response:{jsonrpc:"2.0",result:{},id:0}})}throw Error("Unsupported control request subtype: "+a.request.subtype)}async *readSdkMessages(){for await(let a of this.inputStream)yield a}async initialize(){let a;if(this.hooks)for(let[b,c]of(a={},Object.entries(this.hooks)))c.length>0&&(a[b]=c.map(a=>{let b=[];for(let c of a.hooks){let a=`hook_${this.nextCallbackId++}`;this.hookCallbacks.set(a,c),b.push(a)}return{matcher:a.matcher,hookCallbackIds:b}}));let b={subtype:"initialize",hooks:a};return(await this.request(b)).response}async interrupt(){await this.request({subtype:"interrupt"})}async setPermissionMode(a){await this.request({subtype:"set_permission_mode",mode:a})}async setModel(a){await this.request({subtype:"set_model",model:a})}request(a){if(!this.isStreamingMode)throw Error(`${a.subtype} requires --input-format stream-json`);let b=Math.random().toString(36).substring(2,15),c={request_id:b,type:"control_request",request:a};return new Promise((a,d)=>{this.pendingControlResponses.set(b,b=>{"success"===b.subtype?a(b):d(Error(b.error))}),Promise.resolve(this.transport.write(JSON.stringify(c)+`
`))})}async supportedCommands(){if(!this.isStreamingMode||!this.initialization)throw Error("supportedCommands is only supported in streaming mode");return(await this.initialization).commands}async supportedModels(){if(!this.isStreamingMode||!this.initialization)throw Error("supportedModels is only supported in streaming mode");return(await this.initialization).models}async streamInput(a){try{for await(let b of a){if(this.abortController?.signal.aborted)break;await Promise.resolve(this.transport.write(JSON.stringify(b)+`
`))}this.transport.endInput()}catch(a){if(!(a instanceof a6))throw a}}handleHookCallbacks(a,b,c,d){let e=this.hookCallbacks.get(a);if(!e)throw Error(`No hook callback found for ID: ${a}`);return e(b,c,{signal:d})}sendMcpServerMessageToCli(a,b){if("id"in b&&null!==b.id&&void 0!==b.id){let c=`${a}:${b.id}`,d=this.pendingMcpResponses.get(c);if(d){d.resolve(b),this.pendingMcpResponses.delete(c);return}}throw Error("No pending request found")}handleMcpControlRequest(a,b,c){let d="id"in b.message?b.message.id:null,e=`${a}:${d}`;return new Promise((a,d)=>{let f=null,g=()=>{f&&clearTimeout(f),this.pendingMcpResponses.delete(e)};if(this.pendingMcpResponses.set(e,{resolve:b=>{g(),a(b)},reject:a=>{g(),d(a)}}),c.onmessage)c.onmessage(b.message);else{g(),d(Error("No message handler registered"));return}f=setTimeout(()=>{this.pendingMcpResponses.has(e)&&(g(),d(Error("Request timeout")))},3e4)})}}var bd={};((a,b)=>{for(var c in b)ai(a,c,{get:b[c],enumerable:!0,configurable:!0,set:a=>b[c]=()=>a})})(bd,{void:()=>cL,util:()=>d,unknown:()=>cJ,union:()=>cP,undefined:()=>cG,tuple:()=>cS,transformer:()=>c0,symbol:()=>cF,string:()=>cz,strictObject:()=>cO,setErrorMap:()=>bl,set:()=>cV,record:()=>cT,quotelessJson:()=>bh,promise:()=>c_,preprocess:()=>c3,pipeline:()=>c4,ostring:()=>c5,optional:()=>c1,onumber:()=>c6,oboolean:()=>c7,objectUtil:()=>e,object:()=>cN,number:()=>cA,nullable:()=>c2,null:()=>cH,never:()=>cK,nativeEnum:()=>c$,nan:()=>cB,map:()=>cU,makeIssue:()=>bn,literal:()=>cY,lazy:()=>cX,late:()=>cx,isValid:()=>bw,isDirty:()=>bv,isAsync:()=>bx,isAborted:()=>bu,intersection:()=>cR,instanceof:()=>cy,getParsedType:()=>bf,getErrorMap:()=>bm,function:()=>cW,enum:()=>cZ,effect:()=>c0,discriminatedUnion:()=>cQ,defaultErrorMap:()=>bj,datetimeRegex:()=>bT,date:()=>cE,custom:()=>cw,coerce:()=>c8,boolean:()=>cD,bigint:()=>cC,array:()=>cM,any:()=>cI,addIssueToContext:()=>bp,ZodVoid:()=>b3,ZodUnknown:()=>b1,ZodUnion:()=>b6,ZodUndefined:()=>b$,ZodType:()=>bB,ZodTuple:()=>ca,ZodTransformer:()=>cl,ZodSymbol:()=>bZ,ZodString:()=>bU,ZodSet:()=>cd,ZodSchema:()=>bB,ZodRecord:()=>cb,ZodReadonly:()=>cu,ZodPromise:()=>ck,ZodPipeline:()=>ct,ZodParsedType:()=>be,ZodOptional:()=>cm,ZodObject:()=>b5,ZodNumber:()=>bV,ZodNullable:()=>cn,ZodNull:()=>b_,ZodNever:()=>b2,ZodNativeEnum:()=>cj,ZodNaN:()=>cq,ZodMap:()=>cc,ZodLiteral:()=>cg,ZodLazy:()=>cf,ZodIssueCode:()=>bg,ZodIntersection:()=>b9,ZodFunction:()=>ce,ZodFirstPartyTypeKind:()=>h,ZodError:()=>bi,ZodEnum:()=>ci,ZodEffects:()=>cl,ZodDiscriminatedUnion:()=>b8,ZodDefault:()=>co,ZodDate:()=>bY,ZodCatch:()=>cp,ZodBranded:()=>cs,ZodBoolean:()=>bX,ZodBigInt:()=>bW,ZodArray:()=>b4,ZodAny:()=>b0,Schema:()=>bB,ParseStatus:()=>bq,OK:()=>bt,NEVER:()=>c9,INVALID:()=>br,EMPTY_PATH:()=>bo,DIRTY:()=>bs,BRAND:()=>cr}),function(a){a.assertEqual=a=>{},a.assertIs=function(a){},a.assertNever=function(a){throw Error()},a.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},a.getValidEnumValues=b=>{let c=a.objectKeys(b).filter(a=>"number"!=typeof b[b[a]]),d={};for(let a of c)d[a]=b[a];return a.objectValues(d)},a.objectValues=b=>a.objectKeys(b).map(function(a){return b[a]}),a.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},a.find=(a,b)=>{for(let c of a)if(b(c))return c},a.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,a.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},a.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b}(d||(d={})),(e||(e={})).mergeShapes=(a,b)=>({...a,...b});var be=d.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bf=a=>{switch(typeof a){case"undefined":return be.undefined;case"string":return be.string;case"number":return Number.isNaN(a)?be.nan:be.number;case"boolean":return be.boolean;case"function":return be.function;case"bigint":return be.bigint;case"symbol":return be.symbol;case"object":if(Array.isArray(a))return be.array;if(null===a)return be.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return be.promise;if("undefined"!=typeof Map&&a instanceof Map)return be.map;if("undefined"!=typeof Set&&a instanceof Set)return be.set;if("undefined"!=typeof Date&&a instanceof Date)return be.date;return be.object;default:return be.unknown}},bg=d.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),bh=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class bi extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof bi))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,d.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}bi.create=a=>new bi(a);var bj=(a,b)=>{let c;switch(a.code){case bg.invalid_type:c=a.received===be.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case bg.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,d.jsonStringifyReplacer)}`;break;case bg.unrecognized_keys:c=`Unrecognized key(s) in object: ${d.joinValues(a.keys,", ")}`;break;case bg.invalid_union:c="Invalid input";break;case bg.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${d.joinValues(a.options)}`;break;case bg.invalid_enum_value:c=`Invalid enum value. Expected ${d.joinValues(a.options)}, received '${a.received}'`;break;case bg.invalid_arguments:c="Invalid function arguments";break;case bg.invalid_return_type:c="Invalid function return type";break;case bg.invalid_date:c="Invalid date";break;case bg.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:d.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case bg.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case bg.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case bg.custom:c="Invalid input";break;case bg.invalid_intersection_types:c="Intersection results could not be merged";break;case bg.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case bg.not_finite:c="Number must be finite";break;default:c=b.defaultError,d.assertNever(a)}return{message:c}},bk=bj;function bl(a){bk=a}function bm(){return bk}var bn=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},bo=[];function bp(a,b){let c=bk,d=bn({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===bj?void 0:bj].filter(a=>!!a)});a.common.issues.push(d)}class bq{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return br;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return bq.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return br;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}var br=Object.freeze({status:"aborted"}),bs=a=>({status:"dirty",value:a}),bt=a=>({status:"valid",value:a}),bu=a=>"aborted"===a.status,bv=a=>"dirty"===a.status,bw=a=>"valid"===a.status,bx=a=>"undefined"!=typeof Promise&&a instanceof Promise;!function(a){a.errToObj=a=>"string"==typeof a?{message:a}:a||{},a.toString=a=>"string"==typeof a?a:a?.message}(f||(f={}));class by{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}var bz=(a,b)=>{if(bw(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new bi(a.common.issues);return this._error=b,this._error}}};function bA(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class bB{get description(){return this._def.description}_getType(a){return bf(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:bf(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new bq,ctx:{common:a.parent.common,data:a.data,parsedType:bf(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(bx(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bf(a)},d=this._parseSync({data:a,path:c.path,parent:c});return bz(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bf(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return bw(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>bw(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bf(a)},d=this._parse({data:a,path:c.path,parent:c});return bz(c,await (bx(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:bg.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new cl({schema:this,typeName:h.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return cm.create(this,this._def)}nullable(){return cn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return b4.create(this)}promise(){return ck.create(this,this._def)}or(a){return b6.create([this,a],this._def)}and(a){return b9.create(this,a,this._def)}transform(a){return new cl({...bA(this._def),schema:this,typeName:h.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new co({...bA(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:h.ZodDefault})}brand(){return new cs({typeName:h.ZodBranded,type:this,...bA(this._def)})}catch(a){return new cp({...bA(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:h.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return ct.create(this,a)}readonly(){return cu.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var bC=/^c[^\s-]{8,}$/i,bD=/^[0-9a-z]+$/,bE=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bG=/^[a-z0-9_-]{21}$/i,bH=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bI=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bJ=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bK=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,bL=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,bM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bN=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bO=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bP=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,bQ="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bR=RegExp(`^${bQ}$`);function bS(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function bT(a){let b=`${bQ}T${bS(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class bU extends bB{_parse(a){var b,c,e,f;let h;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==be.string){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.string,received:b.parsedType}),br}let i=new bq;for(let j of this._def.checks)if("min"===j.kind)a.data.length<j.value&&(bp(h=this._getOrReturnCtx(a,h),{code:bg.too_small,minimum:j.value,type:"string",inclusive:!0,exact:!1,message:j.message}),i.dirty());else if("max"===j.kind)a.data.length>j.value&&(bp(h=this._getOrReturnCtx(a,h),{code:bg.too_big,maximum:j.value,type:"string",inclusive:!0,exact:!1,message:j.message}),i.dirty());else if("length"===j.kind){let b=a.data.length>j.value,c=a.data.length<j.value;(b||c)&&(h=this._getOrReturnCtx(a,h),b?bp(h,{code:bg.too_big,maximum:j.value,type:"string",inclusive:!0,exact:!0,message:j.message}):c&&bp(h,{code:bg.too_small,minimum:j.value,type:"string",inclusive:!0,exact:!0,message:j.message}),i.dirty())}else if("email"===j.kind)bJ.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"email",code:bg.invalid_string,message:j.message}),i.dirty());else if("emoji"===j.kind)g||(g=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),g.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"emoji",code:bg.invalid_string,message:j.message}),i.dirty());else if("uuid"===j.kind)bF.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"uuid",code:bg.invalid_string,message:j.message}),i.dirty());else if("nanoid"===j.kind)bG.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"nanoid",code:bg.invalid_string,message:j.message}),i.dirty());else if("cuid"===j.kind)bC.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"cuid",code:bg.invalid_string,message:j.message}),i.dirty());else if("cuid2"===j.kind)bD.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"cuid2",code:bg.invalid_string,message:j.message}),i.dirty());else if("ulid"===j.kind)bE.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"ulid",code:bg.invalid_string,message:j.message}),i.dirty());else if("url"===j.kind)try{new URL(a.data)}catch{bp(h=this._getOrReturnCtx(a,h),{validation:"url",code:bg.invalid_string,message:j.message}),i.dirty()}else"regex"===j.kind?(j.regex.lastIndex=0,j.regex.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"regex",code:bg.invalid_string,message:j.message}),i.dirty())):"trim"===j.kind?a.data=a.data.trim():"includes"===j.kind?a.data.includes(j.value,j.position)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:{includes:j.value,position:j.position},message:j.message}),i.dirty()):"toLowerCase"===j.kind?a.data=a.data.toLowerCase():"toUpperCase"===j.kind?a.data=a.data.toUpperCase():"startsWith"===j.kind?a.data.startsWith(j.value)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:{startsWith:j.value},message:j.message}),i.dirty()):"endsWith"===j.kind?a.data.endsWith(j.value)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:{endsWith:j.value},message:j.message}),i.dirty()):"datetime"===j.kind?bT(j).test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:"datetime",message:j.message}),i.dirty()):"date"===j.kind?bR.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:"date",message:j.message}),i.dirty()):"time"===j.kind?RegExp(`^${bS(j)}$`).test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{code:bg.invalid_string,validation:"time",message:j.message}),i.dirty()):"duration"===j.kind?bI.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"duration",code:bg.invalid_string,message:j.message}),i.dirty()):"ip"===j.kind?(b=a.data,!(("v4"===(c=j.version)||!c)&&bK.test(b)||("v6"===c||!c)&&bM.test(b))&&1&&(bp(h=this._getOrReturnCtx(a,h),{validation:"ip",code:bg.invalid_string,message:j.message}),i.dirty())):"jwt"===j.kind?!function(a,b){if(!bH.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,j.alg)&&(bp(h=this._getOrReturnCtx(a,h),{validation:"jwt",code:bg.invalid_string,message:j.message}),i.dirty()):"cidr"===j.kind?(e=a.data,!(("v4"===(f=j.version)||!f)&&bL.test(e)||("v6"===f||!f)&&bN.test(e))&&1&&(bp(h=this._getOrReturnCtx(a,h),{validation:"cidr",code:bg.invalid_string,message:j.message}),i.dirty())):"base64"===j.kind?bO.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"base64",code:bg.invalid_string,message:j.message}),i.dirty()):"base64url"===j.kind?bP.test(a.data)||(bp(h=this._getOrReturnCtx(a,h),{validation:"base64url",code:bg.invalid_string,message:j.message}),i.dirty()):d.assertNever(j);return{status:i.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:bg.invalid_string,...f.errToObj(c)})}_addCheck(a){return new bU({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...f.errToObj(a)})}url(a){return this._addCheck({kind:"url",...f.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...f.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...f.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...f.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...f.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...f.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...f.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...f.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...f.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...f.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...f.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...f.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...f.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...f.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...f.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...f.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...f.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...f.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...f.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...f.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...f.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...f.errToObj(b)})}nonempty(a){return this.min(1,f.errToObj(a))}trim(){return new bU({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bU({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bU({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bU.create=a=>new bU({checks:[],typeName:h.ZodString,coerce:a?.coerce??!1,...bA(a)});class bV extends bB{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==be.number){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.number,received:b.parsedType}),br}let c=new bq;for(let e of this._def.checks)"int"===e.kind?d.isInteger(a.data)||(bp(b=this._getOrReturnCtx(a,b),{code:bg.invalid_type,expected:"integer",received:"float",message:e.message}),c.dirty()):"min"===e.kind?(e.inclusive?a.data<e.value:a.data<=e.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_small,minimum:e.value,type:"number",inclusive:e.inclusive,exact:!1,message:e.message}),c.dirty()):"max"===e.kind?(e.inclusive?a.data>e.value:a.data>=e.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_big,maximum:e.value,type:"number",inclusive:e.inclusive,exact:!1,message:e.message}),c.dirty()):"multipleOf"===e.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,e.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.not_multiple_of,multipleOf:e.value,message:e.message}),c.dirty()):"finite"===e.kind?Number.isFinite(a.data)||(bp(b=this._getOrReturnCtx(a,b),{code:bg.not_finite,message:e.message}),c.dirty()):d.assertNever(e);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,f.toString(b))}gt(a,b){return this.setLimit("min",a,!1,f.toString(b))}lte(a,b){return this.setLimit("max",a,!0,f.toString(b))}lt(a,b){return this.setLimit("max",a,!1,f.toString(b))}setLimit(a,b,c,d){return new bV({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:f.toString(d)}]})}_addCheck(a){return new bV({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:f.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:f.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:f.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:f.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:f.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:f.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:f.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:f.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:f.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&d.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}bV.create=a=>new bV({checks:[],typeName:h.ZodNumber,coerce:a?.coerce||!1,...bA(a)});class bW extends bB{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==be.bigint)return this._getInvalidInput(a);let c=new bq;for(let e of this._def.checks)"min"===e.kind?(e.inclusive?a.data<e.value:a.data<=e.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_small,type:"bigint",minimum:e.value,inclusive:e.inclusive,message:e.message}),c.dirty()):"max"===e.kind?(e.inclusive?a.data>e.value:a.data>=e.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_big,type:"bigint",maximum:e.value,inclusive:e.inclusive,message:e.message}),c.dirty()):"multipleOf"===e.kind?a.data%e.value!==BigInt(0)&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.not_multiple_of,multipleOf:e.value,message:e.message}),c.dirty()):d.assertNever(e);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.bigint,received:b.parsedType}),br}gte(a,b){return this.setLimit("min",a,!0,f.toString(b))}gt(a,b){return this.setLimit("min",a,!1,f.toString(b))}lte(a,b){return this.setLimit("max",a,!0,f.toString(b))}lt(a,b){return this.setLimit("max",a,!1,f.toString(b))}setLimit(a,b,c,d){return new bW({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:f.toString(d)}]})}_addCheck(a){return new bW({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:f.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:f.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:f.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:f.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:f.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bW.create=a=>new bW({checks:[],typeName:h.ZodBigInt,coerce:a?.coerce??!1,...bA(a)});class bX extends bB{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==be.boolean){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.boolean,received:b.parsedType}),br}return bt(a.data)}}bX.create=a=>new bX({typeName:h.ZodBoolean,coerce:a?.coerce||!1,...bA(a)});class bY extends bB{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==be.date){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.date,received:b.parsedType}),br}if(Number.isNaN(a.data.getTime()))return bp(this._getOrReturnCtx(a),{code:bg.invalid_date}),br;let c=new bq;for(let e of this._def.checks)"min"===e.kind?a.data.getTime()<e.value&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_small,message:e.message,inclusive:!0,exact:!1,minimum:e.value,type:"date"}),c.dirty()):"max"===e.kind?a.data.getTime()>e.value&&(bp(b=this._getOrReturnCtx(a,b),{code:bg.too_big,message:e.message,inclusive:!0,exact:!1,maximum:e.value,type:"date"}),c.dirty()):d.assertNever(e);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new bY({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:f.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:f.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}bY.create=a=>new bY({checks:[],coerce:a?.coerce||!1,typeName:h.ZodDate,...bA(a)});class bZ extends bB{_parse(a){if(this._getType(a)!==be.symbol){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.symbol,received:b.parsedType}),br}return bt(a.data)}}bZ.create=a=>new bZ({typeName:h.ZodSymbol,...bA(a)});class b$ extends bB{_parse(a){if(this._getType(a)!==be.undefined){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.undefined,received:b.parsedType}),br}return bt(a.data)}}b$.create=a=>new b$({typeName:h.ZodUndefined,...bA(a)});class b_ extends bB{_parse(a){if(this._getType(a)!==be.null){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.null,received:b.parsedType}),br}return bt(a.data)}}b_.create=a=>new b_({typeName:h.ZodNull,...bA(a)});class b0 extends bB{constructor(){super(...arguments),this._any=!0}_parse(a){return bt(a.data)}}b0.create=a=>new b0({typeName:h.ZodAny,...bA(a)});class b1 extends bB{constructor(){super(...arguments),this._unknown=!0}_parse(a){return bt(a.data)}}b1.create=a=>new b1({typeName:h.ZodUnknown,...bA(a)});class b2 extends bB{_parse(a){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.never,received:b.parsedType}),br}}b2.create=a=>new b2({typeName:h.ZodNever,...bA(a)});class b3 extends bB{_parse(a){if(this._getType(a)!==be.undefined){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.void,received:b.parsedType}),br}return bt(a.data)}}b3.create=a=>new b3({typeName:h.ZodVoid,...bA(a)});class b4 extends bB{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==be.array)return bp(b,{code:bg.invalid_type,expected:be.array,received:b.parsedType}),br;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(bp(b,{code:a?bg.too_big:bg.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(bp(b,{code:bg.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(bp(b,{code:bg.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new by(b,a,b.path,c)))).then(a=>bq.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new by(b,a,b.path,c)));return bq.mergeArray(c,e)}get element(){return this._def.type}min(a,b){return new b4({...this._def,minLength:{value:a,message:f.toString(b)}})}max(a,b){return new b4({...this._def,maxLength:{value:a,message:f.toString(b)}})}length(a,b){return new b4({...this._def,exactLength:{value:a,message:f.toString(b)}})}nonempty(a){return this.min(1,a)}}b4.create=(a,b)=>new b4({type:a,minLength:null,maxLength:null,exactLength:null,typeName:h.ZodArray,...bA(b)});class b5 extends bB{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=d.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==be.object){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.object,received:b.parsedType}),br}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof b2&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new by(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof b2){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(bp(c,{code:bg.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new by(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>bq.mergeObjectSync(b,a)):bq.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(a){return f.errToObj,new b5({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:f.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new b5({...this._def,unknownKeys:"strip"})}passthrough(){return new b5({...this._def,unknownKeys:"passthrough"})}extend(a){return new b5({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new b5({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:h.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new b5({...this._def,catchall:a})}pick(a){let b={};for(let c of d.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new b5({...this._def,shape:()=>b})}omit(a){let b={};for(let c of d.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new b5({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof b5){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=cm.create(a(e))}return new b5({...b._def,shape:()=>c})}if(b instanceof b4)return new b4({...b._def,type:a(b.element)});if(b instanceof cm)return cm.create(a(b.unwrap()));if(b instanceof cn)return cn.create(a(b.unwrap()));if(b instanceof ca)return ca.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of d.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new b5({...this._def,shape:()=>b})}required(a){let b={};for(let c of d.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof cm;)a=a._def.innerType;b[c]=a}return new b5({...this._def,shape:()=>b})}keyof(){return ch(d.objectKeys(this.shape))}}b5.create=(a,b)=>new b5({shape:()=>a,unknownKeys:"strip",catchall:b2.create(),typeName:h.ZodObject,...bA(b)}),b5.strictCreate=(a,b)=>new b5({shape:()=>a,unknownKeys:"strict",catchall:b2.create(),typeName:h.ZodObject,...bA(b)}),b5.lazycreate=(a,b)=>new b5({shape:a,unknownKeys:"strip",catchall:b2.create(),typeName:h.ZodObject,...bA(b)});class b6 extends bB{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new bi(a.ctx.common.issues));return bp(b,{code:bg.invalid_union,unionErrors:c}),br});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new bi(a));return bp(b,{code:bg.invalid_union,unionErrors:e}),br}}get options(){return this._def.options}}b6.create=(a,b)=>new b6({options:a,typeName:h.ZodUnion,...bA(b)});var b7=a=>{if(a instanceof cf)return b7(a.schema);if(a instanceof cl)return b7(a.innerType());if(a instanceof cg)return[a.value];if(a instanceof ci)return a.options;if(a instanceof cj)return d.objectValues(a.enum);else if(a instanceof co)return b7(a._def.innerType);else if(a instanceof b$)return[void 0];else if(a instanceof b_)return[null];else if(a instanceof cm)return[void 0,...b7(a.unwrap())];else if(a instanceof cn)return[null,...b7(a.unwrap())];else if(a instanceof cs)return b7(a.unwrap());else if(a instanceof cu)return b7(a.unwrap());else if(a instanceof cp)return b7(a._def.innerType);else return[]};class b8 extends bB{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==be.object)return bp(b,{code:bg.invalid_type,expected:be.object,received:b.parsedType}),br;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(bp(b,{code:bg.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),br)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=b7(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new b8({typeName:h.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...bA(c)})}}class b9 extends bB{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),e=(a,e)=>{if(bu(a)||bu(e))return br;let f=function a(b,c){let e=bf(b),f=bf(c);if(b===c)return{valid:!0,data:b};if(e===be.object&&f===be.object){let e=d.objectKeys(c),f=d.objectKeys(b).filter(a=>-1!==e.indexOf(a)),g={...b,...c};for(let d of f){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};g[d]=e.data}return{valid:!0,data:g}}if(e===be.array&&f===be.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(e===be.date&&f===be.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,e.value);return f.valid?((bv(a)||bv(e))&&b.dirty(),{status:b.value,value:f.data}):(bp(c,{code:bg.invalid_intersection_types}),br)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>e(a,b)):e(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}b9.create=(a,b,c)=>new b9({left:a,right:b,typeName:h.ZodIntersection,...bA(c)});class ca extends bB{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==be.array)return bp(c,{code:bg.invalid_type,expected:be.array,received:c.parsedType}),br;if(c.data.length<this._def.items.length)return bp(c,{code:bg.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),br;!this._def.rest&&c.data.length>this._def.items.length&&(bp(c,{code:bg.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new by(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>bq.mergeArray(b,a)):bq.mergeArray(b,d)}get items(){return this._def.items}rest(a){return new ca({...this._def,rest:a})}}ca.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ca({items:a,typeName:h.ZodTuple,rest:null,...bA(b)})};class cb extends bB{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==be.object)return bp(c,{code:bg.invalid_type,expected:be.object,received:c.parsedType}),br;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new by(c,a,c.path,a)),value:f._parse(new by(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?bq.mergeObjectAsync(b,d):bq.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(a,b,c){return new cb(b instanceof bB?{keyType:a,valueType:b,typeName:h.ZodRecord,...bA(c)}:{keyType:bU.create(),valueType:a,typeName:h.ZodRecord,...bA(b)})}}class cc extends bB{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==be.map)return bp(c,{code:bg.invalid_type,expected:be.map,received:c.parsedType}),br;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new by(c,a,c.path,[f,"key"])),value:e._parse(new by(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return br;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return br;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}cc.create=(a,b,c)=>new cc({valueType:b,keyType:a,typeName:h.ZodMap,...bA(c)});class cd extends bB{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==be.set)return bp(c,{code:bg.invalid_type,expected:be.set,received:c.parsedType}),br;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(bp(c,{code:bg.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(bp(c,{code:bg.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return br;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new by(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(a,b){return new cd({...this._def,minSize:{value:a,message:f.toString(b)}})}max(a,b){return new cd({...this._def,maxSize:{value:a,message:f.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}cd.create=(a,b)=>new cd({valueType:a,minSize:null,maxSize:null,typeName:h.ZodSet,...bA(b)});class ce extends bB{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==be.function)return bp(b,{code:bg.invalid_type,expected:be.function,received:b.parsedType}),br;function c(a,c){return bn({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,bk,bj].filter(a=>!!a),issueData:{code:bg.invalid_arguments,argumentsError:c}})}function d(a,c){return bn({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,bk,bj].filter(a=>!!a),issueData:{code:bg.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof ck){let a=this;return bt(async function(...b){let g=new bi([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return bt(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new bi([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new bi([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new ce({...this._def,args:ca.create(a).rest(b1.create())})}returns(a){return new ce({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new ce({args:a||ca.create([]).rest(b1.create()),returns:b||b1.create(),typeName:h.ZodFunction,...bA(c)})}}class cf extends bB{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}cf.create=(a,b)=>new cf({getter:a,typeName:h.ZodLazy,...bA(b)});class cg extends bB{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return bp(b,{received:b.data,code:bg.invalid_literal,expected:this._def.value}),br}return{status:"valid",value:a.data}}get value(){return this._def.value}}function ch(a,b){return new ci({values:a,typeName:h.ZodEnum,...bA(b)})}cg.create=(a,b)=>new cg({value:a,typeName:h.ZodLiteral,...bA(b)});class ci extends bB{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return bp(b,{expected:d.joinValues(c),received:b.parsedType,code:bg.invalid_type}),br}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return bp(b,{received:b.data,code:bg.invalid_enum_value,options:c}),br}return bt(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return ci.create(a,{...this._def,...b})}exclude(a,b=this._def){return ci.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}ci.create=ch;class cj extends bB{_parse(a){let b=d.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==be.string&&c.parsedType!==be.number){let a=d.objectValues(b);return bp(c,{expected:d.joinValues(a),received:c.parsedType,code:bg.invalid_type}),br}if(this._cache||(this._cache=new Set(d.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=d.objectValues(b);return bp(c,{received:c.data,code:bg.invalid_enum_value,options:a}),br}return bt(a.data)}get enum(){return this._def.values}}cj.create=(a,b)=>new cj({values:a,typeName:h.ZodNativeEnum,...bA(b)});class ck extends bB{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==be.promise&&!1===b.common.async?(bp(b,{code:bg.invalid_type,expected:be.promise,received:b.parsedType}),br):bt((b.parsedType===be.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}ck.create=(a,b)=>new ck({type:a,typeName:h.ZodPromise,...bA(b)});class cl extends bB{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===h.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),e=this._def.effect||null,f={addIssue:a=>{bp(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(f.addIssue=f.addIssue.bind(f),"preprocess"===e.type){let a=e.transform(c.data,f);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return br;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?br:"dirty"===d.status||"dirty"===b.value?bs(d.value):d});{if("aborted"===b.value)return br;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?br:"dirty"===d.status||"dirty"===b.value?bs(d.value):d}}if("refinement"===e.type){let a=a=>{let b=e.refinement(a,f);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?br:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?br:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===e.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>bw(a)?Promise.resolve(e.transform(a.value,f)).then(a=>({status:b.value,value:a})):br);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!bw(a))return br;let d=e.transform(a.value,f);if(d instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:d}}d.assertNever(e)}}cl.create=(a,b,c)=>new cl({schema:a,typeName:h.ZodEffects,effect:b,...bA(c)}),cl.createWithPreprocess=(a,b,c)=>new cl({schema:b,effect:{type:"preprocess",transform:a},typeName:h.ZodEffects,...bA(c)});class cm extends bB{_parse(a){return this._getType(a)===be.undefined?bt(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}cm.create=(a,b)=>new cm({innerType:a,typeName:h.ZodOptional,...bA(b)});class cn extends bB{_parse(a){return this._getType(a)===be.null?bt(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}cn.create=(a,b)=>new cn({innerType:a,typeName:h.ZodNullable,...bA(b)});class co extends bB{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===be.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}co.create=(a,b)=>new co({innerType:a,typeName:h.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...bA(b)});class cp extends bB{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return bx(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new bi(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new bi(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}cp.create=(a,b)=>new cp({innerType:a,typeName:h.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...bA(b)});class cq extends bB{_parse(a){if(this._getType(a)!==be.nan){let b=this._getOrReturnCtx(a);return bp(b,{code:bg.invalid_type,expected:be.nan,received:b.parsedType}),br}return{status:"valid",value:a.data}}}cq.create=a=>new cq({typeName:h.ZodNaN,...bA(a)});var cr=Symbol("zod_brand");class cs extends bB{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class ct extends bB{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?br:"dirty"===a.status?(b.dirty(),bs(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?br:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new ct({in:a,out:b,typeName:h.ZodPipeline})}}class cu extends bB{_parse(a){let b=this._def.innerType._parse(a),c=a=>(bw(a)&&(a.value=Object.freeze(a.value)),a);return bx(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function cv(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function cw(a,b={},c){return a?b0.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=cv(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=cv(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):b0.create()}cu.create=(a,b)=>new cu({innerType:a,typeName:h.ZodReadonly,...bA(b)});var cx={object:b5.lazycreate};!function(a){a.ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline",a.ZodReadonly="ZodReadonly"}(h||(h={}));var cy=(a,b={message:`Input not instance of ${a.name}`})=>cw(b=>b instanceof a,b),cz=bU.create,cA=bV.create,cB=cq.create,cC=bW.create,cD=bX.create,cE=bY.create,cF=bZ.create,cG=b$.create,cH=b_.create,cI=b0.create,cJ=b1.create,cK=b2.create,cL=b3.create,cM=b4.create,cN=b5.create,cO=b5.strictCreate,cP=b6.create,cQ=b8.create,cR=b9.create,cS=ca.create,cT=cb.create,cU=cc.create,cV=cd.create,cW=ce.create,cX=cf.create,cY=cg.create,cZ=ci.create,c$=cj.create,c_=ck.create,c0=cl.create,c1=cm.create,c2=cn.create,c3=cl.createWithPreprocess,c4=ct.create,c5=()=>cz().optional(),c6=()=>cA().optional(),c7=()=>cD().optional(),c8={string:a=>bU.create({...a,coerce:!0}),number:a=>bV.create({...a,coerce:!0}),boolean:a=>bX.create({...a,coerce:!0}),bigint:a=>bW.create({...a,coerce:!0}),date:a=>bY.create({...a,coerce:!0})},c9=br,da=bd.union([bd.string(),bd.number().int()]),db=bd.string(),dc=bd.object({progressToken:bd.optional(da)}).passthrough(),dd=bd.object({_meta:bd.optional(dc)}).passthrough(),de=bd.object({method:bd.string(),params:bd.optional(dd)}),df=bd.object({_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),dg=bd.object({method:bd.string(),params:bd.optional(df)}),dh=bd.object({_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),di=bd.union([bd.string(),bd.number().int()]),dj=bd.object({jsonrpc:bd.literal("2.0"),id:di}).merge(de).strict(),dk=bd.object({jsonrpc:bd.literal("2.0")}).merge(dg).strict(),dl=bd.object({jsonrpc:bd.literal("2.0"),id:di,result:dh}).strict();!function(a){a[a.ConnectionClosed=-32e3]="ConnectionClosed",a[a.RequestTimeout=-32001]="RequestTimeout",a[a.ParseError=-32700]="ParseError",a[a.InvalidRequest=-32600]="InvalidRequest",a[a.MethodNotFound=-32601]="MethodNotFound",a[a.InvalidParams=-32602]="InvalidParams",a[a.InternalError=-32603]="InternalError"}(i||(i={}));var dm=bd.object({jsonrpc:bd.literal("2.0"),id:di,error:bd.object({code:bd.number().int(),message:bd.string(),data:bd.optional(bd.unknown())})}).strict();bd.union([dj,dk,dl,dm]);var dn=dh.strict(),dp=dg.extend({method:bd.literal("notifications/cancelled"),params:df.extend({requestId:di,reason:bd.string().optional()})}),dq=bd.object({name:bd.string(),title:bd.optional(bd.string())}).passthrough(),dr=dq.extend({version:bd.string()}),ds=bd.object({experimental:bd.optional(bd.object({}).passthrough()),sampling:bd.optional(bd.object({}).passthrough()),elicitation:bd.optional(bd.object({}).passthrough()),roots:bd.optional(bd.object({listChanged:bd.optional(bd.boolean())}).passthrough())}).passthrough(),dt=de.extend({method:bd.literal("initialize"),params:dd.extend({protocolVersion:bd.string(),capabilities:ds,clientInfo:dr})}),du=bd.object({experimental:bd.optional(bd.object({}).passthrough()),logging:bd.optional(bd.object({}).passthrough()),completions:bd.optional(bd.object({}).passthrough()),prompts:bd.optional(bd.object({listChanged:bd.optional(bd.boolean())}).passthrough()),resources:bd.optional(bd.object({subscribe:bd.optional(bd.boolean()),listChanged:bd.optional(bd.boolean())}).passthrough()),tools:bd.optional(bd.object({listChanged:bd.optional(bd.boolean())}).passthrough())}).passthrough(),dv=dh.extend({protocolVersion:bd.string(),capabilities:du,serverInfo:dr,instructions:bd.optional(bd.string())}),dw=dg.extend({method:bd.literal("notifications/initialized")}),dx=de.extend({method:bd.literal("ping")}),dy=bd.object({progress:bd.number(),total:bd.optional(bd.number()),message:bd.optional(bd.string())}).passthrough(),dz=dg.extend({method:bd.literal("notifications/progress"),params:df.merge(dy).extend({progressToken:da})}),dA=de.extend({params:dd.extend({cursor:bd.optional(db)}).optional()}),dB=dh.extend({nextCursor:bd.optional(db)}),dC=bd.object({uri:bd.string(),mimeType:bd.optional(bd.string()),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),dD=dC.extend({text:bd.string()}),dE=bd.string().refine(a=>{try{return atob(a),!0}catch(a){return!1}},{message:"Invalid Base64 string"}),dF=dC.extend({blob:dE}),dG=dq.extend({uri:bd.string(),description:bd.optional(bd.string()),mimeType:bd.optional(bd.string()),_meta:bd.optional(bd.object({}).passthrough())}),dH=dq.extend({uriTemplate:bd.string(),description:bd.optional(bd.string()),mimeType:bd.optional(bd.string()),_meta:bd.optional(bd.object({}).passthrough())}),dI=dA.extend({method:bd.literal("resources/list")}),dJ=dB.extend({resources:bd.array(dG)}),dK=dA.extend({method:bd.literal("resources/templates/list")}),dL=dB.extend({resourceTemplates:bd.array(dH)}),dM=de.extend({method:bd.literal("resources/read"),params:dd.extend({uri:bd.string()})}),dN=dh.extend({contents:bd.array(bd.union([dD,dF]))}),dO=dg.extend({method:bd.literal("notifications/resources/list_changed")}),dP=de.extend({method:bd.literal("resources/subscribe"),params:dd.extend({uri:bd.string()})}),dQ=de.extend({method:bd.literal("resources/unsubscribe"),params:dd.extend({uri:bd.string()})}),dR=dg.extend({method:bd.literal("notifications/resources/updated"),params:df.extend({uri:bd.string()})}),dS=bd.object({name:bd.string(),description:bd.optional(bd.string()),required:bd.optional(bd.boolean())}).passthrough(),dT=dq.extend({description:bd.optional(bd.string()),arguments:bd.optional(bd.array(dS)),_meta:bd.optional(bd.object({}).passthrough())}),dU=dA.extend({method:bd.literal("prompts/list")}),dV=dB.extend({prompts:bd.array(dT)}),dW=de.extend({method:bd.literal("prompts/get"),params:dd.extend({name:bd.string(),arguments:bd.optional(bd.record(bd.string()))})}),dX=bd.object({type:bd.literal("text"),text:bd.string(),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),dY=bd.object({type:bd.literal("image"),data:dE,mimeType:bd.string(),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),dZ=bd.object({type:bd.literal("audio"),data:dE,mimeType:bd.string(),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),d$=bd.object({type:bd.literal("resource"),resource:bd.union([dD,dF]),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),d_=dG.extend({type:bd.literal("resource_link")}),d0=bd.union([dX,dY,dZ,d_,d$]),d1=bd.object({role:bd.enum(["user","assistant"]),content:d0}).passthrough(),d2=dh.extend({description:bd.optional(bd.string()),messages:bd.array(d1)}),d3=dg.extend({method:bd.literal("notifications/prompts/list_changed")}),d4=bd.object({title:bd.optional(bd.string()),readOnlyHint:bd.optional(bd.boolean()),destructiveHint:bd.optional(bd.boolean()),idempotentHint:bd.optional(bd.boolean()),openWorldHint:bd.optional(bd.boolean())}).passthrough(),d5=dq.extend({description:bd.optional(bd.string()),inputSchema:bd.object({type:bd.literal("object"),properties:bd.optional(bd.object({}).passthrough()),required:bd.optional(bd.array(bd.string()))}).passthrough(),outputSchema:bd.optional(bd.object({type:bd.literal("object"),properties:bd.optional(bd.object({}).passthrough()),required:bd.optional(bd.array(bd.string()))}).passthrough()),annotations:bd.optional(d4),_meta:bd.optional(bd.object({}).passthrough())}),d6=dA.extend({method:bd.literal("tools/list")}),d7=dB.extend({tools:bd.array(d5)}),d8=dh.extend({content:bd.array(d0).default([]),structuredContent:bd.object({}).passthrough().optional(),isError:bd.optional(bd.boolean())});d8.or(dh.extend({toolResult:bd.unknown()}));var d9=de.extend({method:bd.literal("tools/call"),params:dd.extend({name:bd.string(),arguments:bd.optional(bd.record(bd.unknown()))})}),ea=dg.extend({method:bd.literal("notifications/tools/list_changed")}),eb=bd.enum(["debug","info","notice","warning","error","critical","alert","emergency"]),ec=de.extend({method:bd.literal("logging/setLevel"),params:dd.extend({level:eb})}),ed=dg.extend({method:bd.literal("notifications/message"),params:df.extend({level:eb,logger:bd.optional(bd.string()),data:bd.unknown()})}),ee=bd.object({name:bd.string().optional()}).passthrough(),ef=bd.object({hints:bd.optional(bd.array(ee)),costPriority:bd.optional(bd.number().min(0).max(1)),speedPriority:bd.optional(bd.number().min(0).max(1)),intelligencePriority:bd.optional(bd.number().min(0).max(1))}).passthrough(),eg=bd.object({role:bd.enum(["user","assistant"]),content:bd.union([dX,dY,dZ])}).passthrough(),eh=de.extend({method:bd.literal("sampling/createMessage"),params:dd.extend({messages:bd.array(eg),systemPrompt:bd.optional(bd.string()),includeContext:bd.optional(bd.enum(["none","thisServer","allServers"])),temperature:bd.optional(bd.number()),maxTokens:bd.number().int(),stopSequences:bd.optional(bd.array(bd.string())),metadata:bd.optional(bd.object({}).passthrough()),modelPreferences:bd.optional(ef)})}),ei=dh.extend({model:bd.string(),stopReason:bd.optional(bd.enum(["endTurn","stopSequence","maxTokens"]).or(bd.string())),role:bd.enum(["user","assistant"]),content:bd.discriminatedUnion("type",[dX,dY,dZ])}),ej=bd.object({type:bd.literal("boolean"),title:bd.optional(bd.string()),description:bd.optional(bd.string()),default:bd.optional(bd.boolean())}).passthrough(),ek=bd.object({type:bd.literal("string"),title:bd.optional(bd.string()),description:bd.optional(bd.string()),minLength:bd.optional(bd.number()),maxLength:bd.optional(bd.number()),format:bd.optional(bd.enum(["email","uri","date","date-time"]))}).passthrough(),el=bd.object({type:bd.enum(["number","integer"]),title:bd.optional(bd.string()),description:bd.optional(bd.string()),minimum:bd.optional(bd.number()),maximum:bd.optional(bd.number())}).passthrough(),em=bd.object({type:bd.literal("string"),title:bd.optional(bd.string()),description:bd.optional(bd.string()),enum:bd.array(bd.string()),enumNames:bd.optional(bd.array(bd.string()))}).passthrough(),en=bd.union([ej,ek,el,em]),eo=de.extend({method:bd.literal("elicitation/create"),params:dd.extend({message:bd.string(),requestedSchema:bd.object({type:bd.literal("object"),properties:bd.record(bd.string(),en),required:bd.optional(bd.array(bd.string()))}).passthrough()})}),ep=dh.extend({action:bd.enum(["accept","decline","cancel"]),content:bd.optional(bd.record(bd.string(),bd.unknown()))}),eq=bd.object({type:bd.literal("ref/resource"),uri:bd.string()}).passthrough(),er=bd.object({type:bd.literal("ref/prompt"),name:bd.string()}).passthrough(),es=de.extend({method:bd.literal("completion/complete"),params:dd.extend({ref:bd.union([er,eq]),argument:bd.object({name:bd.string(),value:bd.string()}).passthrough(),context:bd.optional(bd.object({arguments:bd.optional(bd.record(bd.string(),bd.string()))}))})}),et=dh.extend({completion:bd.object({values:bd.array(bd.string()).max(100),total:bd.optional(bd.number().int()),hasMore:bd.optional(bd.boolean())}).passthrough()}),eu=bd.object({uri:bd.string().startsWith("file://"),name:bd.optional(bd.string()),_meta:bd.optional(bd.object({}).passthrough())}).passthrough(),ev=de.extend({method:bd.literal("roots/list")}),ew=dh.extend({roots:bd.array(eu)}),ex=dg.extend({method:bd.literal("notifications/roots/list_changed")});bd.union([dx,dt,es,ec,dW,dU,dI,dK,dM,dP,dQ,d9,d6]),bd.union([dp,dz,dw,ex]),bd.union([dn,ei,ep,ew]),bd.union([dx,eh,eo,ev]),bd.union([dp,dz,ed,dR,dO,ea,d3]),bd.union([dn,dv,et,d2,dV,dJ,dL,dN,d8,d7]),((a,b,c)=>{c=null!=a?ag(ah(a)):{};let d=!b&&a&&a.__esModule?c:ai(c,"default",{value:a,enumerable:!0});for(let b of aj(a))ak.call(d,b)||ai(d,b,{get:()=>a[b],enumerable:!0})})(a3(),1);var ey=Symbol("Let zodToJsonSchema decide on which parser to use");function ez(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function eA(a,b,c,d,e){a[b]=c,ez(a,b,d,e)}function eB(a,b){return eN(a.type._def,b)}var eC=void 0,eD={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===eC&&(eC=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),eC),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function eE(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":eA(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":eA(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":eH(c,"email",d.message,b);break;case"format:idn-email":eH(c,"idn-email",d.message,b);break;case"pattern:zod":eI(c,eD.email,d.message,b)}break;case"url":eH(c,"uri",d.message,b);break;case"uuid":eH(c,"uuid",d.message,b);break;case"regex":eI(c,d.regex,d.message,b);break;case"cuid":eI(c,eD.cuid,d.message,b);break;case"cuid2":eI(c,eD.cuid2,d.message,b);break;case"startsWith":eI(c,RegExp(`^${eF(d.value,b)}`),d.message,b);break;case"endsWith":eI(c,RegExp(`${eF(d.value,b)}$`),d.message,b);break;case"datetime":eH(c,"date-time",d.message,b);break;case"date":eH(c,"date",d.message,b);break;case"time":eH(c,"time",d.message,b);break;case"duration":eH(c,"duration",d.message,b);break;case"length":eA(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),eA(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":eI(c,RegExp(eF(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&eH(c,"ipv4",d.message,b),"v4"!==d.version&&eH(c,"ipv6",d.message,b);break;case"base64url":eI(c,eD.base64url,d.message,b);break;case"jwt":eI(c,eD.jwt,d.message,b);break;case"cidr":"v6"!==d.version&&eI(c,eD.ipv4Cidr,d.message,b),"v4"!==d.version&&eI(c,eD.ipv6Cidr,d.message,b);break;case"emoji":eI(c,eD.emoji(),d.message,b);break;case"ulid":eI(c,eD.ulid,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":eH(c,"binary",d.message,b);break;case"contentEncoding:base64":eA(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":eI(c,eD.base64,d.message,b)}break;case"nanoid":eI(c,eD.nanoid,d.message,b)}return c}function eF(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)eG.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}var eG=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function eH(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):eA(a,"format",b,c,d)}function eI(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:eJ(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):eA(a,"pattern",eJ(b,d),c,d)}function eJ(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function eK(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===h.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:eN(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??{}}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:eN(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===h.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=eE(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===h.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===h.ZodBranded&&a.keyType._def.type._def.typeName===h.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=eB(a.keyType._def,b);return{...c,propertyNames:e}}return c}var eL={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},eM=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>eN(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function eN(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==ey)return e}if(d&&!c){let a=eO(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case h.ZodString:return eE(a,c);case h.ZodNumber:var d,e,f,g,i,j,k,l,m=a,n=c;let o={type:"number"};if(!m.checks)return o;for(let a of m.checks)switch(a.kind){case"int":o.type="integer",ez(o,"type",a.message,n);break;case"min":"jsonSchema7"===n.target?a.inclusive?eA(o,"minimum",a.value,a.message,n):eA(o,"exclusiveMinimum",a.value,a.message,n):(a.inclusive||(o.exclusiveMinimum=!0),eA(o,"minimum",a.value,a.message,n));break;case"max":"jsonSchema7"===n.target?a.inclusive?eA(o,"maximum",a.value,a.message,n):eA(o,"exclusiveMaximum",a.value,a.message,n):(a.inclusive||(o.exclusiveMaximum=!0),eA(o,"maximum",a.value,a.message,n));break;case"multipleOf":eA(o,"multipleOf",a.value,a.message,n)}return o;case h.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&(g instanceof cm&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=eN(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return eN(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case h.ZodBigInt:var p=a,q=c;let r={type:"integer",format:"int64"};if(!p.checks)return r;for(let a of p.checks)switch(a.kind){case"min":"jsonSchema7"===q.target?a.inclusive?eA(r,"minimum",a.value,a.message,q):eA(r,"exclusiveMinimum",a.value,a.message,q):(a.inclusive||(r.exclusiveMinimum=!0),eA(r,"minimum",a.value,a.message,q));break;case"max":"jsonSchema7"===q.target?a.inclusive?eA(r,"maximum",a.value,a.message,q):eA(r,"exclusiveMaximum",a.value,a.message,q):(a.inclusive||(r.exclusiveMaximum=!0),eA(r,"maximum",a.value,a.message,q));break;case"multipleOf":eA(r,"multipleOf",a.value,a.message,q)}return r;case h.ZodBoolean:return{type:"boolean"};case h.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":eA(h,"minimum",a.value,a.message,g);break;case"max":eA(h,"maximum",a.value,a.message,g)}return h}}(a,c);case h.ZodUndefined:return{not:{}};case h.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case h.ZodArray:var s=a,t=c;let u={type:"array"};return s.type?._def&&s.type?._def?.typeName!==h.ZodAny&&(u.items=eN(s.type._def,{...t,currentPath:[...t.currentPath,"items"]})),s.minLength&&eA(u,"minItems",s.minLength.value,s.minLength.message,t),s.maxLength&&eA(u,"maxItems",s.maxLength.value,s.maxLength.message,t),s.exactLength&&(eA(u,"minItems",s.exactLength.value,s.exactLength.message,t),eA(u,"maxItems",s.exactLength.value,s.exactLength.message,t)),u;case h.ZodUnion:case h.ZodDiscriminatedUnion:var v=a,w=c;if("openApi3"===w.target)return eM(v,w);let x=v.options instanceof Map?Array.from(v.options.values()):v.options;if(x.every(a=>a._def.typeName in eL&&(!a._def.checks||!a._def.checks.length))){let a=x.reduce((a,b)=>{let c=eL[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(x.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=x.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===x.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:x.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(x.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:x.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return eM(v,w);case h.ZodIntersection:var y=a,z=c;let A=[eN(y.left._def,{...z,currentPath:[...z.currentPath,"allOf","0"]}),eN(y.right._def,{...z,currentPath:[...z.currentPath,"allOf","1"]})].filter(a=>!!a),B="jsonSchema2019-09"===z.target?{unevaluatedProperties:!1}:void 0,C=[];return A.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)C.push(...a.allOf),void 0===a.unevaluatedProperties&&(B=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else B=void 0;C.push(b)}}),C.length?{allOf:C,...B}:void 0;case h.ZodTuple:return d=a,e=c,d.rest?{type:"array",minItems:d.items.length,items:d.items.map((a,b)=>eN(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:eN(d.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:d.items.length,maxItems:d.items.length,items:d.items.map((a,b)=>eN(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case h.ZodRecord:return eK(a,c);case h.ZodLiteral:var D=a,E=c;let F=typeof D.value;return"bigint"!==F&&"number"!==F&&"boolean"!==F&&"string"!==F?{type:Array.isArray(D.value)?"array":"object"}:"openApi3"===E.target?{type:"bigint"===F?"integer":F,enum:[D.value]}:{type:"bigint"===F?"integer":F,const:D.value};case h.ZodEnum:return{type:"string",enum:Array.from(a.values)};case h.ZodNativeEnum:var G=a;let H=G.values,I=Object.keys(G.values).filter(a=>"number"!=typeof H[H[a]]).map(a=>H[a]),J=Array.from(new Set(I.map(a=>typeof a)));return{type:1===J.length?"string"===J[0]?"string":"number":["string","number"],enum:I};case h.ZodNullable:var K=a,L=c;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(K.innerType._def.typeName)&&(!K.innerType._def.checks||!K.innerType._def.checks.length))return"openApi3"===L.target?{type:eL[K.innerType._def.typeName],nullable:!0}:{type:[eL[K.innerType._def.typeName],"null"]};if("openApi3"===L.target){let a=eN(K.innerType._def,{...L,currentPath:[...L.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}let M=eN(K.innerType._def,{...L,currentPath:[...L.currentPath,"anyOf","0"]});return M&&{anyOf:[M,{type:"null"}]};case h.ZodOptional:var N=a,O=c;if(O.currentPath.toString()===O.propertyPath?.toString())return eN(N.innerType._def,O);let P=eN(N.innerType._def,{...O,currentPath:[...O.currentPath,"anyOf","1"]});return P?{anyOf:[{not:{}},P]}:{};case h.ZodMap:return f=a,"record"===(g=c).mapStrategy?eK(f,g):{type:"array",maxItems:125,items:{type:"array",items:[eN(f.keyType._def,{...g,currentPath:[...g.currentPath,"items","items","0"]})||{},eN(f.valueType._def,{...g,currentPath:[...g.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case h.ZodSet:var Q=a,R=c;let S={type:"array",uniqueItems:!0,items:eN(Q.valueType._def,{...R,currentPath:[...R.currentPath,"items"]})};return Q.minSize&&eA(S,"minItems",Q.minSize.value,Q.minSize.message,R),Q.maxSize&&eA(S,"maxItems",Q.maxSize.value,Q.maxSize.message,R),S;case h.ZodLazy:return()=>a.getter()._def;case h.ZodPromise:return eN(a.type._def,c);case h.ZodNaN:case h.ZodNever:return{not:{}};case h.ZodEffects:return i=a,"input"===(j=c).effectStrategy?eN(i.schema._def,j):{};case h.ZodAny:case h.ZodUnknown:return{};case h.ZodDefault:return k=a,l=c,{...eN(k.innerType._def,l),default:k.defaultValue()};case h.ZodBranded:return eB(a,c);case h.ZodReadonly:case h.ZodCatch:return eN(a.innerType._def,c);case h.ZodPipeline:var T=a,U=c;if("input"===U.pipeStrategy)return eN(T.in._def,U);if("output"===U.pipeStrategy)return eN(T.out._def,U);let V=eN(T.in._def,{...U,currentPath:[...U.currentPath,"allOf","0"]}),W=eN(T.out._def,{...U,currentPath:[...U.currentPath,"allOf",V?"1":"0"]});return{allOf:[V,W].filter(a=>void 0!==a)};case h.ZodFunction:case h.ZodVoid:case h.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?eN(f(),b):f;if(g&&eQ(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}var eO=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:eP(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),{};return"seen"===b.$refStrategy?{}:void 0}},eP=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")},eQ=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);(j||(j={})).Completable="McpCompletable";class eR extends bB{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}eR.create=(a,b)=>new eR({type:a,typeName:j.Completable,complete:b.complete,...function(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{var f,g;let{message:h}=a;return"invalid_enum_value"===b.code?{message:null!=h?h:e.defaultError}:void 0===e.data?{message:null!=(f=null!=h?h:d)?f:e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:null!=(g=null!=h?h:c)?g:e.defaultError}},description:e}}(b)});class eS{constructor(){}async execute(a={}){let b=(0,J.sX)(),c=Date.now(),d=[],e=(b,c="info")=>{let e=`[${new Date().toISOString()}] ${b}`;d.push(e),a.onLog&&a.onLog(e,c)};try{e("\uD83D\uDE80 Starting comprehensive system health analysis..."),e(`📋 Execution ID: ${b}`,"debug");let f=this.buildInvestigationPrompt(a);e("\uD83D\uDD0D Launching Claude to investigate system directly...");let g="",h=0,i={input_tokens:0,output_tokens:0,cache_creation_tokens:0,cache_read_tokens:0};for await(let a of function({prompt:a,options:{abortController:b=a4(),additionalDirectories:c=[],allowedTools:d=[],appendSystemPrompt:e,canUseTool:f,continue:g,customSystemPrompt:h,cwd:i,disallowedTools:j=[],env:k,executable:l=a7()?"bun":"node",executableArgs:m=[],extraArgs:n={},fallbackModel:o,hooks:p,includePartialMessages:q,maxTurns:r,mcpServers:s,model:t,pathToClaudeCodeExecutable:u,permissionMode:v="default",permissionPromptToolName:w,resume:x,stderr:y,strictMcpConfig:z}={}}){if(k||(k={...process.env}),k.CLAUDE_CODE_ENTRYPOINT||(k.CLAUDE_CODE_ENTRYPOINT="sdk-ts"),void 0===u){let a=(0,ac.fileURLToPath)("file:///home/jmagar/code/agents/node_modules/@anthropic-ai/claude-code/sdk.mjs"),b=(0,ab.join)(a,"..");u=(0,ab.join)(b,"cli.js")}let A={},B=new Map;if(s)for(let[a,b]of Object.entries(s))"sdk"===b.type?(B.set(a,b.instance),A[a]={type:"sdk",name:a}):A[a]=b;let C="string"!=typeof a,D=new a8({prompt:a,abortController:b,additionalDirectories:c,cwd:i,executable:l,executableArgs:m,extraArgs:n,pathToClaudeCodeExecutable:u,env:k,stderr:y,customSystemPrompt:h,appendSystemPrompt:e,maxTurns:r,model:t,fallbackModel:o,permissionMode:v,permissionPromptToolName:w,continueConversation:g,resume:x,allowedTools:d,disallowedTools:j,mcpServers:s,strictMcpConfig:z,canUseTool:!!f,hooks:!!p,includePartialMessages:q}),E=new bc(D,C,f,p,b,B);return"string"!=typeof a&&E.streamInput(a),E}({prompt:f,options:{maxTurns:50,permissionMode:"acceptEdits",allowedTools:["Bash","Read","Glob","Grep"],customSystemPrompt:this.getSystemPrompt()}}))if("assistant"===a.type){let b=a.message.content;b.forEach(a=>{if("tool_use"===a.type)e(`🔧 Running: ${a.name} - ${JSON.stringify(a.input)}`,"debug");else if("text"===a.type&&a.text.trim()){let b=a.text.substring(0,100)+(a.text.length>100?"...":"");e(`💭 Claude: ${b}`)}}),g=b.find(a=>"text"===a.type)?.text||g}else if("user"===a.type)a.message.content.forEach(a=>{if("tool_result"===a.type){let b=a.content?.substring(0,200)+(a.content&&a.content.length>200?"...":"");e(`📊 Tool result: ${b||"No output"}`)}});else if("result"===a.type)if("success"===a.subtype)h=a.total_cost_usd,i={input_tokens:a.usage.input_tokens||0,output_tokens:a.usage.output_tokens||0,cache_creation_tokens:a.usage.cache_creation_input_tokens||0,cache_read_tokens:a.usage.cache_read_input_tokens||0},e("✅ Claude investigation completed successfully");else throw e("❌ Claude investigation failed","error"),Error(`Investigation failed: ${a.subtype}`);let j=Date.now()-c;return e(`⏱️ Analysis completed in ${(j/1e3).toFixed(1)}s`),e(`💰 Total cost: $${h.toFixed(4)}`),{executionId:b,agentType:"system-health",status:"completed",result:g,cost:h,duration:j,usage:i,logs:d,timestamp:new Date().toISOString(),summary:`System health investigation completed - Cost: $${h.toFixed(4)}`}}catch(g){let a=Date.now()-c,f=g instanceof Error?g.message:"Unknown error occurred";return e(`❌ ERROR: ${f}`,"error"),{executionId:b,agentType:"system-health",status:"failed",result:JSON.stringify({error:f,logs:d},null,2),cost:0,duration:a,usage:{input_tokens:0,output_tokens:0,cache_creation_tokens:0,cache_read_tokens:0},logs:d,timestamp:new Date().toISOString(),error:f}}}buildInvestigationPrompt(a){let b=a.ai_analysis_depth||"detailed";return`
Please conduct a focused system health investigation and provide a comprehensive analysis report.

INVESTIGATION STRATEGY:
Start by understanding what problems the system is experiencing, then investigate the metrics:

1. **Check System Logs First**: Start with recent errors and warnings:
   - Try 'journalctl -p err -n 20 --no-pager' (systemd systems)
   - If journalctl fails, use 'tail -n 50 /var/log/syslog | grep -E "(error|Error|ERROR|fail|Fail|FAIL)"'
   - Also check 'dmesg | tail -n 20' for kernel messages
   - On some systems: 'tail -n 30 /var/log/messages' or '/var/log/kern.log'

2. **Quick System Overview**: Get current resource status:
   - 'free -h && df -h && uptime'
   - 'systemctl --failed'

3. **Targeted Investigation**: Based on what you found in logs:
   - If memory/OOM issues → check memory usage and top processes
   - If disk issues → investigate disk usage patterns
   - If service failures → check specific service status and logs
   - If network/security issues → check ports and updates

4. **Focus on Actionable Problems**: Only dive deep into areas that logs indicate are problematic

ANALYSIS CONFIGURATION:
- Analysis Depth: ${b}
- Include Security Analysis: ${a.include_security_scan?"Yes":"No"}
- Include Docker Analysis: ${a.include_docker?"Yes":"No"}
- Detailed Service Analysis: ${a.detailed_service_analysis?"Yes":"No"}

After your investigation, provide:
1. A comprehensive summary of system health based on your findings
2. Specific actionable recommendations prioritized by impact and urgency
3. Analysis of trends and patterns you discovered
4. Alert identification with severity levels
5. Health score justification (0-100) based on your investigation
6. Priority actions that should be taken immediately

Format your final analysis as a structured report with clear sections for:
- Executive Summary
- Key Findings
- Critical Issues (if any)
- Recommendations (with specific commands)
- Health Score and Justification
- Next Steps

Be thorough but practical. Focus on actionable insights and clearly explain the reasoning behind your recommendations.
`}getSystemPrompt(){return`
You are an expert system administrator and infrastructure monitoring specialist. You have direct access to system investigation tools and should use them to conduct thorough system health analysis.

INVESTIGATION PRINCIPLES:
- Always start with broad system overview commands before diving deep
- Use your judgment to investigate concerning areas more thoroughly
- Prioritize critical issues that could cause system failures
- Provide specific, actionable recommendations with exact commands
- Consider the interconnections between system components
- Balance thoroughness with practical insights

TOOL USAGE:
- Use bash commands freely to investigate system state
- Adapt to different system types (systemd vs SysV init, different distros)
- If journalctl fails, fall back to /var/log/syslog, /var/log/messages, etc.
- If systemctl fails, try 'service --status-all' or '/etc/init.d/* status'  
- Always try alternative commands if the first approach doesn't work

ANALYSIS APPROACH:
- Look for patterns across CPU, memory, disk, network, and services
- Identify bottlenecks and resource constraints
- Detect security vulnerabilities and misconfigurations
- Assess service health and dependencies
- Provide context for why issues matter and their potential impact

OUTPUT REQUIREMENTS:
- Structure findings clearly with sections and bullet points
- Include specific commands for remediation when possible  
- Prioritize recommendations by urgency and impact
- Provide health score with clear justification
- Focus on actionable insights over raw data

SAFETY:
- Never run destructive commands
- Always verify before suggesting system changes
- Provide clear warnings about potential risks
- Respect system security boundaries
`}getCapabilities(){return{name:"System Health Reporter (Claude SDK)",version:"2.0.0",description:"Direct system health investigation using Claude Code SDK",capabilities:["Direct system investigation with bash commands","Real-time system analysis and troubleshooting","Security vulnerability detection","Performance bottleneck identification","Service health assessment","Docker container analysis","Intelligent recommendations with specific commands"],provides_exact_costs:!0,typical_execution_time_ms:12e4,outputs:["Comprehensive system analysis report","Actionable recommendations with commands","Health score with justification","Priority action items","Security findings"]}}}class eT extends R.EventEmitter{constructor(a={}){super(),this.tasks=new Map,this.cronJobs=new Map,this.runningTasks=new Set,this.executionHistory=[],this.startTime=new Date,this.isRunning=!1,this.retryQueues=new Map,this.config={timezone:"America/New_York",maxConcurrentTasks:5,taskTimeout:3e5,enableErrorRetry:!0,maxRetries:3,retryDelay:3e4,...a},this.healthAgent=new eS,this.setupDefaultTasks()}async start(){if(this.isRunning)throw Error("Scheduler is already running");for(let a of(this.isRunning=!0,this.startTime=new Date,Array.from(this.tasks.values())))a.enabled&&this.scheduleTask(a);X.isMonitoring()||await X.start(),Z.getCollectionStats().isCollecting||await Z.start(),this.emit("started"),console.log(`Monitoring scheduler started with ${this.getEnabledTaskCount()} enabled tasks`)}async stop(){if(!this.isRunning)return;for(let[a,b]of(this.isRunning=!1,Array.from(this.cronJobs.entries())))b.stop(),b.destroy(),this.cronJobs.delete(a);for(let[a,b]of Array.from(this.retryQueues.entries()))b.forEach(a=>clearTimeout(a));this.retryQueues.clear();let a=Date.now();for(;this.runningTasks.size>0&&Date.now()-a<3e4;)await new Promise(a=>setTimeout(a,1e3));this.runningTasks.size>0&&console.warn(`Scheduler stopped with ${this.runningTasks.size} tasks still running`),this.emit("stopped"),console.log("Monitoring scheduler stopped")}addTask(a){let b={id:this.generateTaskId(a.name),runCount:0,errorCount:0,...a};if(!aa.validate(b.cronExpression))throw Error(`Invalid cron expression: ${b.cronExpression}`);return this.tasks.set(b.id,b),b.enabled&&this.isRunning&&this.scheduleTask(b),this.emit("taskAdded",b),console.log(`Task added: ${b.name} (${b.cronExpression})`),b}removeTask(a){let b=this.tasks.get(a);if(!b)return!1;let c=this.cronJobs.get(a);c&&(c.stop(),c.destroy(),this.cronJobs.delete(a));let d=this.retryQueues.get(a);return d&&(d.forEach(a=>clearTimeout(a)),this.retryQueues.delete(a)),this.tasks.delete(a),this.emit("taskRemoved",b),console.log(`Task removed: ${b.name}`),!0}enableTask(a){let b=this.tasks.get(a);return!!b&&(b.enabled=!0,this.isRunning&&this.scheduleTask(b),this.emit("taskEnabled",b),console.log(`Task enabled: ${b.name}`),!0)}disableTask(a){let b=this.tasks.get(a);if(!b)return!1;b.enabled=!1;let c=this.cronJobs.get(a);return c&&(c.stop(),c.destroy(),this.cronJobs.delete(a)),this.emit("taskDisabled",b),console.log(`Task disabled: ${b.name}`),!0}async executeTaskNow(a){let b=this.tasks.get(a);if(!b)throw Error(`Task not found: ${a}`);return await this.executeTask(b,!0)}getTasks(){return Array.from(this.tasks.values())}getTask(a){return this.tasks.get(a)}isSchedulerRunning(){return this.isRunning}getStats(){let a,b=this.executionHistory.length,c=this.executionHistory.filter(a=>a.success).length,d=this.executionHistory.reduce((a,b)=>a+b.duration,0),e=Date.now()-this.startTime.getTime(),f=null;for(let b of Array.from(this.tasks.values()))if(b.enabled&&b.nextRun){let c=new Date(b.nextRun);(!f||c<f)&&(f=c,a={id:b.id,name:b.name,nextRun:b.nextRun})}return{totalTasks:this.tasks.size,enabledTasks:this.getEnabledTaskCount(),runningTasks:this.runningTasks.size,totalExecutions:b,successfulExecutions:c,failedExecutions:b-c,averageExecutionTime:b>0?d/b:0,uptime:e,nextScheduledTask:a}}getExecutionHistory(a=100){return this.executionHistory.sort((a,b)=>new Date(b.startTime).getTime()-new Date(a.startTime).getTime()).slice(0,a)}clearExecutionHistory(){this.executionHistory=[],this.emit("historyCleared")}updateTask(a,b){let c=this.tasks.get(a);if(!c)return!1;if(b.cronExpression&&!aa.validate(b.cronExpression))throw Error(`Invalid cron expression: ${b.cronExpression}`);let d=c.enabled,e=c.cronExpression;if(Object.assign(c,b),this.isRunning&&(void 0!==b.enabled||void 0!==b.cronExpression)){let b=this.cronJobs.get(a);b&&(b.stop(),b.destroy(),this.cronJobs.delete(a)),c.enabled&&this.scheduleTask(c)}return this.emit("taskUpdated",c,{oldEnabled:d,oldCronExpression:e}),console.log(`Task updated: ${c.name}`),!0}setupDefaultTasks(){this.addTask({name:"System Health Check",description:"Comprehensive system health analysis using AI agent",cronExpression:"0 */30 * * * *",enabled:!0,type:"health_check",handler:async()=>{let a=await this.healthAgent.execute({include_docker:!0,include_security_scan:!0,detailed_service_analysis:!0,onLog:(a,b)=>{console.log(`[HealthAgent] ${"error"===b?"❌":"warn"===b?"⚠️":"debug"===b?"\uD83D\uDD27":"ℹ️"} ${a}`)}});if("failed"===a.status)throw Error(a.error||"Health check failed");console.log(`✅ Health check completed: ${a.summary}`)}}),this.addTask({name:"Metrics Cleanup",description:"Clean up old system metrics data",cronExpression:"0 0 2 * * *",enabled:!0,type:"cleanup",handler:async()=>{let a=await Z.cleanupOldMetrics();console.log(`Cleaned up ${a.deletedCount} old metric records`)}}),this.addTask({name:"Alert Cleanup",description:"Clean up old resolved alerts",cronExpression:"0 0 3 * * *",enabled:!0,type:"cleanup",handler:async()=>{console.log("Alert cleanup completed")}}),this.addTask({name:"Status Broadcast",description:"Broadcast system status to connected clients",cronExpression:"0 */5 * * * *",enabled:!0,type:"metrics_collection",handler:async()=>{let a=X.getLastStats();a&&console.log(`Status broadcast: CPU ${a.cpuUsage.toFixed(1)}%, Memory ${a.memoryUsage.toFixed(1)}%, Disk ${a.diskUsage.toFixed(1)}%`)}}),this.addTask({name:"Weekly Performance Report",description:"Generate weekly system performance report",cronExpression:"0 0 6 * * 0",enabled:!0,type:"health_check",handler:async()=>{let a=await Z.getMetricsSnapshot(),b=this.getStats();console.log("Weekly Performance Report Generated:",{systemHealth:a.current,schedulerStats:b,executionsLast7Days:this.executionHistory.filter(a=>new Date(a.startTime)>new Date(Date.now()-6048e5)).length})}})}scheduleTask(a){try{let b=aa.schedule(a.cronExpression,async()=>{await this.executeTask(a)},{scheduled:!0,timezone:this.config.timezone});this.cronJobs.set(a.id,b),a.nextRun=this.getNextRunTime(a.cronExpression),console.log(`Scheduled task: ${a.name} (next run: ${a.nextRun})`)}catch(b){console.error(`Error scheduling task ${a.name}:`,b),this.emit("taskScheduleError",{task:a,error:b})}}async executeTask(a,b=!1){if(this.runningTasks.size>=this.config.maxConcurrentTasks){let b="Maximum concurrent tasks limit reached";return console.warn(`Task execution skipped: ${a.name} - ${b}`),this.createExecutionResult(a.id,!1,b)}if(this.runningTasks.has(a.id)){let b="Task is already running";return console.warn(`Task execution skipped: ${a.name} - ${b}`),this.createExecutionResult(a.id,!1,b)}let c=new Date;this.runningTasks.add(a.id),this.emit("taskStarted",{task:a,isManual:b,startTime:c}),console.log(`Task started: ${a.name}${b?" (manual)":""}`);try{let d=new Promise((a,b)=>{setTimeout(()=>{b(Error("Task execution timeout"))},this.config.taskTimeout)});await Promise.race([a.handler(),d]);let e=new Date,f=e.getTime()-c.getTime();a.runCount++,a.lastRun=c.toISOString();let g=this.createExecutionResult(a.id,!0,void 0,c,e,f);return this.addExecutionHistory(g),this.emit("taskCompleted",{task:a,result:g,isManual:b}),console.log(`Task completed: ${a.name} (${f}ms)`),g}catch(h){let d=new Date,e=d.getTime()-c.getTime(),f=h instanceof Error?h.message:"Unknown error";a.errorCount++,a.lastError=f;let g=this.createExecutionResult(a.id,!1,f,c,d,e);return this.addExecutionHistory(g),this.emit("taskFailed",{task:a,error:h,result:g,isManual:b}),console.error(`Task failed: ${a.name} - ${f}`),this.config.enableErrorRetry&&!b&&a.errorCount<=this.config.maxRetries&&this.scheduleRetry(a),g}finally{this.runningTasks.delete(a.id)}}scheduleRetry(a){let b=setTimeout(async()=>{console.log(`Retrying task: ${a.name} (attempt ${a.errorCount+1})`),await this.executeTask(a)},this.config.retryDelay*Math.pow(2,a.errorCount-1));this.retryQueues.has(a.id)||this.retryQueues.set(a.id,[]),this.retryQueues.get(a.id).push(b)}createExecutionResult(a,b,c,d,e,f){let g=d||new Date,h=e||new Date,i=void 0!==f?f:h.getTime()-g.getTime();return{taskId:a,success:b,startTime:g.toISOString(),endTime:h.toISOString(),duration:i,error:c}}addExecutionHistory(a){this.executionHistory.push(a),this.executionHistory.length>1e3&&(this.executionHistory=this.executionHistory.slice(-1e3))}getNextRunTime(a){try{return new Date(Date.now()+6e4).toISOString()}catch(a){return new Date().toISOString()}}getEnabledTaskCount(){return Array.from(this.tasks.values()).filter(a=>a.enabled).length}generateTaskId(a){return`task_${a.toLowerCase().replace(/\s+/g,"_")}_${Date.now()}`}}let eU=new eT,eV=(0,D.FB)(async a=>{let b=a.headers.get("x-internal-token");if(process.env.INTERNAL_API_TOKEN&&b!==process.env.INTERNAL_API_TOKEN)return B.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let c=a.nextUrl.searchParams,d=(0,D.fe)(c,E.Bo),e=C.k5n(["overview","history","trends","health"]).parse(c.get("endpoint")??"overview");switch(e){case"overview":return(0,D.$y)(await eX(d));case"history":return(0,D.$y)(await eY(d));case"trends":return(0,D.$y)(await eZ(d));case"health":return(0,D.$y)(await e$(d));default:throw Error(`Unknown endpoint: ${e}`)}}),eW=(0,D.FB)(async a=>{let b,c=a.headers.get("x-internal-token");if(process.env.INTERNAL_API_TOKEN&&c!==process.env.INTERNAL_API_TOKEN)return B.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let d=C.gMt("action",[C.Ikc({action:C.euz("start_monitoring")}),C.Ikc({action:C.euz("stop_monitoring")}),C.Ikc({action:C.euz("collect_metrics")}),C.Ikc({action:C.euz("run_health_check")}),C.Ikc({action:C.euz("acknowledge_alert"),alertId:C.YjP().min(1),acknowledgedBy:C.YjP().optional()}),C.Ikc({action:C.euz("resolve_alert"),alertId:C.YjP().min(1),resolvedBy:C.YjP().optional()}),C.Ikc({action:C.euz("update_thresholds"),thresholds:C.g1P(C.L5J())})]).parse(await a.json()),{action:e}=d;switch(e){case"start_monitoring":b=await e_();break;case"stop_monitoring":b=await e0();break;case"collect_metrics":b=await e1();break;case"run_health_check":b=await e2();break;case"acknowledge_alert":{let{alertId:a,acknowledgedBy:c}=d;b=await e3(a,c);break}case"resolve_alert":{let{alertId:a,resolvedBy:c}=d;b=await e4(a,c);break}case"update_thresholds":{let{thresholds:a}=d;b=await e5(a);break}default:throw Error(`Unknown action: ${e}`)}return(0,D.$y)(b)});async function eX(a){let b=X.getLastStats();if(!b)throw Error("No current system metrics available");let c=await Q.getLatestSystemHealth();if(!c.success||!c.data)throw Error(`Failed to get system health: ${c.error}`);let d=await Q.getMetricsTrends("localhost",24);if(!d.success||!d.data)throw Error(`Failed to get trends: ${d.error}`);let[e,f]=await Promise.all([Q.getHealthStatistics("localhost",24),Q.getHealthStatistics("localhost",168)]);if(!e.success||!f.success||!e.data||!f.data)throw Error("Failed to get aggregated statistics");let g=_.getAlerts({resolved:!1,limit:10}),h=_.getAlerts({limit:5}),i=eU.getStats(),j={systemMonitor:{isRunning:X.isMonitoring(),config:X.getConfig()},metricsCollector:{isCollecting:Z.getCollectionStats().isCollecting,stats:Z.getCollectionStats()},scheduler:{isRunning:eU.isSchedulerRunning(),stats:i}};try{(await Z.getMetricsSnapshot()).predictions}catch(a){console.warn("Failed to get predictions:",a)}return{current:{timestamp:new Date().toISOString(),status:c.data.status,cpu:b.cpuUsage,memory:b.memoryUsage,disk:b.diskUsage,load:b.loadAverage,uptime:b.uptime,networkConnectivity:b.networkConnectivity},trends:d.data.map(a=>({timestamp:a.timestamp,cpu:a.cpuUsage,memory:a.memoryUsage,disk:a.diskUsage,load:a.loadAverage1m,health:a.overallHealth})),aggregated:{last24Hours:{avg:{cpu:e.data.averages.cpu||0,memory:e.data.averages.memory||0,disk:e.data.averages.disk||0},max:{cpu:e.data.maximums.cpu||0,memory:e.data.maximums.memory||0,disk:e.data.maximums.disk||0},min:{cpu:e.data.minimums.cpu||0,memory:e.data.minimums.memory||0,disk:e.data.minimums.disk||0},healthDistribution:e.data.healthDistribution},last7Days:{avg:{cpu:f.data.averages.cpu||0,memory:f.data.averages.memory||0,disk:f.data.averages.disk||0},max:{cpu:f.data.maximums.cpu||0,memory:f.data.maximums.memory||0,disk:f.data.maximums.disk||0},min:{cpu:f.data.minimums.cpu||0,memory:f.data.minimums.memory||0,disk:f.data.minimums.disk||0},healthDistribution:f.data.healthDistribution}},alerts:{active:g.length,recent:h.map(a=>({id:a.id,severity:a.severity,title:a.title,message:a.message,timestamp:a.timestamp}))},monitoring:j}}async function eY(a){let b={nodeId:a.nodeId||"localhost",limit:a.limit||100};a.offset,a.dateFrom&&(b.dateFrom=new Date(a.dateFrom)),a.dateTo&&(b.dateTo=new Date(a.dateTo)),a.healthStatus&&(b.healthStatus=a.healthStatus);let c=await Q.getSystemMetrics(b);if(!c.success||!c.data)throw Error(`Failed to get metrics history: ${c.error}`);return{data:c.data.data.map(a=>({timestamp:a.timestamp,nodeId:a.nodeId,cpu:a.cpuUsagePercent,memory:a.memoryUsagePercent,disk:a.diskUsagePercent,loadAverage1m:a.loadAverage1m,loadAverage5m:a.loadAverage5m,loadAverage15m:a.loadAverage15m,internetConnected:!!a.internetConnected,claudeApiLatency:a.claudeApiLatencyMs,overallHealth:a.overallHealth})),total:c.data.total,page:c.data.page,pageSize:c.data.pageSize,hasMore:c.data.hasMore}}async function eZ(a){let b=a.timeframe||"day",c=a.metrics?a.metrics.split(","):["cpu","memory","disk"],d=await Z.getHistoricalTrends(c,b);return{timeframe:b,trends:d}}async function e$(a){var b;let c,d=await Q.getLatestSystemHealth();if(!d.success||!d.data)throw Error(`Failed to get system health: ${d.error}`);let e=d.data,f=(c=100,"number"==typeof(b=e).cpuUsage&&(b.cpuUsage>=90?c-=30:b.cpuUsage>=70?c-=15:b.cpuUsage>=50&&(c-=5)),"number"==typeof b.memoryUsage&&(b.memoryUsage>=95?c-=25:b.memoryUsage>=80?c-=10:b.memoryUsage>=60&&(c-=5)),"number"==typeof b.diskUsage&&(b.diskUsage>=95?c-=20:b.diskUsage>=85?c-=10:b.diskUsage>=70&&(c-=5)),!1===b.internetConnected&&(c-=15),Math.max(0,Math.min(100,c-=Math.min(5*(Array.isArray(b.alerts)?b.alerts.length:0),25)))),g={nextHour:{cpu:0,memory:0,disk:0},confidence:0};try{g=(await Z.getMetricsSnapshot()).predictions}catch(a){console.warn("Failed to get predictions:",a)}return{status:e.status,score:f,cpuUsage:e.cpuUsage,memoryUsage:e.memoryUsage,diskUsage:e.diskUsage,loadAverage:e.loadAverage,uptime:e.uptime,internetConnected:e.internetConnected,claudeApiLatency:e.claudeApiLatency,lastUpdated:e.lastUpdated,alerts:e.alerts,predictions:g}}async function e_(){let a={systemMonitor:!1,metricsCollector:!1,scheduler:!1};X.isMonitoring()||(await X.start(),a.systemMonitor=!0),Z.getCollectionStats().isCollecting||(await Z.start(),a.metricsCollector=!0);try{await eU.start(),a.scheduler=!0}catch(a){console.warn("Scheduler start warning:",a)}return{message:"Monitoring services started",results:a}}async function e0(){let a={systemMonitor:!1,metricsCollector:!1,scheduler:!1};X.isMonitoring()&&(await X.stop(),a.systemMonitor=!0),Z.getCollectionStats().isCollecting&&(await Z.stop(),a.metricsCollector=!0);try{await eU.stop(),a.scheduler=!0}catch(a){console.warn("Scheduler stop warning:",a)}return{message:"Monitoring services stopped",results:a}}async function e1(){return{message:"Metrics collected successfully",stats:await X.collectNow()}}async function e2(){return{message:"Health check executed",result:await eU.executeTaskNow("manual_health_check")}}async function e3(a,b){if(!await _.acknowledgeAlert(a,b))throw Error("Alert not found or already acknowledged");return{message:"Alert acknowledged successfully",alertId:a}}async function e4(a,b){if(!await _.resolveAlert(a,b))throw Error("Alert not found or already resolved");return{message:"Alert resolved successfully",alertId:a}}async function e5(a){return X.updateConfig({thresholds:a}),{message:"Thresholds updated successfully",thresholds:a}}let e6=new l.AppRouteRouteModule({definition:{kind:m.RouteKind.APP_ROUTE,page:"/api/system/metrics/route",pathname:"/api/system/metrics",filename:"route",bundlePath:"app/api/system/metrics/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/home/jmagar/code/agents/src/app/api/system/metrics/route.ts",nextConfigOutput:"standalone",userland:k}),{workAsyncStorage:e7,workUnitAsyncStorage:e8,serverHooks:e9}=e6;function fa(){return(0,n.patchFetch)({workAsyncStorage:e7,workUnitAsyncStorage:e8})}async function fb(a,b,c){var d;let e="/api/system/metrics/route";"/index"===e&&(e="/");let f=await e6.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:n,revalidateOnlyGenerated:B,resolvedPathname:C}=f,D=(0,q.normalizeAppPath)(e),E=!!(k.dynamicRoutes[D]||k.routes[C]);if(E&&!j){let a=!!k.routes[C],b=k.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new z.NoFallbackError}let F=null;!E||e6.isDev||j||(F="/index"===(F=C)?"/":F);let G=!0===e6.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,p.getTracer)(),K=J.getActiveScopeSpan(),L={params:h,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!i.experimental.cacheComponents,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,o.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>e6.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},M=new r.NodeNextRequest(a),N=new r.NodeNextResponse(b),O=s.NextRequestAdapter.fromNodeNextRequest(M,(0,s.signalFromNodeResponse)(b));try{let d=async c=>e6.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==t.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var g,h;let p=async({previousCacheEntry:g})=>{try{if(!(0,o.getRequestMeta)(a,"minimalMode")&&n&&B&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=L.renderOpts.collectedTags;if(!E)return await (0,v.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,w.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[y.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:A.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await e6.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,u.c)({isRevalidate:H,isOnDemandRevalidate:n})},l),b}},q=await e6.handleResponse({req:a,nextConfig:i,cacheKey:F,routeKind:m.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:n,revalidateOnlyGenerated:B,responseGenerator:p,waitUntil:c.waitUntil});if(!E)return null;if((null==q||null==(g=q.value)?void 0:g.kind)!==A.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==q||null==(h=q.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,o.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",n?"REVALIDATED":q.isMiss?"MISS":q.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let r=(0,w.fromNodeOutgoingHttpHeaders)(q.value.headers);return(0,o.getRequestMeta)(a,"minimalMode")&&E||r.delete(y.NEXT_CACHE_TAGS_HEADER),!q.cacheControl||b.getHeader("Cache-Control")||r.get("Cache-Control")||r.set("Cache-Control",(0,x.getCacheControlHeader)(q.cacheControl)),await (0,v.I)(M,N,new Response(q.value.body,{headers:r,status:q.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(t.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:p.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(K||b instanceof z.NoFallbackError||await e6.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,u.c)({isRevalidate:H,isOnDemandRevalidate:n})}),E)throw b;return await (0,v.I)(M,N,new Response(null,{status:500})),null}}},51606:(a,b,c)=>{c.d(b,{$A:()=>j,AD:()=>q,Bo:()=>r,Gy:()=>l,Lf:()=>o,Ny:()=>i,Xi:()=>p,dP:()=>k,sS:()=>h,sr:()=>g,yv:()=>n,z7:()=>m});var d=c(59507);let e=d.Ikc({page:d.aig().int().positive().default(1),limit:d.aig().int().positive().max(100).default(20),sortBy:d.YjP().optional(),sortOrder:d.k5n(["asc","desc"]).default("desc")}),f=d.Ikc({dateFrom:d.p6U().optional(),dateTo:d.p6U().optional()}),g=e.extend({agentType:d.YjP().optional(),status:d.k5n(["pending","running","completed","failed","cancelled"]).optional(),nodeId:d.YjP().optional(),triggeredBy:d.k5n(["manual","schedule","webhook"]).optional()}).merge(f),h=d.Ikc({agentType:d.YjP().min(1,"Agent type is required"),nodeId:d.YjP().optional(),triggeredBy:d.k5n(["manual","schedule","webhook"]).default("manual"),config:d.g1P(d.YjP(),d.bzn()).optional(),metadata:d.g1P(d.YjP(),d.bzn()).optional()}),i=d.Ikc({status:d.k5n(["pending","running","completed","failed","cancelled"]).optional(),completedAt:d.YjP().datetime().optional(),durationMs:d.aig().int().nonnegative().optional(),costUsd:d.aig().nonnegative().optional(),tokensUsed:d.aig().int().nonnegative().optional(),resultSummary:d.YjP().optional(),errorMessage:d.YjP().optional(),exitCode:d.aig().int().optional(),logs:d.YjP().optional(),aiAnalysis:d.YjP().optional(),rawOutput:d.YjP().optional()}),j=d.Ikc({includeSteps:d.zMY().default(!1),includeCosts:d.zMY().default(!1),includeConfig:d.zMY().default(!1),includeLogs:d.zMY().default(!1)}),k=d.Ikc({agentType:d.YjP().min(1,"Agent type is required").regex(/^[a-z][a-z0-9-]*[a-z0-9]$/,"Agent type must be lowercase, alphanumeric with hyphens"),name:d.YjP().min(1,"Name is required"),description:d.YjP().optional(),version:d.YjP().regex(/^\d+\.\d+\.\d+$/,"Version must follow semantic versioning (e.g., 1.0.0)").optional(),enabled:d.zMY().default(!0),config:d.YjP().optional(),maxCostPerExecution:d.aig().nonnegative().optional(),maxDurationMs:d.aig().int().positive().optional(),timeoutMs:d.aig().int().positive().optional(),maxConcurrentExecutions:d.aig().int().min(1).optional(),cooldownMs:d.aig().int().nonnegative().optional()}),l=k.partial().omit({agentType:!0}),m=d.Ikc({enabled:d.zMY().optional(),orderBy:d.k5n(["name","agentType","createdAt","updatedAt"]).default("name"),orderDirection:d.k5n(["asc","desc"]).default("asc")}).merge(e),n=d.Ikc({executionId:d.YjP().min(1,"Execution ID is required"),modelUsed:d.YjP().min(1,"Model is required"),inputTokens:d.aig().int().nonnegative(),outputTokens:d.aig().int().nonnegative(),inputCostUsd:d.aig().nonnegative(),outputCostUsd:d.aig().nonnegative(),totalCostUsd:d.aig().nonnegative(),requestId:d.YjP().optional(),responseTime:d.aig().nonnegative().optional(),cacheHit:d.zMY().optional()}),o=d.Ikc({agentType:d.YjP().optional(),modelUsed:d.YjP().optional(),executionId:d.YjP().optional(),groupBy:d.k5n(["day","week","month","agent","model"]).optional(),includeBreakdown:d.zMY().default(!1),includeProjections:d.zMY().default(!1)}).merge(f).merge(e),p=d.Ikc({period:d.k5n(["day","week","month"]).default("day"),days:d.aig().int().positive().max(365).default(30)});d.Ikc({name:d.YjP().min(1,"Name is required"),agentType:d.YjP().min(1,"Agent type is required"),cronExpression:d.YjP().min(1,"Cron expression is required"),timezone:d.YjP().default("UTC"),enabled:d.zMY().default(!0),nodeIds:d.YOg(d.YjP()).optional(),executionConfig:d.g1P(d.YjP(),d.bzn()).optional(),maxExecutions:d.aig().int().positive().optional()}).partial().omit({agentType:!0});let q=d.Ikc({includeDatabase:d.zMY().default(!0),includeFileSystem:d.zMY().default(!0),includeExternalServices:d.zMY().default(!0)});d.Ikc({nodeId:d.YjP().default("localhost"),cpuUsagePercent:d.aig().min(0).max(100).optional(),memoryUsagePercent:d.aig().min(0).max(100).optional(),diskUsagePercent:d.aig().min(0).max(100).optional(),loadAverage1m:d.aig().nonnegative().optional(),loadAverage5m:d.aig().nonnegative().optional(),loadAverage15m:d.aig().nonnegative().optional(),diskFreeBytes:d.aig().nonnegative().optional(),diskTotalBytes:d.aig().positive().optional(),internetConnected:d.zMY().optional(),claudeApiLatencyMs:d.aig().nonnegative().optional(),overallHealth:d.k5n(["healthy","degraded","unhealthy"]).optional()});let r=d.Ikc({nodeId:d.YjP().default("localhost"),timeframe:d.k5n(["hour","day","week","month"]).default("day"),metrics:d.YjP().optional(),healthStatus:d.k5n(["healthy","warning","critical"]).optional(),limit:d.aig().int().positive().max(1e3).default(100),offset:d.aig().int().nonnegative().default(0)}).merge(f);d.Ikc({operations:d.YOg(d.Ikc({action:d.k5n(["create","update","delete"]),data:d.KCZ([h,i]),id:d.YjP().optional()})).min(1).max(100)}),d.Ikc({query:d.YjP().min(1,"Search query is required"),type:d.k5n(["executions","agents","schedules","logs"]).optional(),filters:d.g1P(d.YjP(),d.bzn()).optional()}).merge(e),d.Ikc({type:d.k5n(["executions","costs","config","all"]),format:d.k5n(["json","csv","excel"]),filters:d.g1P(d.YjP(),d.bzn()).optional()}).merge(f)},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69334:(a,b,c)=>{c.d(b,{T9:()=>j,U9:()=>g,Zf:()=>h,cz:()=>i,jk:()=>k});var d=c(80228),e=c(46493),f=c(85766);function g(a){return(0,f.ll)`count(${a||f.ll.raw("*")})`.mapWith(Number)}function h(a){return(0,f.ll)`avg(${a})`.mapWith(String)}function i(a){return(0,f.ll)`sum(${a})`.mapWith(String)}function j(a){return(0,f.ll)`max(${a})`.mapWith((0,e.is)(a,d.V)?a:String)}function k(a){return(0,f.ll)`min(${a})`.mapWith((0,e.is)(a,d.V)?a:String)}},77598:a=>{a.exports=require("node:crypto")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},87550:a=>{a.exports=require("better-sqlite3")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[586,923,213],()=>b(b.s=46520));module.exports=c})();